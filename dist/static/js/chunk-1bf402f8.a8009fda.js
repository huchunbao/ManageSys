(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-1bf402f8","chunk-2d0ddb73"],{"0d5e":function(e,t,o){"use strict";o.d(t,"b",function(){return a}),o.d(t,"c",function(){return n}),o.d(t,"d",function(){return c}),o.d(t,"a",function(){return s});var l=o("b775");function a(e,t){return Object(l["a"])({url:e,method:"get",params:t})}function n(e,t){return Object(l["a"])({url:e,method:"post",data:t})}function c(e,t){return Object(l["a"])({url:e,method:"put",data:t})}function s(e,t){return Object(l["a"])({url:e,method:"delete",data:t})}},4445:function(e,t,o){},"4eb9":function(e,t,o){"use strict";var l=o("4445"),a=o.n(l);a.a},8324:function(e,t,o){"use strict";o.r(t);var l=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticClass:"data-wapper",staticStyle:{width:"360px"}},[o("el-form",{ref:"collectionForm",staticClass:"collection",attrs:{disabled:0===e.wapperType&&!e.btnSave,model:e.collectionForm,rules:e.collectionRules,"label-width":"120px",autocomplete:"on",size:"mini"}},[o("el-form-item",{attrs:{label:"数据采集名称",prop:"name"}},[o("el-input",{attrs:{placeholder:"输入数据采集名称"},model:{value:e.collectionForm.name,callback:function(t){e.$set(e.collectionForm,"name",t)},expression:"collectionForm.name"}})],1),e._v(" "),o("el-form-item",{attrs:{label:"厂商名称",prop:"company"}},[o("el-input",{attrs:{clearable:"",placeholder:"输入厂商名称"},model:{value:e.collectionForm.company,callback:function(t){e.$set(e.collectionForm,"company",t)},expression:"collectionForm.company"}})],1),e._v(" "),o("el-form-item",{attrs:{label:"子系统名称"}},[o("el-dropdown",{attrs:{type:"primary",placement:"bottom-start",plain:""},on:{command:function(t){return e.handleChildDD.apply(void 0,arguments)}}},[o("el-button",{staticClass:"el-dropdown-link"},[e._v("\n          "+e._s(e.collectionForm.childSys)),o("i",{staticClass:"el-icon-caret-bottom el-icon--right"})]),e._v(" "),o("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},e._l(e.childSysList,function(t){return o("el-dropdown-item",{key:t.id,attrs:{command:t}},[e._v(e._s(t.name))])}),1)],1)],1),e._v(" "),o("el-form-item",{attrs:{label:"服务器名称或IP",prop:"server"}},[o("el-input",{attrs:{clearable:"",placeholder:"输入服务器名称或IP"},model:{value:e.collectionForm.server,callback:function(t){e.$set(e.collectionForm,"server",t)},expression:"collectionForm.server"}})],1),e._v(" "),o("el-form-item",{attrs:{label:"登录用户名",prop:"username"}},[o("el-input",{attrs:{clearable:"",placeholder:"输入登录用户名"},model:{value:e.collectionForm.username,callback:function(t){e.$set(e.collectionForm,"username",t)},expression:"collectionForm.username"}})],1),e._v(" "),o("el-form-item",{attrs:{label:"密码",prop:"password"}},[o("el-input",{attrs:{clearable:"",placeholder:"输入密码"},model:{value:e.collectionForm.password,callback:function(t){e.$set(e.collectionForm,"password",t)},expression:"collectionForm.password"}})],1),e._v(" "),o("el-form-item",{attrs:{label:"协议类型"}},[o("el-dropdown",{attrs:{type:"primary",placement:"bottom-start",plain:""},on:{command:function(t){return e.handleDD.apply(void 0,arguments)}}},[o("el-button",{staticClass:"el-dropdown-link"},[e._v("\n          "+e._s(e.collectionForm.protocol)),o("i",{staticClass:"el-icon-caret-bottom el-icon--right"})]),e._v(" "),o("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},e._l(e.protocolList,function(t){return o("el-dropdown-item",{key:t.val,attrs:{command:t}},[e._v(e._s(t.name))])}),1)],1)],1),e._v(" "),o("el-form-item",{attrs:{label:"内容编码",prop:"coding"}},[o("el-input",{attrs:{clearable:"",placeholder:"输入内容编码"},model:{value:e.collectionForm.coding,callback:function(t){e.$set(e.collectionForm,"coding",t)},expression:"collectionForm.coding"}})],1),e._v(" "),o("el-form-item",{attrs:{label:"描述",prop:"remark"}},[o("el-input",{attrs:{type:"textarea",rows:3,clearable:"",placeholder:"输入描述"},model:{value:e.collectionForm.remark,callback:function(t){e.$set(e.collectionForm,"remark",t)},expression:"collectionForm.remark"}})],1)],1),e._v(" "),1===e.wapperType?o("el-button",{staticClass:"el-button-default",staticStyle:{float:"left","margin-left":"120px"},attrs:{round:"",size:"mini"},on:{click:e.handleCancel}},[e._v("取消")]):e._e(),e._v(" "),0===e.wapperType?o("el-button",{class:{"el-button-default":e.updateStatus()},staticStyle:{float:"left","margin-left":"120px"},attrs:{disabled:""===e.collectionForm.name||e.btnSave,round:"",size:"mini"},on:{click:function(t){e.btnSave=!0}}},[e._v("修改")]):e._e(),e._v(" "),o("el-button",{class:{"el-button-default":e.btnSave||1===e.wapperType},staticStyle:{float:"right"},attrs:{round:"",size:"mini",loading:e.loading,disabled:0===e.wapperType&&!e.btnSave},on:{click:e.handleSave}},[e._v("保存")])],1)},a=[],n=(o("7f7f"),o("c5f6"),{name:"DataWapper",props:{wapperType:{type:Number,default:0},childSysList:{type:Array,default:function(){return[]}},childSysText:{type:String,default:""}},data:function(){return{collectionForm:{id:0,name:"",company:"",childSys:this.childSysText,childId:1,server:"",username:"",password:"",protocol:"HTTP",coding:"",remark:""},collectionRules:{name:[{required:!0,message:"请输入数据采集名称",trigger:"blur"}],company:[{required:!0,message:"请输入厂商名称",trigger:"blur"}],server:[{required:!0,message:"请输入服务器名称或IP",trigger:"blur"}],username:[{required:!0,message:"请输入登录用户名",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"}],coding:[{required:!0,message:"请输入内容编码",trigger:"blur"}]},protocolList:[{val:1,name:"HTTP"},{val:2,name:"HTTPS"},{val:3,name:"串口"},{val:4,name:"UDP"}],btnSave:!1,loading:!1}},methods:{handleChildDD:function(e){this.collectionForm.childSys=e.name,this.collectionForm.childId=e.id},handleDD:function(e){this.collectionForm.protocol=e.name},updateStatus:function(){return!this.btnSave&&!(this.collectionForm.id<=0)},handleCancel:function(){this.$emit("cancel")},handleSave:function(){var e=this;this.$refs.collectionForm.validate(function(t){t&&(e.loading=!0,1===e.wapperType?e.$emit("add",e.collectionForm):e.$emit("update",e.collectionForm))})}}}),c=n,s=o("2877"),i=Object(s["a"])(c,l,a,!1,null,null,null);t["default"]=i.exports},f0e4:function(e,t,o){"use strict";o.r(t);var l=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticClass:"acquisition-container default-container"},[o("el-row",{staticClass:"first-row",attrs:{gutter:15}},[o("el-col",{attrs:{span:5}},[o("div",{staticClass:"company bg"},[o("div",{staticClass:"company-title"},[o("p",{staticClass:"title f-l"},[e._v("公司")])]),e._v(" "),o("el-scrollbar",{staticClass:"company-tree"},[o("el-tree",{ref:"companyTree",attrs:{data:e.companyData,props:e.defaultProps,"node-key":"companyId","highlight-current":"",accordion:""},on:{"node-click":e.companyClick}})],1)],1),e._v(" "),o("div",{staticClass:"platform bg"},[o("div",[o("p",{staticClass:"title f-l"},[e._v("数据采集")]),e._v(" "),e.$store.state.permission.buttons.includes("数据采集:删除")?o("p",{staticClass:"p-btn f-r",on:{click:e.deleteCollect}},[e._v("删除")]):e._e(),e._v(" "),e.$store.state.permission.buttons.includes("数据采集:增加")?o("p",{staticClass:"p-btn f-r",on:{click:function(t){e.showDialog=!0}}},[e._v("增加")]):e._e()]),e._v(" "),o("el-scrollbar",{staticClass:"company-tree"},[o("el-tree",{ref:"collectionTree",attrs:{data:e.collectionData,props:{children:"children",label:"collectionName"},"node-key":"id","highlight-current":"",accordion:""},on:{"node-click":e.collectionClick}})],1)],1)]),e._v(" "),o("el-col",{attrs:{span:19}},[o("div",{staticClass:"bg"},[o("data-wapper",{ref:"dataPage",attrs:{"wapper-type":0,"child-sys-list":e.childSysList},on:{update:function(t){return e.updateCollection(arguments)}}})],1)])],1),e._v(" "),o("el-dialog",{staticClass:"data-dlg",attrs:{visible:e.showDialog,top:"10vh",title:"添加数据采集",width:"450px"},on:{"update:visible":function(t){e.showDialog=t}}},[e.showDialog?o("data-wapper",{ref:"dataDialog",attrs:{"wapper-type":1,"child-sys-list":e.childSysList,"child-sys-text":e.childSysText},on:{cancel:function(t){e.showDialog=!1},add:function(t){return e.addCollection(arguments)}}}):e._e()],1)],1)},a=[],n=(o("7f7f"),o("db72")),c=o("0d5e"),s=o("2f62"),i=o("8324"),r={components:{DataWapper:i["default"]},data:function(){return{companyData:[],selectCompanyNode:null,defaultProps:{children:"children",label:"companyName"},collectionData:[],childSysList:[],childSysText:"",selectCollectionNode:null,showDialog:!1,dataForm:{name:"",company:"",childSys:"",childId:0,server:"",username:"",password:"",protocol:"",coding:"",remark:""}}},computed:Object(n["a"])({},Object(s["b"])(["companyId"])),created:function(){this.init()},methods:{init:function(){var e=this;Object(c["b"])("/company/"+this.companyId+"/tree",null).then(function(t){0===t.status&&(e.companyData=t.data,e.companyData[0].children=[])}),this.initCollection(),Object(c["b"])("/subsystem/list-all",null).then(function(t){0===t.status&&(e.childSysList=t.data,e.childSysText=e.childSysList[0].name)})},initCollection:function(){var e=this;Object(c["b"])("/data-collection/list/"+this.companyId,null).then(function(t){0===t.status&&(e.collectionData=t.data)})},companyClick:function(e,t){},addCollection:function(e){var t=this,o={cpid:this.companyId,subsystemId:e[0].childId,collectionName:e[0].name,shopName:e[0].company,ip:e[0].server,name:e[0].username,password:e[0].password,protocolType:e[0].protocol,contents:e[0].coding,describes:e[0].remark};Object(c["c"])("/data-collection",o).then(function(e){0===e.status?(t.$refs.dataDialog.loading=!1,t.$message({message:"数据采集添加成功",type:"success",duration:3e3})):t.$message({message:e.msg,type:"warning",duration:3e3}),t.initCollection(),t.showDialog=!1})},collectionClick:function(e){this.selectCollectionNode=JSON.parse(JSON.stringify(e)),this.$refs.dataPage.collectionForm.id=this.selectCollectionNode.id,this.$refs.dataPage.collectionForm.name=this.selectCollectionNode.collectionName,this.$refs.dataPage.collectionForm.company=this.selectCollectionNode.shopName,this.$refs.dataPage.collectionForm.childSys=this.selectCollectionNode.subSystem.name,this.$refs.dataPage.collectionForm.childId=this.selectCollectionNode.subsystemId,this.$refs.dataPage.collectionForm.server=this.selectCollectionNode.ip,this.$refs.dataPage.collectionForm.username=this.selectCollectionNode.name,this.$refs.dataPage.collectionForm.password=this.selectCollectionNode.password,this.$refs.dataPage.collectionForm.protocol=this.selectCollectionNode.protocolType,this.$refs.dataPage.collectionForm.coding=this.selectCollectionNode.contents,this.$refs.dataPage.collectionForm.remark=this.selectCollectionNode.describes},deleteCollect:function(){var e=this;null===this.selectCollectionNode?this.$message({message:"请选择需要删除的数据采集",type:"warning",duration:3e3}):this.$confirm('是否删除"'+this.selectCollectionNode.collectionName+'"',"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){Object(c["a"])("/data-collection/"+e.selectCollectionNode.id,null).then(function(t){0===t.status?(e.$refs.collectionTree.remove(e.selectCollectionNode),e.$refs.dataPage.btnSave=!1,e.$refs.dataPage.$refs.collectionForm.resetFields(),e.selectCollectionNode=null,e.$message({message:"数据采集删除成功",type:"success",duration:3e3})):e.$message({message:t.msg,type:"warning",duration:3e3})})})},updateCollection:function(e){var t=this,o={id:this.selectCollectionNode.id,subsystemId:e[0].childId,subSystem:{id:e[0].childId,name:e[0].childSys},collectionName:e[0].name,shopName:e[0].company,ip:e[0].server,name:e[0].username,password:e[0].password,protocolType:e[0].protocol,contents:e[0].coding,describes:e[0].remark};Object(c["d"])("/data-collection",o).then(function(e){if(0===e.status){t.$message({message:"修改成功",type:"success",duration:3e3});for(var l=t.collectionData.length,a=0;a<l;a++)t.collectionData[a].id===t.selectCollectionNode.id&&(t.collectionData[a].collectionName=o.collectionName,t.collectionData[a].shopName=o.shopName,t.collectionData[a].subSystem.name=o.subSystem.name,t.collectionData[a].subSystem.id=o.subsystemId,t.collectionData[a].subsystemId=o.subsystemId,t.collectionData[a].ip=o.ip,t.collectionData[a].name=o.name,t.collectionData[a].password=o.password,t.collectionData[a].protocolType=o.protocolType,t.collectionData[a].contents=o.contents,t.collectionData[a].describes=o.describes);t.$refs.dataPage.loading=!1,t.$refs.dataPage.btnSave=!1}else t.$message({message:e.msg,type:"warning",duration:3e3})})}}},d=r,m=(o("fa72"),o("4eb9"),o("2877")),p=Object(m["a"])(d,l,a,!1,null,"5c3dfd32",null);t["default"]=p.exports},f234:function(e,t,o){},fa72:function(e,t,o){"use strict";var l=o("f234"),a=o.n(l);a.a}}]);