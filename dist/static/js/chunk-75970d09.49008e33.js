(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-75970d09"],{"0d5e":function(e,t,s){"use strict";s.d(t,"b",function(){return n}),s.d(t,"c",function(){return i}),s.d(t,"d",function(){return r}),s.d(t,"a",function(){return c});var a=s("b775");function n(e,t){return Object(a["a"])({url:e,method:"get",params:t})}function i(e,t){return Object(a["a"])({url:e,method:"post",data:t})}function r(e,t){return Object(a["a"])({url:e,method:"put",data:t})}function c(e,t){return Object(a["a"])({url:e,method:"delete",data:t})}},"177e":function(e,t,s){},"4f81":function(e,t,s){"use strict";var a=s("177e"),n=s.n(a);n.a},"78d1":function(e,t,s){"use strict";s.r(t);var a=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"auth-transfer"},[s("el-row",{attrs:{gutter:20}},[s("el-col",{staticClass:"auth-all-item",attrs:{span:10}},[s("div",{staticClass:"auth-tree-title"},[e._v("功能清单")]),e._v(" "),s("el-scrollbar",{staticClass:"auth-tree"},[s("el-tree",{ref:"sysTree",attrs:{data:e.sysData,props:e.defaultProps,"node-key":"id","empty-text":e.authLoading,"highlight-current":"",accordion:"","show-checkbox":"","default-expand-all":""}})],1)],1),e._v(" "),s("el-col",{attrs:{span:4}},[s("div",{staticClass:"company auth-bg"},[s("div",{staticClass:"auth-set-btn"},[s("div",{class:0===e.btnStatus?"auth-disable":"auth-available",on:{click:e.addAuth}},[e._v("授权")]),e._v(" "),s("div",{class:0===e.btnStatus?"auth-disable":"auth-available",on:{click:e.removeAuth}},[e._v("移除")])])])]),e._v(" "),s("el-col",{staticClass:"auth-item",attrs:{span:10}},[s("div",{staticClass:"auth-tree-title"},[e._v("授权功能")]),e._v(" "),s("el-scrollbar",{staticClass:"auth-tree"},[s("el-tree",{ref:"setTree",attrs:{data:e.setData,props:e.defaultProps,"node-key":e.setKey,"empty-text":e.setLoading,"highlight-current":"",accordion:"","show-checkbox":"","default-expand-all":""}})],1)],1)],1)],1)},n=[],i=(s("ac6a"),s("7f7f"),s("20d6"),s("96cf"),s("3b8d")),r=s("db72"),c=(s("c5f6"),s("0d5e")),u=s("2f62"),o={props:{selectCompanyId:{type:Number,default:0},btnStatus:{type:Number,default:0}},data:function(){return{authLoading:"暂无数据",setLoading:"暂无数据",sysRootNode:[],sysData:[],setKey:"id",setPKey:"pid",setData:[],setDefault:[],defaultProps:{children:"children",label:"name"}}},computed:Object(r["a"])({},Object(u["b"])(["companyId"])),watch:{selectCompanyId:{handler:function(e,t){this.getCompanySys(e)}}},created:function(){this.getAllSys()},methods:{getAllSys:function(){var e=this;this.authLoading="数据加载中...",12===this.companyId?Object(c["b"])("/sysfunc/tree",null).then(function(t){0===t.status&&(e.sysData=t.data,e.sysRootNode=JSON.parse(JSON.stringify(t.data)),e.sysRootNode[0].children=[]),e.authLoading="暂无数据"}):(this.setKey="funcId",this.setPKey="funcPid",Object(c["b"])("/cpfunc/tree/"+this.companyId,null).then(function(t){0===t.status&&(e.sysData=t.data,e.sysRootNode=JSON.parse(JSON.stringify(t.data)),e.sysRootNode[0].children=[]),e.authLoading="暂无数据"}),this.getCompanySys(this.selectCompanyId))},getCompanySys:function(e){var t=this;this.selectCompanyId>0&&(this.setLoading="数据加载中...",Object(c["b"])("/cpfunc/tree/"+this.selectCompanyId,null).then(function(e){0===e.status&&(t.setData=e.data,e.data.length>0?t.setDefault=t.getTreeNode(e.data):t.setDefault=[]),t.setLoading="暂无数据"}))},addAuth:function(){var e=this;if(0!==this.btnStatus){var t=this,s=this.$refs.sysTree.getCheckedNodes(!1,!0);s.length<=1||null===s||(t.setData=JSON.parse(JSON.stringify(this.sysRootNode)),t.$nextTick(function(){for(var a,n=JSON.parse(JSON.stringify(s)),i=1;i<n.length;i++)a=n[i],a.children=[],t.$refs.setTree.append(a,a[e.setPKey])}))}},removeAuth:function(){if(0!==this.btnStatus)for(var e=this,t=e.$refs.setTree.getCheckedKeys(),s=0;s<t.length;s++)e.$refs.setTree.remove(t[s]),e.$refs.sysTree.setChecked(t[s],!1)},saveAuth:function(){var e=Object(i["a"])(regeneratorRuntime.mark(function e(){var t,s,a,n,i,r,c,u,o,h=this;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(t=this.$refs.setTree.data,null!==t){e.next=16;break}if(!(this.setDefault.length>0)){e.next=13;break}return e.next=5,this.deleteAuth(this.setDefault);case 5:if(!e.sent){e.next=10;break}this.$message({message:"授权保存成功",type:"success",duration:3e3}),this.setDefault=[],e.next=11;break;case 10:this.$message({message:"授权保存失败",type:"warning",duration:3e3});case 11:e.next=14;break;case 13:this.$message({message:"授权保存成功",type:"success",duration:3e3});case 14:e.next=53;break;case 16:if(s=this.getTreeNode(t),!(this.setDefault.length>0)){e.next=44;break}for(a=JSON.parse(JSON.stringify(this.setDefault)),n=JSON.parse(JSON.stringify(s)),i=0;i<s.length;i++)r=a.findIndex(function(e){return e.name===s[i].name}),r>=0&&a.splice(r,1);if(c=!0,!(a.length>0)){e.next=26;break}return e.next=25,this.deleteAuth(a);case 25:c=e.sent;case 26:if(!c){e.next=41;break}for(u=0;u<this.setDefault.length;u++)o=n.findIndex(function(e){return e.name===h.setDefault[u].name}),o>=0&&n.splice(o,1);if(!(n.length>0)){e.next=38;break}return e.next=31,this.postAuth(n);case 31:if(!e.sent){e.next=35;break}this.$message({message:"授权保存成功",type:"success",duration:3e3}),e.next=36;break;case 35:this.$message({message:"授权保存失败",type:"warning",duration:3e3});case 36:e.next=39;break;case 38:this.$message({message:"授权保存成功",type:"success",duration:3e3});case 39:e.next=42;break;case 41:this.$message({message:"授权保存失败",type:"warning",duration:3e3});case 42:e.next=51;break;case 44:return e.next=46,this.postAuth(s);case 46:if(!e.sent){e.next=50;break}this.$message({message:"授权保存成功",type:"success",duration:3e3}),e.next=51;break;case 50:this.$message({message:"授权保存失败",type:"warning",duration:3e3});case 51:this.getCompanySys(this.selectCompanyId),this.$emit("authend");case 53:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}(),getTreeNode:function(e){var t=[],s=function e(s){s.forEach(function(s){t.push(s),s.children&&s.children.length>0&&e(s.children)})};return s(e),t},deleteAuth:function(e){var t=[];return e.forEach(function(e){t.push(e.id)}),new Promise(function(e,s){Object(c["a"])("/cpfunc",t).then(function(t){e(0===t.status)}).catch(function(){s(!1)})})},postAuth:function(e){var t=this;if("funcPid"===this.setPKey)for(var s=0;s<e.length;s++)e[s].id=e[s].funcId,e[s].pid=e[s].funcPid;return new Promise(function(s,a){Object(c["c"])("/cpfunc/"+t.selectCompanyId,e).then(function(e){s(0===e.status)}).catch(function(){a(!1)})})}}},h=o,d=(s("4f81"),s("2877")),l=Object(d["a"])(h,a,n,!1,null,null,null);t["default"]=l.exports}}]);