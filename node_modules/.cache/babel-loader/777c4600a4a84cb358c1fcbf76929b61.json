{"remainingRequest":"D:\\办公\\projectwc\\前端\\ManageSys\\node_modules\\babel-loader\\lib\\index.js!D:\\办公\\projectwc\\前端\\ManageSys\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!D:\\办公\\projectwc\\前端\\ManageSys\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\办公\\projectwc\\前端\\ManageSys\\src\\views\\structure\\galasys.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\办公\\projectwc\\前端\\ManageSys\\src\\views\\structure\\galasys.vue","mtime":1576638137033},{"path":"D:\\办公\\projectwc\\前端\\ManageSys\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\办公\\projectwc\\前端\\ManageSys\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"D:\\办公\\projectwc\\前端\\ManageSys\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\办公\\projectwc\\前端\\ManageSys\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["\"use strict\";\n\nvar _interopRequireDefault = require(\"D:\\\\\\u529E\\u516C\\\\projectwc\\\\\\u524D\\u7AEF\\\\ManageSys\\\\node_modules\\\\@babel\\\\runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nrequire(\"core-js/modules/web.dom.iterable\");\n\nrequire(\"core-js/modules/es6.regexp.split\");\n\nrequire(\"core-js/modules/es6.function.name\");\n\nvar _axios = require(\"@/api/axios\");\n\nvar _validate = require(\"@/utils/validate\");\n\nvar _utils = require(\"@/utils\");\n\nvar _TreeTransfer = _interopRequireDefault(require(\"./components/TreeTransfer\"));\n\nvar _role = _interopRequireDefault(require(\"./components/role\"));\n\nvar _account = _interopRequireDefault(require(\"./components/account\"));\n\nvar _icon_review_ok = _interopRequireDefault(require(\"@/assets/icon/icon_review_ok.png\"));\n\nvar _icon_review_default = _interopRequireDefault(require(\"@/assets/icon/icon_review_default.png\"));\n\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nvar _default = {\n  components: {\n    TreeTransfer: _TreeTransfer.default,\n    Role: _role.default,\n    Account: _account.default\n  },\n  data: function data() {\n    var newDate = new Date();\n\n    var validateMobile = function validateMobile(rule, value, callback) {\n      if (value === '') {\n        callback(new Error('请输入手机号码'));\n      } else if (!(0, _validate.validMobile)(value)) {\n        callback(new Error('手机号输入不正确!'));\n      } else {\n        callback();\n      }\n    };\n\n    var validateEmail = function validateEmail(rule, value, callback) {\n      if (value === '') {\n        callback(new Error('请输入邮箱'));\n      } else if (!(0, _validate.validEmail)(value)) {\n        callback(new Error('邮箱格式不正确!'));\n      } else {\n        callback();\n      }\n    };\n\n    return {\n      reviewUser: {\n        id: 0,\n        auditorId: 0,\n        auditorName: '',\n        auditorEmail: '',\n        auditorLevel: 0\n      },\n      reviewType: 0,\n      showReview: false,\n      reviewText: '',\n      reviewStatus: '通过',\n      isGalasys: false,\n      companyDelBtn: false,\n      selectCompanyNode: null,\n      selectCompanyId: 0,\n      selectLicenseId: 0,\n      natureList: [],\n      typeList: [],\n      companyData: [],\n      companyProps: {\n        children: 'children',\n        label: 'companyName'\n      },\n      companyForm: {\n        btnName: '编辑',\n        status: 0,\n        companyId: 0,\n        name: '',\n        principal: '',\n        nature: '',\n        natureId: 0,\n        mobile: '',\n        type: '',\n        typeId: 0,\n        email: '',\n        date: ['', '']\n      },\n      showAddCompany: false,\n      addCompanyType: 0,\n      addCompanyForm: {\n        name: '',\n        principal: '',\n        nature: '',\n        natureId: 0,\n        mobile: '',\n        type: '',\n        typeId: 0,\n        email: '',\n        licenseId: 0,\n        date: [newDate.getFullYear() + '-' + (newDate.getMonth() + 1) + '-' + newDate.getDate(), newDate.getFullYear() + 1 + '-' + (newDate.getMonth() + 1) + '-' + newDate.getDate()]\n      },\n      addCompanyRules: {\n        name: [{\n          required: true,\n          message: '请输入公司名称',\n          trigger: 'blur'\n        }],\n        principal: [{\n          required: true,\n          message: '请输入负责人',\n          trigger: 'blur'\n        }],\n        mobile: [{\n          required: true,\n          validator: validateMobile,\n          trigger: 'blur'\n        }],\n        email: [{\n          required: true,\n          validator: validateEmail,\n          trigger: 'blur'\n        }]\n      },\n      addCompanyLoading: false,\n      reviewOk: _icon_review_ok.default,\n      reviewDefault: _icon_review_default.default,\n      reviewCompanyStatus: {\n        auditStatus: 0,\n        id: 0,\n        licenseEnd: '',\n        licenseStart: '',\n        firstAuditstatus: 0,\n        secondAuditstatus: 0,\n        thirdAuditstatus: 0,\n        updateBy: null,\n        updateDate: null\n      },\n      reviewCompanyContent: {\n        first: '',\n        firstResult: 0,\n        second: '',\n        secondResult: 0,\n        third: '',\n        thirdResult: 0\n      },\n      departmentData: [],\n      departmentProps: {\n        children: 'children',\n        label: 'name'\n      },\n      showDepartment: false,\n      addDepartmentForm: {\n        name: '',\n        oldName: ''\n      },\n      addDepartmentRules: {\n        name: [{\n          required: true,\n          message: '请输入部门名称',\n          trigger: 'blur'\n        }]\n      },\n      addDepartmentType: 0,\n      selectDepartmentNode: null,\n      userSearchType: 0,\n      // 0是公司  1是部门\n      userLoading: false,\n      userList: [],\n      showUser: false,\n      addUserType: 0,\n      addUserInfo: {\n        uid: 0,\n        type: 0,\n        cpid: '',\n        deptId: '',\n        cusName: '',\n        phone: '',\n        postName: '',\n        cusPassword: '',\n        cusPic: ''\n      },\n      showUserRole: false,\n      userRoleForm: {\n        id: 0,\n        index: -1,\n        showName: '',\n        roleId: 0\n      },\n      roleLoading: false,\n      roleList: [],\n      showRole: false,\n      addRoleId: 0,\n      addRoleType: 0,\n      addRoleName: '',\n      authStatus: 0,\n      authBtnText: '编辑',\n      authBtnStatus: true,\n      authLoading: false,\n      reviewLoading: false\n    };\n  },\n  mounted: function mounted() {\n    this.init();\n    this.initDDData();\n  },\n  methods: {\n    init: function init() {\n      var _this = this;\n\n      (0, _axios.get)('/company/tree', null).then(function (response) {\n        if (response.status === 0) {\n          _this.companyData = response.data;\n        }\n      });\n      (0, _axios.get)('/license/auditors', null).then(function (response) {\n        // 获取审批人员列表\n        if (response.status === 0) {\n          var reviewUser = response.data.filter(function (item) {\n            return item.auditorId === _this.$store.state.user.uid && item.auditorLevel > 0;\n          });\n\n          if (reviewUser.length > 0) {\n            _this.reviewUser = reviewUser[0];\n          }\n        }\n      });\n    },\n    initDDData: function initDDData() {\n      var _this2 = this;\n\n      // 初始化公司性质、类型下拉菜单\n      (0, _axios.get)('/company/const', null).then(function (response) {\n        if (response.status === 0) {\n          _this2.natureList = response.data.natures;\n          _this2.typeList = response.data.types;\n          _this2.addCompanyForm.nature = _this2.natureList[1].name;\n          _this2.addCompanyForm.natureId = _this2.natureList[1].val;\n          _this2.addCompanyForm.type = _this2.typeList[0].name;\n          _this2.addCompanyForm.typeId = _this2.typeList[0].val;\n        }\n      });\n    },\n    reviewDic: function reviewDic(status, type) {\n      var dic = '';\n      var result = '';\n\n      switch (type) {\n        case 1:\n          result = this.reviewCompanyContent.firstResult === 1 ? '通过' : '不通过';\n          break;\n\n        case 2:\n          result = this.reviewCompanyContent.secondResult === 1 ? '通过' : '不通过';\n          break;\n\n        case 3:\n          result = this.reviewCompanyContent.thirdResult === 1 ? '通过' : '不通过';\n          break;\n\n        default:\n          break;\n      }\n\n      if (status > 0) {\n        dic = '审批:' + result;\n      } else if (status < 0) {\n        dic = '反审:' + result;\n      } else {\n        dic = '待审核';\n      }\n\n      return dic;\n    },\n    getReviewClass: function getReviewClass(status) {\n      var className = '';\n\n      if (status <= 0) {\n        className = status === 0 ? 'review-pending' : 'review-return';\n      }\n\n      return className;\n    },\n    getReviewDisable: function getReviewDisable(type) {\n      var d = false;\n\n      switch (type) {\n        case 1:\n          if (this.reviewCompanyStatus.secondAuditstatus === 1 && this.reviewCompanyContent.secondResult === 1) {\n            d = true;\n          }\n\n          break;\n\n        case 2:\n          if (this.reviewCompanyContent.firstResult !== 1 || this.reviewCompanyStatus.thirdAuditstatus === 1 && this.reviewCompanyContent.thirdResult === 1) {\n            d = true;\n          }\n\n          break;\n\n        case 3:\n          if (this.reviewCompanyContent.secondResult !== 1) {\n            d = true;\n          }\n\n          break;\n\n        default:\n          break;\n      }\n\n      return d;\n    },\n    addCompany: function addCompany(type) {\n      // 增加公司type 0 总公司 1子公司 只有galasys可以加子公司\n      this.addCompanyType = type;\n      this.showAddCompany = true;\n    },\n    deleteCompany: function deleteCompany() {\n      var _this3 = this;\n\n      // 删除公司\n      if (this.selectCompanyNode === null) {\n        this.$message({\n          message: '请选择需要删除的公司',\n          type: 'warning',\n          duration: 3000\n        });\n      } else {\n        this.$confirm('是否删除公司\"' + this.selectCompanyNode.companyName + '\"', '提示', {\n          confirmButtonText: '确定',\n          cancelButtonText: '取消',\n          type: 'warning'\n        }).then(function () {\n          (0, _axios.byDelete)('/company/' + _this3.selectCompanyNode.companyId, null).then(function (response) {\n            if (response.status === 0) {\n              _this3.$refs.companyTree.remove(_this3.selectCompanyNode);\n\n              _this3.selectCompanyId = 0;\n              _this3.companyForm.btnName = '编辑';\n              _this3.companyForm.status = 0;\n              _this3.companyForm.companyId = 0;\n              _this3.companyForm.name = '';\n              _this3.companyForm.principal = '';\n              _this3.companyForm.nature = '';\n              _this3.companyForm.natureId = 0;\n              _this3.companyForm.mobile = '';\n              _this3.companyForm.type = '';\n              _this3.companyForm.typeId = 0;\n              _this3.companyForm.email = '';\n              _this3.companyForm.licenseId = 0;\n              _this3.companyForm.date = ['', ''];\n              _this3.selectCompanyNode = null;\n              _this3.selectDepartmentNode = null;\n              _this3.userList = [];\n              _this3.roleList = [];\n\n              _this3.$message({\n                message: '公司删除成功',\n                type: 'success',\n                duration: 3000\n              });\n            } else {\n              _this3.$message({\n                message: response.msg,\n                type: 'warning',\n                duration: 3000\n              });\n            }\n          });\n        }).catch(function () {});\n      }\n    },\n    getRootNode: function getRootNode(node) {\n      // 获取根节点\n      if (node.level === 1) {\n        return node.data;\n      } else {\n        return this.getRootNode(node.parent);\n      }\n    },\n    companyClick: function companyClick(node, all) {\n      // 公司树点击事件\n      this.selectCompanyNode = node;\n\n      if (node.companyId === 12) {\n        this.companyDelBtn = false;\n        this.isGalasys = true;\n        this.showCompanyInfo(node);\n      } else if (this.getRootNode(all).companyId === 12) {\n        this.isGalasys = true;\n        this.companyDelBtn = true;\n        this.showCompanyInfo(node);\n      } else if (node.pid > 0) {\n        this.isGalasys = false;\n        this.companyDelBtn = false;\n        this.showCompanyInfo(this.getRootNode(all));\n      } else {\n        this.isGalasys = false;\n        this.companyDelBtn = true;\n        this.showCompanyInfo(node);\n      }\n    },\n    showCompanyInfo: function showCompanyInfo(data) {\n      // 显示公司信息\n      this.selectCompanyId = data.companyId;\n      this.selectLicenseId = data.licenseId;\n      this.companyForm.companyId = data.companyId;\n      this.companyForm.name = data.companyName;\n      this.companyForm.principal = data.master;\n      this.companyForm.natureId = data.companyNature;\n      this.companyForm.nature = this.natureList.filter(function (item) {\n        if (item.val === data.companyNature) {\n          return item;\n        }\n      })[0].name;\n      this.companyForm.mobile = data.phone;\n      this.companyForm.typeId = data.companyType;\n      this.companyForm.type = this.typeList.filter(function (item) {\n        if (item.val === data.companyType) {\n          return item;\n        }\n      })[0].name;\n      this.companyForm.email = data.email;\n      this.companyForm.licenseId = data.licenseId;\n      this.companyForm.date = [data.sysLicense.licenseStart.split(' ')[0], data.sysLicense.licenseEnd.split(' ')[0]];\n      this.reviewCompanyStatus = data.sysLicense;\n      console.log(data.sysLicense);\n\n      if (data.companyId === 12) {\n        this.authBtnStatus = false;\n      } else if (data.sysLicense.firstAuditstatus === 1 || data.sysLicense.secondAuditstatus === 1 || data.sysLicense.thirdAuditstatus === 1) {\n        this.authBtnStatus = true;\n      } else {\n        this.authBtnStatus = false;\n      }\n\n      this.getDepartmentInfo(data.companyId);\n      this.getRoleInfo(data.companyId);\n      this.userSearchType = 0;\n      this.getUserInfoByCompany(data.companyId);\n      this.getCompanyStatus(data.licenseId);\n    },\n    getCompanyStatus: function getCompanyStatus(lid) {\n      var _this4 = this;\n\n      // 获取公司审核信息\n      (0, _axios.get)('/license/message/' + lid, null).then(function (response) {\n        if (response.status === 0) {\n          response.data.forEach(function (item) {\n            if (item !== null) {\n              switch (Math.abs(item.auditorLevel)) {\n                case 1:\n                  _this4.reviewCompanyContent.first = item.auditMsg;\n                  _this4.reviewCompanyContent.firstResult = item.auditResult;\n                  break;\n\n                case 2:\n                  _this4.reviewCompanyContent.second = item.auditMsg;\n                  _this4.reviewCompanyContent.secondResult = item.auditResult;\n                  break;\n\n                case 3:\n                  _this4.reviewCompanyContent.third = item.auditMsg;\n                  _this4.reviewCompanyContent.thirdResult = item.auditResult;\n                  break;\n\n                default:\n                  break;\n              }\n            }\n          });\n        }\n      });\n    },\n    handleDD: function handleDD(type, data) {\n      switch (type) {\n        case 1:\n          this.companyForm.nature = data.name;\n          this.companyForm.natureId = data.val;\n          break;\n\n        case 2:\n          this.companyForm.type = data.name;\n          this.companyForm.typeId = data.val;\n          break;\n\n        case 3:\n          this.addCompanyForm.nature = data.name;\n          this.addCompanyForm.natureId = data.val;\n          break;\n\n        case 4:\n          this.addCompanyForm.type = data.name;\n          this.addCompanyForm.typeId = data.val;\n          break;\n\n        default:\n          break;\n      }\n    },\n    submitCompany: function submitCompany() {\n      var _this5 = this;\n\n      // 添加公司\n      var that = this;\n      this.$refs.addCompanyForm.validate(function (valid) {\n        if (valid) {\n          var company = {\n            pid: _this5.addCompanyType === 0 ? 0 : _this5.selectCompanyNode.companyId,\n            companyName: _this5.addCompanyForm.name,\n            companyNature: _this5.addCompanyForm.natureId,\n            companyType: _this5.addCompanyForm.typeId,\n            email: _this5.addCompanyForm.email,\n            master: _this5.addCompanyForm.principal,\n            phone: _this5.addCompanyForm.mobile,\n            sysLicense: {\n              licenseStart: (0, _utils.parseTime)(_this5.addCompanyForm.date[0], '{y}-{m}-{d} 00:00:00'),\n              licenseEnd: (0, _utils.parseTime)(_this5.addCompanyForm.date[1], '{y}-{m}-{d} 23:59:59')\n            }\n          };\n          _this5.addCompanyLoading = true;\n          (0, _axios.post)('/company', company).then(function (response) {\n            if (response.status === 0) {\n              _this5.addCompanyLoading = false;\n\n              _this5.$refs.companyTree.append(response.data, response.data.pid);\n\n              _this5.$message({\n                message: '公司添加成功',\n                type: 'success',\n                duration: 3000\n              });\n            } else {\n              _this5.$message({\n                message: response.msg,\n                type: 'warning',\n                duration: 3000\n              });\n            }\n\n            that.cancelCompany();\n          });\n        } else {\n          return;\n        }\n      });\n    },\n    cancelCompany: function cancelCompany() {\n      this.showAddCompany = false;\n      var newDate = new Date(); // 时间控件初始化\n\n      this.addCompanyForm.date = [newDate.getFullYear() + '-' + (newDate.getMonth() + 1) + '-' + newDate.getDate(), newDate.getFullYear() + 1 + '-' + (newDate.getMonth() + 1) + '-' + newDate.getDate()];\n      this.$refs.addCompanyForm.resetFields();\n    },\n    editCompanyInfo: function editCompanyInfo() {\n      var _this6 = this;\n\n      // 编辑公司\n      if (this.companyForm.companyId <= 0) {\n        this.$message({\n          message: '请选择需要编辑的公司',\n          type: 'warning',\n          duration: 3000\n        });\n        return;\n      }\n\n      if (this.companyForm.status === 0) {\n        this.companyForm.btnName = '保存';\n        this.companyForm.status = 1;\n      } else {\n        var errMsg = '';\n\n        if (this.companyForm.name === '') {\n          errMsg = '请输入公司名称';\n        } else if (this.companyForm.principal === '') {\n          errMsg = '请输入负责人';\n        } else if (this.companyForm.mobile === '') {\n          errMsg = '请输入手机号';\n        } else if (!(0, _validate.validMobile)(this.companyForm.mobile)) {\n          errMsg = '手机号格式输入不正确';\n        } else if (this.companyForm.email === '') {\n          errMsg = '请输入邮箱';\n        } else if (!(0, _validate.validEmail)(this.companyForm.email)) {\n          errMsg = '邮箱格式输入不正确';\n        }\n\n        if (errMsg === '') {\n          var company = {\n            companyId: this.companyForm.companyId,\n            companyName: this.companyForm.name,\n            companyNature: this.companyForm.natureId,\n            companyType: this.companyForm.typeId,\n            email: this.companyForm.email,\n            master: this.companyForm.principal,\n            phone: this.companyForm.mobile,\n            licenseId: this.companyForm.licenseId,\n            sysLicense: {\n              licenseStart: (0, _utils.parseTime)(this.companyForm.date[0], '{y}-{m}-{d}'),\n              licenseEnd: (0, _utils.parseTime)(this.companyForm.date[1], '{y}-{m}-{d}')\n            }\n          };\n          (0, _axios.put)('/company', company).then(function (response) {\n            if (response.status === 0) {\n              _this6.$message({\n                message: '公司编辑成功',\n                type: 'success',\n                duration: 3000\n              });\n\n              _this6.companyData = response.data;\n              _this6.companyForm.btnName = '编辑';\n              _this6.companyForm.status = 0;\n            } else {\n              _this6.$message({\n                message: response.msg,\n                type: 'warning',\n                duration: 3000\n              });\n            }\n          });\n        } else {\n          this.$message({\n            message: errMsg,\n            type: 'warning',\n            duration: 3000\n          });\n        }\n      }\n    },\n    getDepartmentInfo: function getDepartmentInfo(companyId) {\n      var _this7 = this;\n\n      (0, _axios.get)('/dept/list/' + companyId, null).then(function (response) {\n        if (response.status === 0) {\n          _this7.departmentData = response.data;\n        }\n      });\n    },\n    departmentClick: function departmentClick(node) {\n      this.selectDepartmentNode = node;\n      this.addDepartmentForm.oldName = node.name;\n      this.userSearchType = 1;\n      this.getUserInfoByDepartment(node.id);\n    },\n    addDepartment: function addDepartment(type) {\n      if (this.selectCompanyNode === null) {\n        this.$message({\n          message: '请选择需要添加部门的公司',\n          type: 'warning',\n          duration: 3000\n        });\n      } else {\n        this.addDepartmentType = type;\n        this.showDepartment = true;\n      }\n    },\n    deleteDepartment: function deleteDepartment() {\n      var _this8 = this;\n\n      if (this.selectDepartmentNode === null) {\n        this.$message({\n          message: '请选择需要删除的部门',\n          type: 'warning',\n          duration: 3000\n        });\n      } else {\n        this.$confirm('是否删除部门\"' + this.selectDepartmentNode.name + '\"', '提示', {\n          confirmButtonText: '确定',\n          cancelButtonText: '取消',\n          type: 'warning'\n        }).then(function () {\n          (0, _axios.byDelete)('/dept/' + _this8.selectDepartmentNode.id, null).then(function (response) {\n            if (response.status === 0) {\n              _this8.$refs.departmentTree.remove(_this8.selectDepartmentNode);\n\n              _this8.selectDepartmentNode = null;\n\n              _this8.$message({\n                message: '部门删除成功',\n                type: 'success',\n                duration: 3000\n              });\n            } else {\n              _this8.$message({\n                message: response.msg,\n                type: 'warning',\n                duration: 3000\n              });\n            }\n          });\n        }).catch(function () {});\n      }\n    },\n    submitDepartment: function submitDepartment() {\n      var _this9 = this;\n\n      var that = this;\n      this.$refs.addDepartmentForm.validate(function (valid) {\n        if (valid) {\n          var department = {\n            id: null,\n            cpid: null,\n            name: _this9.addDepartmentForm.name\n          };\n\n          if (_this9.addDepartmentType === 0) {\n            department.cpid = _this9.selectCompanyNode.companyId;\n            (0, _axios.post)('/dept', department).then(function (response) {\n              if (response.status === 0) {\n                _this9.$message({\n                  message: '部门添加成功',\n                  type: 'success',\n                  duration: 3000\n                });\n\n                _this9.$refs.departmentTree.append(response.data, 0);\n              } else {\n                _this9.$message({\n                  message: response.msg,\n                  type: 'warning',\n                  duration: 3000\n                });\n              }\n\n              that.cancelDepartment();\n            });\n          } else {\n            (0, _axios.put)('/dept/' + _this9.selectDepartmentNode.id + '/' + _this9.selectCompanyNode.companyId + '/' + _this9.addDepartmentForm.name, null).then(function (response) {\n              if (response.status === 0) {\n                _this9.departmentData = response.data;\n\n                _this9.$message({\n                  message: '部门修改成功',\n                  type: 'success',\n                  duration: 3000\n                });\n              } else {\n                _this9.$message({\n                  message: response.msg,\n                  type: 'warning',\n                  duration: 3000\n                });\n              }\n\n              that.cancelDepartment();\n            });\n          }\n        } else {\n          return;\n        }\n      });\n    },\n    cancelDepartment: function cancelDepartment() {\n      this.showDepartment = false;\n      this.$refs.addDepartmentForm.resetFields();\n    },\n    getRoleInfo: function getRoleInfo(companyId) {\n      var _this10 = this;\n\n      this.roleLoading = true;\n      (0, _axios.get)('/role/list/' + companyId, null).then(function (response) {\n        _this10.roleLoading = false;\n\n        if (response.status === 0) {\n          _this10.roleList = response.data;\n        }\n      });\n    },\n    addUser: function addUser(type) {\n      if (this.selectDepartmentNode === null) {\n        this.$message({\n          message: '请选择需要添加用户的部门',\n          type: 'warning',\n          duration: 3000\n        });\n      } else {\n        this.addUserInfo.cpid = this.selectCompanyNode.companyId;\n        this.addUserInfo.deptId = this.selectDepartmentNode.id;\n        this.addUserInfo.userId = 0;\n        this.addUserInfo.cusName = '';\n        this.addUserInfo.phone = '';\n        this.addUserInfo.postName = '';\n        this.addUserInfo.cusPic = '';\n        this.addUserInfo.type = type;\n        this.addUserType = type;\n        this.showUser = true;\n      }\n    },\n    updateUser: function updateUser(user) {\n      this.addUserInfo.cpid = user.row.cpid;\n      this.addUserInfo.deptId = user.row.deptId;\n      this.addUserInfo.userId = user.row.userId;\n      this.addUserInfo.cusName = user.row.cusName;\n      this.addUserInfo.phone = user.row.phone;\n      this.addUserInfo.postName = user.row.postName;\n      this.addUserInfo.cusPic = user.row.cusPic;\n      this.addUserInfo.type = 1;\n      this.addUserType = 1;\n      this.showUser = true;\n    },\n    handleRoleDD: function handleRoleDD(data) {\n      // 角色下拉菜单\n      this.userRoleForm.showName = data.showName;\n      this.userRoleForm.roleId = data.id;\n    },\n    cancelUserRole: function cancelUserRole() {\n      // 修改角色取消\n      this.userRoleForm.id = 0;\n      this.userRoleForm.index = -1;\n      this.userRoleForm.showName = '';\n      this.userRoleForm.roleId = 0;\n      this.showUserRole = false;\n    },\n    updateUserRole: function updateUserRole(user) {\n      this.userRoleForm.id = user.row.userId;\n      this.userRoleForm.index = user.$index;\n      this.userRoleForm.showName = user.row.roleList.length > 0 ? user.row.roleList[0].showName : '';\n      this.showUserRole = true;\n    },\n    submitUserRole: function submitUserRole() {\n      var _this11 = this;\n\n      if (this.userRoleForm.roleId <= 0) {\n        this.$message({\n          message: '请选择角色',\n          type: 'warning',\n          duration: 3000\n        });\n      } else {\n        (0, _axios.put)('/user/' + this.userRoleForm.id + '/' + this.userRoleForm.roleId, null).then(function (response) {\n          if (response.status === 0) {\n            if (_this11.userList[_this11.userRoleForm.index].roleList.length > 0) {\n              _this11.userList[_this11.userRoleForm.index].roleList[0].showName = _this11.userRoleForm.showName;\n            } else {\n              _this11.userList[_this11.userRoleForm.index].roleList.push({\n                id: _this11.userRoleForm.roleId,\n                showName: _this11.userRoleForm.showName\n              });\n            }\n\n            _this11.$message({\n              message: '用户角色修改成功',\n              type: 'success',\n              duration: 3000\n            });\n          } else {\n            _this11.$message({\n              message: response.msg,\n              type: 'warning',\n              duration: 3000\n            });\n          }\n\n          _this11.showUserRole = false;\n        });\n      }\n    },\n    deleteUserById: function deleteUserById(user) {\n      var _this12 = this;\n\n      this.$confirm('确定删除用户\"' + user.row.cusName + '\"吗？', '提示', {\n        confirmButtonText: '确定',\n        cancelButtonText: '取消',\n        type: 'warning'\n      }).then(function () {\n        (0, _axios.byDelete)('/user/' + user.row.userId, null).then(function (response) {\n          if (response.status === 0) {\n            _this12.$message({\n              message: '用户\"' + user.row.cusName + '\"删除成功',\n              type: 'success',\n              duration: 3000\n            });\n\n            _this12.userList.splice(user.$index);\n          } else {\n            _this12.$message({\n              message: response.msg,\n              type: 'warning',\n              duration: 3000\n            });\n          }\n        });\n      });\n    },\n    submitUser: function submitUser() {\n      this.showUser = false;\n\n      if (this.userSearchType === 0) {\n        // 公司\n        this.getUserInfoByCompany(this.selectCompanyId);\n      } else {\n        this.getUserInfoByDepartment(this.selectDepartmentNode.id);\n      }\n    },\n    getUserInfoByCompany: function getUserInfoByCompany(companyId) {\n      var _this13 = this;\n\n      this.userLoading = true;\n      (0, _axios.get)('/user/list/cp' + companyId, null).then(function (response) {\n        _this13.userLoading = false;\n\n        if (response.status === 0) {\n          _this13.userList = response.data;\n        }\n      });\n    },\n    getUserInfoByDepartment: function getUserInfoByDepartment(departmentId) {\n      var _this14 = this;\n\n      this.userLoading = true;\n      (0, _axios.get)('/user/list/dp' + departmentId, null).then(function (response) {\n        _this14.userLoading = false;\n\n        if (response.status === 0) {\n          _this14.userList = response.data;\n        }\n      });\n    },\n    addRole: function addRole() {\n      if (this.selectCompanyNode === null) {\n        this.$message({\n          message: '请选择需要添加角色的公司',\n          type: 'warning',\n          duration: 3000\n        });\n      } else {\n        this.addRoleType = 0;\n        this.addRoleId = 0;\n        this.addRoleName = '';\n        this.showRole = true;\n      }\n    },\n    updateRole: function updateRole(data) {\n      this.addRoleType = 1;\n      this.addRoleId = data.id;\n      this.addRoleName = data.showName;\n      this.showRole = true;\n    },\n    deleteRole: function deleteRole(data) {\n      var _this15 = this;\n\n      this.$confirm('确定删除角色\"' + data.showName + '\"吗？', '提示', {\n        confirmButtonText: '确定',\n        cancelButtonText: '取消',\n        type: 'warning'\n      }).then(function () {\n        (0, _axios.post)('/role/del/' + data.id, null).then(function (response) {\n          if (response.status === 0) {\n            _this15.getRoleInfo(_this15.selectCompanyId);\n\n            _this15.$message({\n              message: '角色\"' + data.showName + '\"删除成功',\n              type: 'success',\n              duration: 3000\n            });\n          } else {\n            _this15.$message({\n              message: response.msg,\n              type: 'warning',\n              duration: 3000\n            });\n          }\n        });\n      });\n    },\n    submitRole: function submitRole() {\n      this.showRole = false;\n      this.getRoleInfo(this.selectCompanyId);\n    },\n    authEdit: function authEdit() {\n      if (this.authStatus === 0) {\n        this.authStatus = 1;\n        this.authBtnText = '保存';\n      } else {\n        this.authStatus = 0;\n        this.authBtnText = '编辑';\n        this.authLoading = true;\n        this.$refs.treeTransfer.saveAuth();\n      }\n    },\n    review: function review() {\n      this.reviewType = 0;\n      this.reviewStatus = '通过';\n      this.showReview = true;\n    },\n    antiReview: function antiReview() {\n      this.reviewType = 1;\n      this.reviewStatus = '通过';\n      this.showReview = true;\n    },\n    cancelReview: function cancelReview() {\n      this.reviewText = '';\n      this.showReview = false;\n    },\n    submitReview: function submitReview() {\n      var _this16 = this;\n\n      if (this.selectCompanyId !== 12) {\n        var data = {\n          'licenseId': this.selectLicenseId,\n          'auditorId': this.$store.state.user.uid,\n          'auditorName': this.reviewUser.auditorName,\n          'auditorEmail': this.reviewUser.auditorEmail,\n          'auditMsg': this.reviewText,\n          // 审核意见\n          'auditResult': this.reviewStatus === '通过' ? 1 : 0,\n          // 审核是否通过 1=通过 0=不通过\n          'auditorLevel': this.reviewUser.auditorLevel * (this.reviewType === 0 ? 1 : -1) // 审核级别 1=一审 2=二审 3=三审 -1=一级反审 -2=二级反审 -3=三级反审\n\n        };\n        this.reviewLoading = true;\n        (0, _axios.post)('/license/audit', data).then(function (response) {\n          _this16.reviewLoading = false;\n\n          if (response.status === 0) {\n            var companyLen = _this16.companyData.length;\n\n            for (var i = 0; i < companyLen; i++) {\n              if (_this16.companyData[i].companyId === _this16.selectCompanyId) {\n                switch (_this16.reviewUser.auditorLevel) {\n                  case 1:\n                    _this16.reviewCompanyContent.first = _this16.reviewText;\n                    _this16.reviewCompanyContent.firstResult = data.auditResult;\n                    _this16.companyData[i].sysLicense.firstAuditstatus = _this16.reviewType === 0 ? 1 : -1;\n                    break;\n\n                  case 2:\n                    _this16.reviewCompanyContent.second = _this16.reviewText;\n                    _this16.reviewCompanyContent.secondResult = data.auditResult;\n                    _this16.companyData[i].sysLicense.secondAuditstatus = _this16.reviewType === 0 ? 1 : -1;\n                    break;\n\n                  case 3:\n                    _this16.reviewCompanyContent.third = _this16.reviewText;\n                    _this16.reviewCompanyContent.thirdResult = data.auditResult;\n                    _this16.companyData[i].sysLicense.thirdAuditstatus = _this16.reviewType === 0 ? 1 : -1;\n                    break;\n\n                  default:\n                    break;\n                }\n              }\n            }\n\n            _this16.$message({\n              message: (_this16.reviewType === 0 ? '审批' : '反审') + '成功',\n              type: 'success',\n              duration: 3000\n            });\n          } else {\n            _this16.$message({\n              message: response.msg,\n              type: 'warning',\n              duration: 3000\n            });\n          }\n\n          _this16.cancelReview();\n        });\n      }\n    }\n  }\n};\nexports.default = _default;",null]}