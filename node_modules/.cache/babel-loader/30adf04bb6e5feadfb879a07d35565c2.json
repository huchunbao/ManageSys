{"remainingRequest":"D:\\办公\\projectwc\\前端\\ManageSys\\node_modules\\babel-loader\\lib\\index.js!D:\\办公\\projectwc\\前端\\ManageSys\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!D:\\办公\\projectwc\\前端\\ManageSys\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\办公\\projectwc\\前端\\ManageSys\\src\\views\\structure\\components\\account.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\办公\\projectwc\\前端\\ManageSys\\src\\views\\structure\\components\\account.vue","mtime":1577252313191},{"path":"D:\\办公\\projectwc\\前端\\ManageSys\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\办公\\projectwc\\前端\\ManageSys\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"D:\\办公\\projectwc\\前端\\ManageSys\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\办公\\projectwc\\前端\\ManageSys\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nrequire(\"core-js/modules/es6.function.name\");\n\nvar _axios = require(\"@/api/axios\");\n\nvar _user = require(\"@/api/user\");\n\nvar _validate = require(\"@/utils/validate\");\n\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nvar _default = {\n  name: 'Account',\n  props: {\n    userInfo: {\n      type: Object,\n      'default': null\n    }\n  },\n  data: function data() {\n    var validateMobile = function validateMobile(rule, value, callback) {\n      if (value === '') {\n        callback(new Error('请输入新手机号码'));\n      } else if (!(0, _validate.validMobile)(value)) {\n        callback(new Error('手机号输入不正确!'));\n      } else {\n        callback();\n      }\n    };\n\n    return {\n      loading: false,\n      userId: 0,\n      showCropper: false,\n      imageUrl: '',\n      imageUpdate: false,\n      imgData: {\n        accept: 'image/jpeg, image/png, image/jpg'\n      },\n      accountForm: {\n        name: '',\n        mobile: '',\n        post: '',\n        password: ''\n      },\n      accountRules: {\n        name: [{\n          required: true,\n          trigger: 'blur',\n          message: '请输入姓名'\n        }],\n        mobile: [{\n          required: true,\n          trigger: 'blur',\n          validator: validateMobile\n        }],\n        post: [{\n          required: true,\n          trigger: 'blur',\n          message: '请输入职位'\n        }],\n        password: [{\n          required: true,\n          trigger: 'blur',\n          message: '请输入密码'\n        }, {\n          min: 6,\n          message: '密码必须大于6位',\n          trigger: 'blur'\n        }]\n      }\n    };\n  },\n  created: function created() {\n    var that = this;\n\n    if (that.userInfo.type === 1) {\n      // 修改用户\n      that.userId = that.userInfo.userId;\n      that.accountForm.name = that.userInfo.cusName;\n      that.accountForm.mobile = that.userInfo.phone;\n      that.accountForm.post = that.userInfo.postName;\n      that.accountForm.password = '111111';\n      that.imageUrl = process.env.VUE_APP_BASE_API + '/user/img/' + that.userInfo.cusPic + '?t=' + new Date().getTime();\n    } else {\n      // 添加用户\n      that.accountForm.name = '';\n      that.accountForm.mobile = '';\n      that.accountForm.post = '';\n      that.accountForm.password = '';\n      that.imageUrl = '';\n    }\n  },\n  methods: {\n    getObjectURL: function getObjectURL(file) {\n      var url = null;\n\n      if (window.createObjectURL !== undefined) {\n        // basic\n        url = window.createObjectURL(file);\n      } else if (window.URL !== undefined) {\n        // mozilla(firefox)\n        url = window.URL.createObjectURL(file);\n      } else if (window.webkitURL !== undefined) {\n        // webkit or chrome\n        url = window.webkitURL.createObjectURL(file);\n      }\n\n      return url;\n    },\n    onchange: function onchange(file, fileList) {\n      var fileData = file.raw;\n      if (!fileData) return;\n      var type = fileData.type; // 文件的类型，判断是否是图片\n\n      var size = fileData.size; // 文件的大小，判断图片的大小\n\n      if (this.imgData.accept.indexOf(type) === -1 || type === '') {\n        this.$message({\n          message: '请选择jpg、jpeg、png格式图片文件',\n          type: 'warning'\n        });\n        return false;\n      }\n\n      if (size > 2097152) {\n        this.$message({\n          message: '请选择2M以下图片文件',\n          type: 'warning'\n        });\n        return false;\n      }\n\n      this.imageUpdate = true;\n      this.imageUrl = this.getObjectURL(fileData);\n    },\n    upLoadAvatar: function upLoadAvatar(params) {\n      var that = this;\n      var formData = new FormData();\n      formData.append('file', params.file);\n      (0, _user.updateAvatar)(this.userId, formData).then(function (response) {\n        that.loading = false;\n        that.$emit('submituser');\n      });\n    },\n    submit: function submit() {\n      var _this = this;\n\n      var that = this;\n      this.$refs.accountForm.validate(function (valid) {\n        if (valid) {\n          var user = {\n            cpid: that.userInfo.cpid,\n            cusName: that.accountForm.name,\n            phone: that.accountForm.mobile,\n            deptId: that.userInfo.deptId,\n            postName: that.accountForm.post,\n            cusPassword: that.accountForm.password\n          };\n          that.loading = true;\n\n          if (that.userInfo.type === 0) {\n            (0, _axios.post)('/user', user).then(function (response) {\n              if (response.status === 0) {\n                _this.userId = response.data.userId;\n\n                _this.$message({\n                  message: '添加成功',\n                  type: 'success',\n                  duration: 3000\n                });\n\n                if (_this.imageUrl !== '') {\n                  that.$refs.upload.submit();\n                } else {\n                  that.loading = false;\n                  that.$emit('submituser');\n                }\n              } else {\n                _this.$message({\n                  message: response.msg,\n                  type: 'warning',\n                  duration: 3000\n                });\n\n                that.loading = false;\n                that.$emit('submituser');\n              }\n            });\n          } else {\n            user.userId = that.userInfo.userId;\n            user.cusName = user.cusName === that.userInfo.cusName ? null : user.cusName;\n            user.phone = user.phone === that.userInfo.phone ? null : user.phone;\n            user.postName = user.postName === that.userInfo.postName ? null : user.postName;\n            user.cusPassword = null;\n            (0, _axios.put)('/user', user).then(function (response) {\n              if (response.status === 0) {\n                _this.$message({\n                  message: '修改成功',\n                  type: 'success',\n                  duration: 3000\n                });\n\n                if (_this.imageUrl !== '' && _this.imageUpdate) {\n                  that.$refs.upload.submit();\n                } else {\n                  that.loading = false;\n                  that.$emit('submituser');\n                }\n              } else {\n                _this.$message({\n                  message: response.msg,\n                  type: 'warning',\n                  duration: 3000\n                });\n\n                that.loading = false;\n                that.$emit('submituser');\n              }\n            });\n          }\n        } else {\n          return;\n        }\n      });\n    },\n    cancel: function cancel() {\n      this.$emit('canceluser');\n    },\n    handleAvatarSuccess: function handleAvatarSuccess(res, file) {\n      this.imageUrl = URL.createObjectURL(file.raw);\n    },\n    beforeAvatarUpload: function beforeAvatarUpload(file) {\n      var isJPG = file.type === 'image/jpeg';\n      var isLt2M = file.size / 1024 / 1024 < 2;\n\n      if (!isJPG) {\n        this.$message.error('上传头像图片只能是 JPG 格式!');\n      }\n\n      if (!isLt2M) {\n        this.$message.error('上传头像图片大小不能超过 2MB!');\n      }\n\n      return isJPG && isLt2M;\n    }\n  }\n};\nexports.default = _default;",null]}