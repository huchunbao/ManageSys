{"remainingRequest":"D:\\办公\\projectwc\\前端\\ManageSys\\node_modules\\thread-loader\\dist\\cjs.js!D:\\办公\\projectwc\\前端\\ManageSys\\node_modules\\babel-loader\\lib\\index.js!D:\\办公\\projectwc\\前端\\ManageSys\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!D:\\办公\\projectwc\\前端\\ManageSys\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\办公\\projectwc\\前端\\ManageSys\\src\\views\\map\\watchman.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\办公\\projectwc\\前端\\ManageSys\\src\\views\\map\\watchman.vue","mtime":1577670779933},{"path":"D:\\办公\\projectwc\\前端\\ManageSys\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\办公\\projectwc\\前端\\ManageSys\\node_modules\\thread-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\办公\\projectwc\\前端\\ManageSys\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"D:\\办公\\projectwc\\前端\\ManageSys\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\办公\\projectwc\\前端\\ManageSys\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["import \"core-js/modules/es6.function.name\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport VueAMap from 'vue-amap';\nimport { get, post } from '@/api/axios';\nvar amapManager = new VueAMap.AMapManager();\nexport default {\n  name: 'Map',\n  data: function data() {\n    return {\n      divtab: false,\n      linecolor: '#e79f3c',\n      linecolor2: '#7f85f5',\n      linetab: '1',\n      tank: '',\n      name: '',\n      bei: '',\n      zoom: 16,\n      center: [116.336496, 39.942178],\n      mapStyle1: 'amap://styles/whitesmoke',\n      amapManager: amapManager,\n      events: {},\n      overlayGroups: [],\n      data: [],\n      // table 列表数据集合\n      rowindex: '',\n      dataid: 0,\n      value: '',\n      options2: [],\n      value2: '',\n      line: '',\n      markers: []\n    };\n  },\n  computed: {\n    isopen: function isopen() {\n      return this.name && this.value2 && this.data;\n    }\n  },\n  watch: {\n    data: function data() {},\n    divtab: function divtab() {\n      if (!this.divtab) {\n        this.data = [];\n        this.name = [];\n        this.bei = [];\n        this.value2 = '';\n        this.addmarker();\n      }\n    }\n  },\n  created: function created() {\n    this.addfun();\n    this.shebei();\n    this.shua();\n  },\n  methods: {\n    handleCurrentChange: function handleCurrentChange(val) {\n      this.currentRow = val;\n      this.linetab = val.id;\n    },\n    shebei: function shebei() {\n      var _this = this;\n\n      get('/camara/getEqType?', {\n        cpid: this.$store.state.user.companyId,\n        system_id: 5\n      }).then(function (res) {\n        console.log(res);\n        _this.options2 = res;\n      });\n    },\n    shua: function shua() {\n      var _this2 = this;\n\n      get('/mngCircuitInfo/getmngcircuitinfobytype', {\n        cpid: this.$store.state.user.companyId,\n        typeid: 1\n      }).then(function (res) {\n        console.log(res);\n        var data = res.data;\n        _this2.markers = [];\n\n        for (var i = 0; i < data.length; i++) {\n          var path = [];\n\n          for (var y = 0; y < data[i].circuitpointlist.length; y++) {\n            path.push([data[i].circuitpointlist[y].circuitPointLon, data[i].circuitpointlist[y].circuitPointLat]);\n          }\n\n          _this2.markers.push({\n            id: data[i].id,\n            position: [data[i].circuitpointlist[data[i].circuitpointlist.length - 1].circuitPointLon, data[i].circuitpointlist[data[i].circuitpointlist.length - 1].circuitPointLat],\n            label: {\n              content1: data[i].circuitName,\n              linetype: data[i].circuitType\n            },\n            path: path,\n            fanglist: data[i].circuitpointlist\n          });\n        }\n\n        console.log(_this2.markers);\n      });\n    },\n    linecontent: function linecontent(index, marker) {\n      if (index + 1 === marker.path.length) {\n        return '<div style=\"height: 20px; width: 20px;color: #fff; line-height: 20px; border-radius: 20px; font-size: 12px; text-align: center; background-color: #fd3d10;margin-left:1px; margin-top: 21px;\">终<div>';\n      } else if (index === 0) {\n        return '<div style=\"height: 20px; width: 20px;color: #fff; line-height: 20px; border-radius: 20px; font-size: 12px; text-align: center; background-color: #07a803;margin-left:1px; margin-top: 21px;\">起<div>';\n      } else {\n        return '<div style=\"height: 15px; width: 15px; border: 1.5px solid  #7f85f5; border-radius: 15px; background-color: rgba(255,255,255, 1);margin-left:3px; margin-top: 23px;\"></div>';\n      }\n    },\n    bian: function bian(obj) {\n      this.divtab = !this.divtab;\n      this.linetab = obj.row.id;\n      this.name = obj.row.label.content1;\n      this.bei = obj.row.label.remark;\n      this.data = [];\n\n      for (var i = 0; i < obj.row.fanglist.length; i++) {\n        this.data.push({\n          id: obj.row.fanglist[i].id,\n          name: obj.row.fanglist[i].pointName,\n          indt: [obj.row.fanglist[i].circuitPointLon, obj.row.fanglist[i].circuitPointLat]\n        });\n      }\n    },\n    shan: function shan(obj) {\n      var _this3 = this;\n\n      console.log(obj.row.id);\n      get('/mngCircuitInfo/delmngcircuitinfobyid', {\n        id: obj.row.id\n      }).then(function (res) {\n        console.log(res);\n\n        _this3.shua();\n      });\n    },\n    ti: function ti() {\n      var _this4 = this;\n\n      if (this.name !== '' && this.value2 !== '' && this.data.length > 0) {\n        var markers = [];\n\n        for (var i = 0; i < this.data.length; i++) {\n          markers.push({\n            pointName: this.data[i].name,\n            circuitName: this.name,\n            orderNumber: i + 1,\n            circuitPointLon: this.data[i].indt[0],\n            circuitPointLat: this.data[i].indt[1]\n          });\n\n          if (this.data[i].id) {\n            markers[i].id = this.data[i].id;\n          }\n        }\n\n        var data = {\n          cpid: this.$store.state.user.companyId,\n          circuitTypeId: 1,\n          circuitType: '巡更',\n          circuitName: this.name,\n          remark: this.bei,\n          // 设备id    equimentId\n          circuitpointlist: markers,\n          equimentId: this.value2\n        };\n\n        if (this.linetab !== '') {\n          data.id = this.linetab;\n        }\n\n        post('/mngCircuitInfo/savemngcircuitinfo', data).then(function (res) {\n          post('/camara/updpoint', {\n            pid: data.equimentId * 1,\n            binding: 1\n          }).then(function (res) {\n            _this4.shebei();\n\n            _this4.shua();\n\n            _this4.divtab = !_this4.divtab;\n\n            _this4.$message({\n              message: '保存成功',\n              type: 'success'\n            });\n          });\n        });\n      } else {\n        this.$message({\n          message: '请认真检查填写项',\n          type: 'warning'\n        });\n      }\n    },\n    addfun: function addfun() {\n      var that = this;\n      this.events = {\n        init: function init(o) {\n          o.on('click', function (e) {\n            that.wei(e.lnglat.getLng(), e.lnglat.getLat(), that);\n          });\n        }\n      };\n    },\n    addmarker: function addmarker() {\n      console.log(123);\n      var that = this;\n      var o = amapManager.getMap();\n      var markers = [];\n      var open = [];\n      o.remove(that.overlayGroups);\n      o.remove(that.line);\n\n      for (var i = 0; i < that.data.length; i++) {\n        if (that.data[i].indt !== '') {\n          var marker = new AMap.Marker({\n            position: that.data[i].indt,\n            rowindex: that.rowindex,\n            text: '123',\n            icon: 'https://webapi.amap.com/theme/v1.3/markers/n/mark_b' + (markers.length + 1) + '.png'\n          });\n          open.push(that.data[i].indt);\n          markers.push(marker);\n        }\n      }\n\n      if (open.length > 1) {\n        console.log(open);\n        that.line = new AMap.Polyline({\n          map: o,\n          strokeColor: '#80d8ff',\n          isOutline: true,\n          strokeStyle: 'dashed',\n          outlineColor: 'white',\n          path: open\n        });\n      }\n\n      this.overlayGroups = new AMap.OverlayGroup(markers);\n      o.add(that.overlayGroups);\n    },\n    wei: function wei(a, b, that) {\n      console.log(that.rowindex);\n\n      if (that.rowindex !== '') {\n        that.data[that.rowindex].indt = [a, b];\n      } else {\n        that.data[that.dataid].indt = [a, b];\n      }\n\n      this.addmarker();\n    },\n    jia: function jia() {\n      this.data.push({\n        name: '',\n        indt: ''\n      });\n      this.dataid = this.data.length - 1;\n      this.rowindex = this.dataid;\n      this.$refs.singleTable.setCurrentRow(this.data[this.dataid]);\n    },\n    jian: function jian() {\n      if (this.rowindex || this.rowindex === 0) {\n        this.data.splice(this.rowindex, 1);\n      } else {\n        this.data.splice(this.dataid, 1);\n      }\n\n      this.rowindex = this.data.length - 1;\n      this.$refs.singleTable.setCurrentRow(this.data[this.data.length - 1]);\n      this.addmarker();\n    },\n    shang: function shang() {\n      if (this.dataid > 1 || this.dataid === 1) {\n        var a = this.data[this.dataid];\n        this.data[this.dataid] = this.data[this.dataid - 1];\n        this.data[this.dataid - 1] = a;\n        this.dataid -= 1;\n        this.$refs.singleTable.setCurrentRow(this.data[this.dataid]);\n      }\n\n      this.addmarker();\n    },\n    xia: function xia() {\n      console.log(this.rowindex);\n      console.log(this.dataid);\n\n      if (this.dataid !== this.data.length - 1 && this.data.length > 1) {\n        var a = this.data[this.dataid];\n        this.data[this.dataid] = this.data[this.dataid + 1];\n        this.data[this.dataid + 1] = a;\n        this.dataid += 1;\n        this.$refs.singleTable.setCurrentRow(this.data[this.dataid]);\n      }\n\n      this.addmarker();\n    },\n    indexMethod: function indexMethod(index) {\n      return index + 1;\n    },\n    tableRowClassName: function tableRowClassName(_ref) {\n      var row = _ref.row,\n          rowIndex = _ref.rowIndex;\n      row.index = rowIndex; // 把每一行的索引放进row\n    },\n    onRowClick: function onRowClick(row, event, column) {\n      var index = row.index;\n      this.rowindex = index; // 点击当前行的行数\n\n      this.dataid = index;\n      console.log(this.data);\n    }\n  }\n};",null]}