{"remainingRequest":"D:\\办公\\projectwc\\前端\\ManageSys\\node_modules\\babel-loader\\lib\\index.js!D:\\办公\\projectwc\\前端\\ManageSys\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!D:\\办公\\projectwc\\前端\\ManageSys\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\办公\\projectwc\\前端\\ManageSys\\src\\views\\structure\\index.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\办公\\projectwc\\前端\\ManageSys\\src\\views\\structure\\index.vue","mtime":1576811949891},{"path":"D:\\办公\\projectwc\\前端\\ManageSys\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\办公\\projectwc\\前端\\ManageSys\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"D:\\办公\\projectwc\\前端\\ManageSys\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\办公\\projectwc\\前端\\ManageSys\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["\"use strict\";\n\nvar _interopRequireDefault = require(\"D:\\\\\\u529E\\u516C\\\\projectwc\\\\\\u524D\\u7AEF\\\\ManageSys\\\\node_modules\\\\@babel\\\\runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nrequire(\"core-js/modules/web.dom.iterable\");\n\nrequire(\"core-js/modules/es6.function.name\");\n\nvar _objectSpread2 = _interopRequireDefault(require(\"D:\\\\\\u529E\\u516C\\\\projectwc\\\\\\u524D\\u7AEF\\\\ManageSys\\\\node_modules\\\\@babel\\\\runtime-corejs2/helpers/objectSpread2\"));\n\nvar _axios = require(\"@/api/axios\");\n\nvar _Pagination = _interopRequireDefault(require(\"@/components/Pagination\"));\n\nvar _account = _interopRequireDefault(require(\"./components/account\"));\n\nvar _role = _interopRequireDefault(require(\"./components/role\"));\n\nvar _TreeTransfer = _interopRequireDefault(require(\"./components/TreeTransfer\"));\n\nvar _vuex = require(\"vuex\");\n\nvar _validate = require(\"@/utils/validate\");\n\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nvar _default = {\n  components: {\n    Pagination: _Pagination.default,\n    Account: _account.default,\n    TreeTransfer: _TreeTransfer.default,\n    Role: _role.default\n  },\n  data: function data() {\n    var validateMobile = function validateMobile(rule, value, callback) {\n      if (value === '') {\n        callback(new Error('请输入新手机号码'));\n      } else if (!(0, _validate.validMobile)(value)) {\n        callback(new Error('手机号输入不正确!'));\n      } else {\n        callback();\n      }\n    };\n\n    return {\n      companyData: [],\n      selectCompanyNode: null,\n      companyDelBtn: false,\n      showCompany: false,\n      addCompanyForm: {\n        name: '',\n        oldName: '',\n        principal: '',\n        mobile: ''\n      },\n      addCompanyRules: {\n        name: [{\n          required: true,\n          message: '请输入公司名称',\n          trigger: 'blur'\n        }],\n        principal: [{\n          required: true,\n          message: '请输入负责人姓名',\n          trigger: 'blur'\n        }],\n        mobile: [{\n          required: true,\n          trigger: 'blur',\n          validator: validateMobile\n        }]\n      },\n      addCompanyType: 0,\n      defaultProps: {\n        children: 'children',\n        label: 'companyName'\n      },\n      showAuth: false,\n      authLoading: false,\n      selectCompanyId: 0,\n      departmentData: [],\n      showDepartment: false,\n      addDepartmentForm: {\n        name: '',\n        oldName: ''\n      },\n      addDepartmentRules: {\n        name: [{\n          required: true,\n          message: '请输入部门名称',\n          trigger: 'blur'\n        }]\n      },\n      addDepartmentType: 0,\n      selectDepartmentNode: null,\n      userData: [],\n      showUser: false,\n      addUserType: 0,\n      addUserInfo: {\n        uid: 0,\n        type: 0,\n        cpid: '',\n        deptId: '',\n        cusName: '',\n        phone: '',\n        postName: '',\n        cusPassword: '',\n        cusPic: ''\n      },\n      total: 0,\n      userLoading: false,\n      userSearchType: 0,\n      // 0是公司  1是部门\n      listQuery: {\n        page: 1,\n        limit: 5\n      },\n      showUserRole: false,\n      userRoleForm: {\n        id: 0,\n        index: -1,\n        showName: '',\n        roleId: 0\n      },\n      roleLoading: false,\n      roleData: [],\n      showRole: false,\n      addRoleId: 0,\n      addRoleType: 0,\n      addRoleName: ''\n    };\n  },\n  computed: (0, _objectSpread2.default)({}, (0, _vuex.mapGetters)(['companyId'])),\n  created: function created() {\n    this.init();\n  },\n  methods: {\n    init: function init() {\n      var _this = this;\n\n      (0, _axios.get)('/company/' + this.companyId + '/tree', null).then(function (response) {\n        if (response.status === 0) {\n          _this.companyData = response.data;\n        }\n      });\n    },\n    companyClick: function companyClick(node, all) {\n      this.selectCompanyNode = node;\n\n      if (all.level === 1) {\n        this.companyDelBtn = false;\n      } else {\n        this.companyDelBtn = true;\n      }\n\n      this.addCompanyForm.oldName = node.companyName;\n      this.showCompanyInfo(node);\n    },\n    showCompanyInfo: function showCompanyInfo(data) {\n      this.selectCompanyId = data.companyId;\n      this.getDepartmentInfo(data.companyId);\n      this.getRoleInfo(data.companyId);\n      this.getUserInfoByCompany(data.companyId, 1);\n    },\n    authCompany: function authCompany() {\n      // 授权\n      this.showAuth = true;\n    },\n    authSave: function authSave() {\n      this.authLoading = true;\n      this.$refs.treeTransfer.saveAuth();\n    },\n    authend: function authend() {\n      this.authLoading = false;\n      this.showAuth = false;\n    },\n    deleteCompany: function deleteCompany() {\n      var _this2 = this;\n\n      // 删除公司\n      if (this.selectCompanyNode === null) {\n        this.$message({\n          message: '请选择需要删除的公司',\n          type: 'warning',\n          duration: 3000\n        });\n      } else {\n        this.$confirm('是否删除公司\"' + this.selectCompanyNode.companyName + '\"', '提示', {\n          confirmButtonText: '确定',\n          cancelButtonText: '取消',\n          type: 'warning'\n        }).then(function () {\n          (0, _axios.byDelete)('/company/' + _this2.selectCompanyNode.companyId, null).then(function (response) {\n            if (response.status === 0) {\n              _this2.$refs.companyTree.remove(_this2.selectCompanyNode);\n\n              _this2.selectCompanyNode = null;\n\n              _this2.$message({\n                message: '公司删除成功',\n                type: 'success',\n                duration: 3000\n              });\n            } else {\n              _this2.$message({\n                message: '删除失败，请稍后重试',\n                type: 'warning',\n                duration: 3000\n              });\n            }\n          });\n        }).catch(function () {});\n      }\n    },\n    addCompany: function addCompany(type) {\n      // 增加、修改公司\n      this.addCompanyType = type;\n\n      if (type === 1) {\n        if (this.selectCompanyNode === null) {\n          this.$message({\n            message: '请选择需要修改的公司',\n            type: 'warning',\n            duration: 3000\n          });\n          return;\n        }\n      }\n\n      this.showCompany = true;\n    },\n    submitCompany: function submitCompany() {\n      var _this3 = this;\n\n      var that = this;\n      this.$refs.addCompanyForm.validate(function (valid) {\n        if (valid) {\n          var company = {\n            companyId: null,\n            pid: null,\n            companyName: _this3.addCompanyForm.name\n          };\n\n          if (_this3.addCompanyType === 0) {\n            if (_this3.selectCompanyNode !== null) {\n              company.pid = _this3.selectCompanyNode.companyId;\n            } else {\n              company.pid = _this3.companyId;\n            }\n\n            company.master = _this3.addCompanyForm.principal;\n            company.phone = _this3.addCompanyForm.mobile;\n            (0, _axios.post)('/company', company).then(function (response) {\n              if (response.status === 0) {\n                _this3.$message({\n                  message: '公司添加成功',\n                  type: 'success',\n                  duration: 3000\n                });\n\n                _this3.$refs.companyTree.append(response.data, response.data.pid);\n              } else {\n                _this3.$message({\n                  message: response.msg,\n                  type: 'warning',\n                  duration: 3000\n                });\n              }\n\n              that.cancelCompany();\n            });\n          } else {\n            company.companyId = _this3.selectCompanyNode.companyId;\n            company.headCpId = _this3.companyId;\n            (0, _axios.put)('/company', company).then(function (response) {\n              if (response.status === 0) {\n                _this3.companyData = response.data;\n\n                _this3.$message({\n                  message: '公司修改成功',\n                  type: 'success',\n                  duration: 3000\n                });\n              } else {\n                _this3.$message({\n                  message: response.msg,\n                  type: 'warning',\n                  duration: 3000\n                });\n              }\n\n              that.cancelCompany();\n            });\n          }\n        } else {\n          return;\n        }\n      });\n    },\n    cancelCompany: function cancelCompany() {\n      this.showCompany = false;\n      this.$refs.addCompanyForm.resetFields();\n    },\n    getDepartmentInfo: function getDepartmentInfo(companyId) {\n      var _this4 = this;\n\n      // 获取部门信息\n      (0, _axios.get)('/dept/list/' + companyId, null).then(function (response) {\n        if (response.status === 0) {\n          _this4.departmentData = response.data;\n        }\n      });\n    },\n    departmentClick: function departmentClick(node) {\n      // 部门树列表点击\n      this.selectDepartmentNode = node;\n      this.addDepartmentForm.oldName = node.name;\n      this.getUserInfoByDepartment(node.id, 1);\n    },\n    addDepartment: function addDepartment(type) {\n      if (this.selectCompanyNode === null) {\n        this.$message({\n          message: '请选择需要添加部门的公司',\n          type: 'warning',\n          duration: 3000\n        });\n      } else {\n        this.addDepartmentType = type;\n        this.showDepartment = true;\n      }\n    },\n    deleteDepartment: function deleteDepartment() {\n      var _this5 = this;\n\n      if (this.selectDepartmentNode === null) {\n        this.$message({\n          message: '请选择需要删除的部门',\n          type: 'warning',\n          duration: 3000\n        });\n      } else {\n        this.$confirm('是否删除部门\"' + this.selectDepartmentNode.name + '\"', '提示', {\n          confirmButtonText: '确定',\n          cancelButtonText: '取消',\n          type: 'warning'\n        }).then(function () {\n          (0, _axios.byDelete)('/dept/' + _this5.selectDepartmentNode.id, null).then(function (response) {\n            if (response.status === 0) {\n              _this5.$refs.departmentTree.remove(_this5.selectDepartmentNode.id);\n\n              _this5.selectDepartmentNode = null;\n\n              _this5.$message({\n                message: '部门删除成功',\n                type: 'success',\n                duration: 3000\n              });\n            } else {\n              _this5.$message({\n                message: response.msg,\n                type: 'warning',\n                duration: 3000\n              });\n            }\n          });\n        }).catch(function () {});\n      }\n    },\n    getUserInfoByDepartment: function getUserInfoByDepartment(departmentId, number) {\n      var _this6 = this;\n\n      // 根据部门id获取用户列表\n      this.userLoading = true;\n      this.userSearchType = 1;\n      (0, _axios.get)('/user/page/dp' + departmentId, {\n        size: this.listQuery.limit,\n        page: number - 1\n      }).then(function (response) {\n        _this6.userLoading = false;\n\n        if (response.status === 0) {\n          _this6.total = response.data.totalElements;\n          _this6.userData = response.data.content;\n        }\n      });\n    },\n    submitDepartment: function submitDepartment() {\n      var _this7 = this;\n\n      var that = this;\n      this.$refs.addDepartmentForm.validate(function (valid) {\n        if (valid) {\n          var department = {\n            id: null,\n            cpid: null,\n            name: _this7.addDepartmentForm.name\n          };\n\n          if (_this7.addDepartmentType === 0) {\n            department.cpid = _this7.selectCompanyNode.companyId;\n            (0, _axios.post)('/dept', department).then(function (response) {\n              if (response.status === 0) {\n                _this7.$message({\n                  message: '部门添加成功',\n                  type: 'success',\n                  duration: 3000\n                });\n\n                _this7.$refs.departmentTree.append(response.data, 0);\n              } else {\n                _this7.$message({\n                  message: '添加失败，请稍后重试',\n                  type: 'warning',\n                  duration: 3000\n                });\n              }\n\n              that.cancelDepartment();\n            });\n          } else {\n            (0, _axios.put)('/dept/' + _this7.selectDepartmentNode.id + '/' + _this7.selectCompanyNode.companyId + '/' + _this7.addDepartmentForm.name, null).then(function (response) {\n              if (response.status === 0) {\n                _this7.departmentData = response.data;\n\n                _this7.$message({\n                  message: '部门修改成功',\n                  type: 'success',\n                  duration: 3000\n                });\n              } else {\n                _this7.$message({\n                  message: '添加失败，请稍后重试',\n                  type: 'warning',\n                  duration: 3000\n                });\n              }\n\n              that.cancelDepartment();\n            });\n          }\n        } else {\n          return;\n        }\n      });\n    },\n    cancelDepartment: function cancelDepartment() {\n      this.showDepartment = false;\n      this.$refs.addDepartmentForm.resetFields();\n    },\n    addUser: function addUser(type) {\n      if (this.selectDepartmentNode === null) {\n        this.$message({\n          message: '请选择需要添加用户的部门',\n          type: 'warning',\n          duration: 3000\n        });\n      } else {\n        this.addUserInfo.cpid = this.selectCompanyNode.companyId;\n        this.addUserInfo.deptId = this.selectDepartmentNode.id;\n        this.addUserInfo.type = type;\n        this.addUserType = type;\n        this.showUser = true;\n      }\n    },\n    deleteUser: function deleteUser() {\n      var _this8 = this;\n\n      var users = this.$refs.userTable.selection;\n\n      if (users.length > 0) {\n        this.$confirm('确定删除勾选的用户吗？', '提示', {\n          confirmButtonText: '确定',\n          cancelButtonText: '取消',\n          type: 'warning'\n        }).then(function () {\n          var delList = [];\n          users.forEach(function (item) {\n            delList.push(item.userId);\n          });\n          (0, _axios.byDelete)('/user/ids', delList).then(function (response) {\n            if (response.status === 0) {\n              _this8.$message({\n                message: '用户删除成功',\n                type: 'success',\n                duration: 3000\n              });\n            } else {\n              _this8.$message({\n                message: response.msg,\n                type: 'warning',\n                duration: 3000\n              });\n            }\n          });\n        });\n      } else {\n        this.$message({\n          message: '请勾选需要删除的用户',\n          type: 'warning',\n          duration: 3000\n        });\n      }\n    },\n    updateUser: function updateUser(user) {\n      this.addUserInfo.cpid = user.row.cpid;\n      this.addUserInfo.deptId = user.row.deptId;\n      this.addUserInfo.userId = user.row.userId;\n      this.addUserInfo.cusName = user.row.cusName;\n      this.addUserInfo.phone = user.row.phone;\n      this.addUserInfo.postName = user.row.postName;\n      this.addUserInfo.cusPic = user.row.cusPic;\n      this.addUserInfo.type = 1;\n      this.addUserType = 1;\n      this.showUser = true;\n    },\n    handleDD: function handleDD(data) {\n      // 角色下拉菜单\n      this.userRoleForm.showName = data.showName;\n      this.userRoleForm.roleId = data.id;\n    },\n    cancelUserRole: function cancelUserRole() {\n      // 修改角色取消\n      this.userRoleForm.id = 0;\n      this.userRoleForm.index = -1;\n      this.userRoleForm.showName = '';\n      this.userRoleForm.roleId = 0;\n      this.showUserRole = false;\n    },\n    updateUserRole: function updateUserRole(user) {\n      this.userRoleForm.id = user.row.userId;\n      this.userRoleForm.index = user.$index;\n      this.userRoleForm.showName = user.row.roleList.length > 0 ? user.row.roleList[0].showName : '';\n      this.showUserRole = true;\n    },\n    submitUserRole: function submitUserRole() {\n      var _this9 = this;\n\n      if (this.userRoleForm.roleId <= 0) {\n        this.$message({\n          message: '请选择角色',\n          type: 'warning',\n          duration: 3000\n        });\n      } else {\n        (0, _axios.put)('/user/' + this.userRoleForm.id + '/' + this.userRoleForm.roleId, null).then(function (response) {\n          if (response.status === 0) {\n            if (_this9.userData[_this9.userRoleForm.index].roleList.length > 0) {\n              _this9.userData[_this9.userRoleForm.index].roleList[0].showName = _this9.userRoleForm.showName;\n            } else {\n              _this9.userData[_this9.userRoleForm.index].roleList.push({\n                id: _this9.userRoleForm.roleId,\n                showName: _this9.userRoleForm.showName\n              });\n            }\n\n            _this9.$message({\n              message: '用户角色修改成功',\n              type: 'success',\n              duration: 3000\n            });\n          } else {\n            _this9.$message({\n              message: response.msg,\n              type: 'warning',\n              duration: 3000\n            });\n          }\n\n          _this9.showUserRole = false;\n        });\n      }\n    },\n    deleteUserById: function deleteUserById(user) {\n      var _this10 = this;\n\n      this.$confirm('确定删除用户\"' + user.row.cusName + '\"吗？', '提示', {\n        confirmButtonText: '确定',\n        cancelButtonText: '取消',\n        type: 'warning'\n      }).then(function () {\n        (0, _axios.byDelete)('/user/' + user.row.userId, null).then(function (response) {\n          if (response.status === 0) {\n            _this10.$message({\n              message: '用户\"' + user.row.cusName + '\"删除成功',\n              type: 'success',\n              duration: 3000\n            });\n\n            _this10.userData.splice(user.$index);\n          } else {\n            _this10.$message({\n              message: response.msg,\n              type: 'warning',\n              duration: 3000\n            });\n          }\n        });\n      });\n    },\n    resetPassword: function resetPassword(user) {\n      var _this11 = this;\n\n      this.$confirm('确定重置用户\"' + user.row.cusName + '\"的密码吗？', '提示', {\n        confirmButtonText: '确定',\n        cancelButtonText: '取消',\n        type: 'warning'\n      }).then(function () {\n        (0, _axios.put)('/user/reset/' + user.row.userId, null).then(function (response) {\n          if (response.status === 0) {\n            _this11.$message({\n              message: '用户\"' + user.row.cusName + '\"密码重置成功',\n              type: 'success',\n              duration: 3000\n            });\n          } else {\n            _this11.$message({\n              message: response.msg,\n              type: 'warning',\n              duration: 3000\n            });\n          }\n        });\n      });\n    },\n    submitUser: function submitUser() {\n      this.showUser = false;\n\n      if (this.userSearchType === 0) {\n        // 公司\n        this.getUserInfoByCompany(this.selectCompanyId, this.listQuery.page);\n      } else {\n        this.getUserInfoByDepartment(this.selectDepartmentNode.id, this.listQuery.page);\n      }\n    },\n    getUserInfoByCompany: function getUserInfoByCompany(companyId, number) {\n      var _this12 = this;\n\n      // 根据公司id获取用户列表\n      this.userLoading = true;\n      this.userSearchType = 0;\n      (0, _axios.get)('/user/page/cp' + companyId, {\n        size: this.listQuery.limit,\n        page: number - 1\n      }).then(function (response) {\n        _this12.userLoading = false;\n\n        if (response.status === 0) {\n          _this12.total = response.data.totalElements;\n          _this12.userData = response.data.content;\n        }\n      });\n    },\n    pageChange: function pageChange(page) {\n      if (this.userSearchType === 0) {\n        // 公司\n        this.getUserInfoByCompany(this.selectCompanyId, page[0].page);\n      } else {\n        this.getUserInfoByDepartment(this.selectDepartmentNode.id, page[0].page);\n      }\n    },\n    getRoleInfo: function getRoleInfo(companyId) {\n      var _this13 = this;\n\n      // 获取角色列表\n      this.roleLoading = true;\n      (0, _axios.get)('/role/list/' + companyId, null).then(function (response) {\n        _this13.roleLoading = false;\n\n        if (response.status === 0) {\n          _this13.roleData = response.data;\n        }\n      });\n    },\n    addRole: function addRole() {\n      if (this.selectCompanyNode === null) {\n        this.$message({\n          message: '请选择需要添加角色的公司',\n          type: 'warning',\n          duration: 3000\n        });\n      } else {\n        this.addRoleType = 0;\n        this.addRoleId = 0;\n        this.addRoleName = '';\n        this.showRole = true;\n      }\n    },\n    updateRole: function updateRole(data) {\n      this.addRoleType = 1;\n      this.addRoleId = data.id;\n      this.addRoleName = data.showName;\n      this.showRole = true;\n    },\n    deleteRole: function deleteRole(data) {\n      var _this14 = this;\n\n      this.$confirm('确定删除角色\"' + data.showName + '\"吗？', '提示', {\n        confirmButtonText: '确定',\n        cancelButtonText: '取消',\n        type: 'warning'\n      }).then(function () {\n        (0, _axios.post)('/role/del/' + data.id, null).then(function (response) {\n          if (response.status === 0) {\n            _this14.getRoleInfo(_this14.selectCompanyId);\n\n            _this14.$message({\n              message: '角色\"' + data.showName + '\"删除成功',\n              type: 'success',\n              duration: 3000\n            });\n          } else {\n            _this14.$message({\n              message: response.msg,\n              type: 'warning',\n              duration: 3000\n            });\n          }\n        });\n      });\n    },\n    submitRole: function submitRole() {\n      this.showRole = false;\n      this.getRoleInfo(this.selectCompanyId);\n    }\n  }\n};\nexports.default = _default;",null]}