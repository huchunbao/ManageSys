{"remainingRequest":"D:\\办公\\projectwc\\前端\\ManageSys\\node_modules\\thread-loader\\dist\\cjs.js!D:\\办公\\projectwc\\前端\\ManageSys\\node_modules\\babel-loader\\lib\\index.js!D:\\办公\\projectwc\\前端\\ManageSys\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!D:\\办公\\projectwc\\前端\\ManageSys\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\办公\\projectwc\\前端\\ManageSys\\src\\views\\system\\index.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\办公\\projectwc\\前端\\ManageSys\\src\\views\\system\\index.vue","mtime":1577252313041},{"path":"D:\\办公\\projectwc\\前端\\ManageSys\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\办公\\projectwc\\前端\\ManageSys\\node_modules\\thread-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\办公\\projectwc\\前端\\ManageSys\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"D:\\办公\\projectwc\\前端\\ManageSys\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\办公\\projectwc\\前端\\ManageSys\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["import \"core-js/modules/es6.function.name\";\nimport \"core-js/modules/web.dom.iterable\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport { get, post, put, byDelete } from '@/api/axios';\nimport SetDialog from \"./components/SetDialog\";\nimport AddDialog from \"./components/AddDialog\";\nexport default {\n  components: {\n    SetDialog: SetDialog,\n    AddDialog: AddDialog\n  },\n  data: function data() {\n    return {\n      companyId: this.$store.state.user.companyId,\n      // 公司ID\n      manager: '',\n      // 维修管理员\n      bearer: '',\n      // 承载量告警审核人\n      dev: '',\n      // 设备告警审核人\n      integral: {\n        // 积分换算\n        count: '',\n        money: 1,\n        save: true\n      },\n      showDlg: false,\n      // 弹窗显示状态\n      setType: 0,\n      // 0 添加  1 需改\n      dlgTitle: '',\n      // 弹窗标题\n      dlgShowName: '',\n      // 弹窗label\n      dlgUserList: [],\n      // 人员列表\n      tabIndex: 0,\n      // 地图点位 0 设备  1 场所\n      devData: [],\n      // 设备地图点位\n      placeData: [],\n      // 场所地图点位\n      selectDevRow: null,\n      // 设备地图点位当前选中\n      selectPlaceRow: null,\n      // 场所地图点位当前选中\n      templateSave: true,\n      // 模板保存状态\n      channelData: [],\n      // 渠道列表\n      selectChannelRow: null,\n      // 渠道列表当前选中\n      channelText: '',\n      // 渠道模板内容\n      channelEditStatus: true,\n      // 渠道编辑状态\n      channelEditLoading: false,\n      // 渠道保存Loading\n      planData: [],\n      // 方案列表\n      selectPlanRow: null,\n      // 方案列表当前选中\n      planValue: [],\n      // 方案列表当前选中项的渠道\n      showPlanDlg: false,\n      // 添加方案界面显示状态\n      dlgPlanTitle: '',\n      // 添加方案标题\n      planLoading: false,\n      // 添加方案Loading\n      showAddDlg: false,\n      // 添加界面显示状态\n      dlgAddTitle: '',\n      // 添加界面标题\n      addText: '',\n      // 添加名称\n      addType: 0 // 1设备 2场所 3渠道 4方案\n\n    };\n  },\n  created: function created() {\n    this.init();\n  },\n  methods: {\n    init: function init() {\n      var _this = this;\n\n      get('/property/' + this.companyId, null).then(function (response) {\n        // 维修员管理 承载量告警审核人 设备告警审核人 积分兑换\n        if (response.status === 0) {\n          _this.manager = response.data.propValue;\n          response.data.forEach(function (item) {\n            switch (item.propName) {\n              case 'repair.clerk.name':\n                // 维修人员\n                _this.manager = item.propValue;\n                break;\n\n              case 'alarm.load-volume.auditor.name':\n                // 承载量审核\n                _this.bearer = item.propValue;\n                break;\n\n              case 'alarm.equipment.auditor.name':\n                // 设备审核\n                _this.dev = item.propValue;\n                break;\n\n              case 'point.ratio':\n                // 积分兑换\n                _this.integral.count = item.propValue;\n                break;\n\n              default:\n                break;\n            }\n          });\n        }\n      });\n      this.initMapPoint(); // 显示地图点位列表\n\n      this.initChannel(); // 显示渠道列表\n\n      this.initPlan(); // 显示通知方案列表\n\n      get('/user/list/cp' + this.companyId, null).then(function (response) {\n        // 所有人员\n        if (response.status === 0) {\n          _this.dlgUserList = response.data;\n        }\n      });\n    },\n    initMapPoint: function initMapPoint() {\n      var _this2 = this;\n\n      get('/mngpoint/point-type/' + this.companyId, null).then(function (response) {\n        // 获取地图点位\n        if (response.status === 0) {\n          console.log(response.data);\n          _this2.devData = [];\n          _this2.placeData = [];\n\n          if (response.data.length > 0) {\n            response.data.forEach(function (item) {\n              switch (item.typeProperties) {\n                case 1:\n                  break;\n\n                case 2:\n                  _this2.placeData.push({\n                    id: item.id,\n                    name: item.typeName\n                  });\n\n                  break;\n\n                case 3:\n                  _this2.devData.push({\n                    id: item.id,\n                    name: item.typeName\n                  });\n\n                  break;\n\n                case 4:\n                  break;\n\n                default:\n                  break;\n              }\n            });\n          }\n        }\n      });\n    },\n    initChannel: function initChannel() {\n      var _this3 = this;\n\n      get('/notify-template/' + this.companyId, null).then(function (response) {\n        // 获取渠道通知模板\n        if (response.status === 0) {\n          _this3.channelData = response.data;\n        }\n      });\n    },\n    initPlan: function initPlan() {\n      var _this4 = this;\n\n      get('/notify-scheme/' + this.companyId, null).then(function (response) {\n        // 获取通知方案\n        if (response.status === 0) {\n          _this4.planData = response.data;\n        }\n      });\n    },\n    getPlanItem: function getPlanItem(row, column) {\n      // 获取通知方案渠道\n      var plan = '';\n      row.models.forEach(function (item) {\n        plan += item.wayName + '+';\n      });\n      return plan.substring(0, plan.length - 1);\n    },\n    setPerson: function setPerson(type) {\n      // 显示设置人员界面\n      switch (type) {\n        case 1:\n          this.dlgTitle = '维修管理员设置';\n          this.dlgShowName = this.manager;\n          break;\n\n        case 2:\n          this.dlgTitle = '承载量告警审核人设置';\n          this.dlgShowName = this.bearer;\n          break;\n\n        case 3:\n          this.dlgTitle = '设备告警审核人设置';\n          this.dlgShowName = this.dev;\n          break;\n\n        default:\n          break;\n      }\n\n      this.setType = type;\n      this.showDlg = true;\n    },\n    submitDlg: function submitDlg(data) {\n      var _this5 = this;\n\n      // 提交人员设置\n      var url = '';\n\n      switch (this.setType) {\n        case 1:\n          url = '/property/repair-clerk/name';\n          break;\n\n        case 2:\n          url = '/property/load-volume-auditor/name';\n          break;\n\n        case 3:\n          url = '/property/equip-auditor/name';\n          break;\n\n        default:\n          break;\n      }\n\n      var user = {\n        cpid: this.companyId,\n        propValue: data[0].showName\n      };\n      put(url, user).then(function (response) {\n        if (response.status === 0) {\n          switch (_this5.setType) {\n            case 1:\n              _this5.manager = data[0].showName;\n              break;\n\n            case 2:\n              _this5.bearer = data[0].showName;\n              break;\n\n            case 3:\n              _this5.dev = data[0].showName;\n              break;\n\n            default:\n              break;\n          }\n\n          _this5.$message({\n            message: '人员设置成功',\n            type: 'success',\n            duration: 3000\n          });\n        } else {\n          _this5.$message({\n            message: response.msg,\n            type: 'warning',\n            duration: 3000\n          });\n        }\n\n        _this5.showDlg = false;\n      });\n    },\n    editIntegral: function editIntegral() {\n      // 积分设置状态\n      this.integral.save = false;\n    },\n    saveIntegral: function saveIntegral() {\n      var _this6 = this;\n\n      // 保存积分修改\n      if (this.integral.count === '') {\n        this.$message({\n          message: '请输入积分',\n          type: 'warning',\n          duration: 3000\n        });\n      } else {\n        put('/property/' + this.companyId + '/point-ratio?ratio=' + this.integral.count, null).then(function (response) {\n          if (response.status === 0) {\n            _this6.$message({\n              message: '积分保存成功',\n              type: 'success',\n              duration: 3000\n            });\n\n            _this6.integral.save = true;\n          } else {\n            _this6.$message({\n              message: response.msg,\n              type: 'warning',\n              duration: 3000\n            });\n          }\n        });\n      }\n    },\n    changeTab: function changeTab(index) {\n      // 地图点位tab切换\n      this.tabIndex = index;\n\n      if (this.tabIndex === 0) {\n        this.selectPlaceRow = null;\n      } else {\n        this.selectDevRow = null;\n      }\n    },\n    clickDev: function clickDev(row) {\n      // 设备地图点位点击事件\n      this.selectDevRow = row;\n    },\n    clickPlace: function clickPlace(row) {\n      // 场所地图点位点击事件\n      this.selectPlaceRow = row;\n    },\n    addMapPoint: function addMapPoint() {\n      // 显示添加点位界面\n      this.addType = this.tabIndex + 1;\n      this.dlgAddTitle = '地图点位添加' + (this.tabIndex === 0 ? '(设备)' : '(场所)');\n      this.addText = '点位';\n      this.showAddDlg = true;\n    },\n    deleteMapPoint: function deleteMapPoint() {\n      var _this7 = this;\n\n      // 删除地图点位\n      var row = null;\n\n      if (this.tabIndex === 0) {\n        row = this.selectDevRow;\n      } else {\n        row = this.selectPlaceRow;\n      }\n\n      if (row === null) {\n        this.$message({\n          message: '请选择需要删除的地图点位',\n          type: 'warning',\n          duration: 3000\n        });\n      } else {\n        this.$confirm('是否删除地图点位\"' + row.name + '\"', '提示', {\n          confirmButtonText: '确定',\n          cancelButtonText: '取消',\n          type: 'warning'\n        }).then(function () {\n          byDelete('/mngpoint/delPointType?id=' + row.id, null).then(function (response) {\n            if (response.status === 0) {\n              _this7.$message({\n                message: '地图点位删除成功',\n                type: 'success',\n                duration: 3000\n              });\n\n              if (_this7.tabIndex === 0) {\n                _this7.devData.some(function (item, i) {\n                  if (item.id === row.id) {\n                    _this7.devData.splice(i, 1);\n\n                    return true;\n                  }\n                });\n\n                _this7.selectDevRow = null;\n              } else {\n                _this7.placeData.some(function (item, i) {\n                  if (item.id === row.id) {\n                    _this7.placeData.splice(i, 1);\n\n                    return true;\n                  }\n                });\n\n                _this7.selectPlaceRow = null;\n              }\n            } else {\n              _this7.$message({\n                message: response.msg,\n                type: 'warning',\n                duration: 3000\n              });\n            }\n          });\n        });\n      }\n    },\n    submitAddDlg: function submitAddDlg(data) {\n      var _this8 = this;\n\n      // 提交添加\n      var url = '';\n      var form = {\n        cpid: this.companyId\n      };\n\n      switch (this.addType) {\n        case 1:\n          url = '/mngpoint/savePointType'; // 地图设备\n\n          form.typeProperties = 3;\n          form.typeName = data[0];\n          break;\n\n        case 2:\n          url = '/mngpoint/savePointType'; // 地图场所\n\n          form.typeProperties = 2;\n          form.typeName = data[0];\n          break;\n\n        case 3:\n          url = '/notify-template'; // 模板\n\n          form.wayName = data[0];\n          form.content = '';\n          break;\n\n        case 4:\n          url = '/notify-scheme'; // 方案\n\n          form.wayName = data[0];\n          break;\n\n        default:\n          break;\n      }\n\n      post(url, form).then(function (response) {\n        if (response.status === 0) {\n          _this8.$message({\n            message: _this8.addText + '添加成功',\n            type: 'success',\n            duration: 3000\n          });\n\n          switch (_this8.addType) {\n            case 1:\n            case 2:\n              _this8.initMapPoint();\n\n              break;\n\n            case 3:\n              _this8.initChannel();\n\n              break;\n\n            case 4:\n              _this8.initPlan();\n\n              break;\n\n            default:\n              break;\n          }\n\n          _this8.showAddDlg = false;\n        } else {\n          _this8.$message({\n            message: response.msg,\n            type: 'warning',\n            duration: 3000\n          });\n        }\n      });\n    },\n    addChannel: function addChannel() {\n      // 显示添加渠道界面\n      this.addType = 3;\n      this.dlgAddTitle = '渠道通知模板添加';\n      this.addText = '渠道';\n      this.showAddDlg = true;\n    },\n    deleteChannel: function deleteChannel() {\n      var _this9 = this;\n\n      // 删除渠道\n      if (this.selectChannelRow === null) {\n        this.$message({\n          message: '请选择需要删除的渠道',\n          type: 'warning',\n          duration: 3000\n        });\n      } else {\n        this.$confirm('是否删除渠道\"' + this.selectChannelRow.wayName + '\"', '提示', {\n          confirmButtonText: '确定',\n          cancelButtonText: '取消',\n          type: 'warning'\n        }).then(function () {\n          byDelete('/notify-template/' + _this9.selectChannelRow.id, null).then(function (response) {\n            if (response.status === 0) {\n              _this9.$message({\n                message: '渠道\"' + _this9.selectChannelRow.wayName + '\"删除成功',\n                type: 'success',\n                duration: 3000\n              });\n\n              _this9.channelData.some(function (item, i) {\n                if (item.id === _this9.selectChannelRow.id) {\n                  _this9.channelData.splice(i, 1);\n\n                  return true;\n                }\n              });\n\n              _this9.selectChannelRow = null;\n              _this9.channelText = '';\n            } else {\n              _this9.$message({\n                message: response.msg,\n                type: 'warning',\n                duration: 3000\n              });\n            }\n          });\n        }).catch(function () {});\n      }\n    },\n    clickChannel: function clickChannel(row) {\n      // 点击渠道\n      this.selectChannelRow = row;\n      this.channelText = row.content;\n    },\n    editChannel: function editChannel() {\n      // 编辑渠道内容\n      if (this.selectChannelRow === null) {\n        this.$message({\n          message: '请选择需要编辑的渠道',\n          type: 'warning',\n          duration: 3000\n        });\n      } else {\n        this.templateSave = false;\n      }\n    },\n    saveChannel: function saveChannel() {\n      var _this10 = this;\n\n      // 保存渠道内容\n      if (this.channelText === '') {\n        this.$message({\n          message: '请输入模板内容',\n          type: 'warning',\n          duration: 3000\n        });\n      } else {\n        this.channelEditLoading = true;\n        put('/notify-template', {\n          id: this.selectChannelRow.id,\n          content: this.channelText\n        }).then(function (response) {\n          if (response.status === 0) {\n            _this10.$message({\n              message: '模板修改成功',\n              type: 'success',\n              duration: 3000\n            });\n\n            _this10.selectChannelRow.content = _this10.channelText;\n            _this10.templateSave = true;\n            _this10.channelEditLoading = false;\n          } else {\n            _this10.$message({\n              message: response.msg,\n              type: 'warning',\n              duration: 3000\n            });\n          }\n        });\n      }\n    },\n    addPlan: function addPlan() {\n      // 显示添加方案界面\n      this.addType = 4;\n      this.dlgAddTitle = '通知方案添加';\n      this.addText = '方案';\n      this.showAddDlg = true;\n    },\n    clickPlan: function clickPlan(row) {\n      // 点击方案列表\n      this.selectPlanRow = row;\n    },\n    deletePlan: function deletePlan() {\n      var _this11 = this;\n\n      // 删除方案\n      if (this.selectPlanRow === null) {\n        this.$message({\n          message: '请选择需要删除的方案',\n          type: 'warning',\n          duration: 3000\n        });\n      } else {\n        this.$confirm('是否删除方案\"' + this.selectPlanRow.wayName + '\"', '提示', {\n          confirmButtonText: '确定',\n          cancelButtonText: '取消',\n          type: 'warning'\n        }).then(function () {\n          byDelete('/notify-scheme/' + _this11.selectPlanRow.id, null).then(function (response) {\n            if (response.status === 0) {\n              _this11.$message({\n                message: '方案\"' + _this11.selectPlanRow.wayName + '\"删除成功',\n                type: 'success',\n                duration: 3000\n              });\n\n              _this11.planData.some(function (item, i) {\n                if (item.id === _this11.selectPlanRow.id) {\n                  _this11.planData.splice(i, 1);\n\n                  return true;\n                }\n              });\n\n              _this11.selectPlanRow = null;\n            } else {\n              _this11.$message({\n                message: response.msg,\n                type: 'warning',\n                duration: 3000\n              });\n            }\n          });\n        }).catch(function () {});\n      }\n    },\n    updatePlan: function updatePlan(row) {\n      var _this12 = this;\n\n      // 修改方案渠道\n      this.dlgPlanTitle = row.row.wayName + '渠道设置';\n      row.row.models.forEach(function (item) {\n        _this12.planValue.push(item.id);\n      });\n      this.showPlanDlg = true;\n    },\n    submitPlan: function submitPlan() {\n      var _this13 = this;\n\n      // 提交方案渠道\n      if (this.planValue.length <= 0) {\n        this.$message({\n          message: '请选择渠道',\n          type: 'warning',\n          duration: 3000\n        });\n      } else {\n        this.planLoading = true;\n        var form = {\n          id: this.selectPlanRow.id,\n          models: []\n        };\n        this.planValue.forEach(function (item) {\n          form.models.push({\n            id: item\n          });\n        });\n        put('/notify-scheme', form).then(function (response) {\n          if (response.status === 0) {\n            _this13.$message({\n              message: '方案设置成功',\n              type: 'success',\n              duration: 3000\n            });\n\n            _this13.selectPlanRow = null;\n            _this13.planValue = [];\n            _this13.planLoading = false;\n\n            _this13.initPlan();\n\n            _this13.showPlanDlg = false;\n          } else {\n            _this13.$message({\n              message: response.msg,\n              type: 'warning',\n              duration: 3000\n            });\n          }\n        });\n      }\n    }\n  }\n};",null]}