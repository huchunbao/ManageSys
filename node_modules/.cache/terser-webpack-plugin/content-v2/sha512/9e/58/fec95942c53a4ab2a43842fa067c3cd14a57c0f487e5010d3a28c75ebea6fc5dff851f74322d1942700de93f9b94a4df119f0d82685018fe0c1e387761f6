{"code":"(window[\"webpackJsonp\"]=window[\"webpackJsonp\"]||[]).push([[\"chunk-6da35f2b\",\"chunk-01b88618\",\"chunk-63ca6359\",\"chunk-75970d09\"],{\"09f4\":function(e,t,a){\"use strict\";a.d(t,\"a\",function(){return r}),Math.easeInOutQuad=function(e,t,a,n){return e/=n/2,e<1?a/2*e*e+t:(e--,-a/2*(e*(e-2)-1)+t)};var n=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60)}}();function s(e){document.documentElement.scrollTop=e,document.body.parentNode.scrollTop=e,document.body.scrollTop=e}function o(){return document.documentElement.scrollTop||document.body.parentNode.scrollTop||document.body.scrollTop}function r(e,t,a){var r=o(),i=e-r,l=20,c=0;t=\"undefined\"===typeof t?500:t;var u=function e(){c+=l;var o=Math.easeInOutQuad(c,r,i,t);s(o),c<t?n(e):a&&\"function\"===typeof a&&a()};u()}},\"0d5e\":function(e,t,a){\"use strict\";a.d(t,\"b\",function(){return s}),a.d(t,\"c\",function(){return o}),a.d(t,\"d\",function(){return r}),a.d(t,\"a\",function(){return i});var n=a(\"b775\");function s(e,t){return Object(n[\"a\"])({url:e,method:\"get\",params:t})}function o(e,t){return Object(n[\"a\"])({url:e,method:\"post\",data:t})}function r(e,t){return Object(n[\"a\"])({url:e,method:\"put\",data:t})}function i(e,t){return Object(n[\"a\"])({url:e,method:\"delete\",data:t})}},\"12b5\":function(e,t,a){},\"177e\":function(e,t,a){},\"1ad2\":function(e,t,a){\"use strict\";var n=a(\"ed5b\"),s=a.n(n);s.a},\"31ce\":function(e,t,a){\"use strict\";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a(\"div\",{staticClass:\"role-container\"},[a(\"div\",{staticClass:\"role-wapper\"},[a(\"div\",{staticClass:\"role-top\"},[a(\"div\",{staticClass:\"f-l\"},[a(\"el-form\",{ref:\"addRoleForm\",attrs:{model:e.addRoleForm,rules:e.addRoleRules,\"hide-required-asterisk\":\"\",\"label-width\":\"80px\",autocomplete:\"off\",size:\"mini\"}},[a(\"el-form-item\",{attrs:{label:\"角色名称\",prop:\"name\"}},[a(\"el-input\",{attrs:{clearable:\"\",placeholder:\"角色名称\"},model:{value:e.addRoleForm.name,callback:function(t){e.$set(e.addRoleForm,\"name\",t)},expression:\"addRoleForm.name\"}})],1)],1)],1),e._v(\" \"),a(\"el-button\",{staticClass:\"el-button-default company-info-btn f-r\",staticStyle:{\"margin-left\":\"20px\"},attrs:{round:\"\",size:\"mini\"},on:{click:e.cancelRole}},[e._v(\"取消\")]),e._v(\" \"),a(\"el-button\",{staticClass:\"company-info-btn f-r\",attrs:{round:\"\",loading:e.loading,size:\"mini\",type:\"primary\"},on:{click:e.saveRole}},[e._v(\"保存\")])],1),e._v(\" \"),a(\"el-row\",{staticClass:\"first-row\",attrs:{gutter:15}},[a(\"el-col\",{attrs:{span:7}},[a(\"div\",{staticClass:\"company bg\"},[a(\"div\",{staticClass:\"auth-tree-title\"},[e._v(\"系统模块\")]),e._v(\" \"),a(\"el-scrollbar\",{staticClass:\"company-tree\"},[a(\"el-tree\",{ref:\"sysTree\",attrs:{data:e.sysData,props:e.defaultProps,\"node-key\":\"id\",\"empty-text\":e.companyLoading,\"highlight-current\":\"\",\"show-checkbox\":\"\",\"default-expand-all\":\"\"},on:{\"node-click\":e.sysClick}})],1)],1)]),e._v(\" \"),a(\"el-col\",{attrs:{span:17}},[a(\"div\",{staticClass:\"function-table\"},[a(\"el-table\",{ref:\"functionTable\",staticStyle:{width:\"100%\"},attrs:{data:e.functionData,\"max-height\":\"100%\",height:\"100%\",\"header-row-class-name\":\"car-table-header\",\"row-class-name\":\"car-table-item\",\"highlight-current-row\":\"\"}},[a(\"el-table-column\",{attrs:{prop:\"name\",label:\"功能\",width:\"auto\",\"class-name\":\"function-table-begin\"}}),e._v(\" \"),a(\"el-table-column\",{attrs:{label:\"游览\",width:\"70\",\"class-name\":\"role-select\"},scopedSlots:e._u([{key:\"default\",fn:function(t){return[a(\"el-checkbox\",{on:{change:function(a){var n=arguments.length,s=Array(n);while(n--)s[n]=arguments[n];return e.handleCheck.apply(void 0,[t].concat(s,[\"rightSelect\"]))}},model:{value:t.row.roleFuncAuth.rightSelect,callback:function(a){e.$set(t.row.roleFuncAuth,\"rightSelect\",a)},expression:\"scope.row.roleFuncAuth.rightSelect\"}})]}}])}),e._v(\" \"),a(\"el-table-column\",{attrs:{label:\"新建\",width:\"70\"},scopedSlots:e._u([{key:\"default\",fn:function(t){return[a(\"el-checkbox\",{on:{change:function(a){var n=arguments.length,s=Array(n);while(n--)s[n]=arguments[n];return e.handleCheck.apply(void 0,[t].concat(s,[\"rightInsert\"]))}},model:{value:t.row.roleFuncAuth.rightInsert,callback:function(a){e.$set(t.row.roleFuncAuth,\"rightInsert\",a)},expression:\"scope.row.roleFuncAuth.rightInsert\"}})]}}])}),e._v(\" \"),a(\"el-table-column\",{attrs:{label:\"删除\",width:\"70\"},scopedSlots:e._u([{key:\"default\",fn:function(t){return[a(\"el-checkbox\",{on:{change:function(a){var n=arguments.length,s=Array(n);while(n--)s[n]=arguments[n];return e.handleCheck.apply(void 0,[t].concat(s,[\"rightDelete\"]))}},model:{value:t.row.roleFuncAuth.rightDelete,callback:function(a){e.$set(t.row.roleFuncAuth,\"rightDelete\",a)},expression:\"scope.row.roleFuncAuth.rightDelete\"}})]}}])}),e._v(\" \"),a(\"el-table-column\",{attrs:{label:\"保存\",width:\"70\"},scopedSlots:e._u([{key:\"default\",fn:function(t){return[a(\"el-checkbox\",{on:{change:function(a){var n=arguments.length,s=Array(n);while(n--)s[n]=arguments[n];return e.handleCheck.apply(void 0,[t].concat(s,[\"rightUpdate\"]))}},model:{value:t.row.roleFuncAuth.rightUpdate,callback:function(a){e.$set(t.row.roleFuncAuth,\"rightUpdate\",a)},expression:\"scope.row.roleFuncAuth.rightUpdate\"}})]}}])}),e._v(\" \"),a(\"el-table-column\",{attrs:{label:\"审批\",width:\"70\"},scopedSlots:e._u([{key:\"default\",fn:function(t){return[a(\"el-checkbox\",{on:{change:function(a){var n=arguments.length,s=Array(n);while(n--)s[n]=arguments[n];return e.handleCheck.apply(void 0,[t].concat(s,[\"rightAudit\"]))}},model:{value:t.row.roleFuncAuth.rightAudit,callback:function(a){e.$set(t.row.roleFuncAuth,\"rightAudit\",a)},expression:\"scope.row.roleFuncAuth.rightAudit\"}})]}}])}),e._v(\" \"),a(\"el-table-column\",{attrs:{label:\"打印\",width:\"70\"},scopedSlots:e._u([{key:\"default\",fn:function(t){return[a(\"el-checkbox\",{on:{change:function(a){var n=arguments.length,s=Array(n);while(n--)s[n]=arguments[n];return e.handleCheck.apply(void 0,[t].concat(s,[\"rightPrint\"]))}},model:{value:t.row.roleFuncAuth.rightPrint,callback:function(a){e.$set(t.row.roleFuncAuth,\"rightPrint\",a)},expression:\"scope.row.roleFuncAuth.rightPrint\"}})]}}])}),e._v(\" \"),a(\"el-table-column\",{attrs:{label:\"导出\",width:\"100\",\"class-name\":\"function-table-end\"},scopedSlots:e._u([{key:\"default\",fn:function(t){return[a(\"el-checkbox\",{on:{change:function(a){var n=arguments.length,s=Array(n);while(n--)s[n]=arguments[n];return e.handleCheck.apply(void 0,[t].concat(s,[\"rightExport\"]))}},model:{value:t.row.roleFuncAuth.rightExport,callback:function(a){e.$set(t.row.roleFuncAuth,\"rightExport\",a)},expression:\"scope.row.roleFuncAuth.rightExport\"}})]}}])})],1)],1)])],1)],1)])},s=[],o=(a(\"20d6\"),a(\"8615\"),a(\"7f7f\"),a(\"96cf\"),a(\"3b8d\")),r=(a(\"ac6a\"),a(\"c5f6\"),a(\"0d5e\")),i={props:{companyId:{type:Number,default:0},addType:{type:Number,default:0},roleId:{type:Number,default:0},roleName:{type:String,default:\"\"}},data:function(){return{loading:!1,companyLoading:\"暂无数据\",addRoleForm:{name:this.roleName},addRoleRules:{name:[{required:!0,message:\"请输入角色名称\",trigger:\"blur\"}]},sysData:[],sysRootNode:[],setData:[],defaultProps:{children:\"children\",label:\"name\"},defaultAuthList:[],functionData:[],getList:{},clickList:{},addList:{},updateList:{},deleteList:{},defaultFuncAuth:{roleId:this.roleId,cpFuncId:0,cpFuncPid:0,rightSelect:0,rightInsert:0,rightDelete:0,rightUpdate:0,rightAudit:0,rightPrint:0,rightExport:0,type:0}}},mounted:function(){this.initAuthList()},methods:{initAuthList:function(){var e=this;e.companyId>0&&(e.companyLoading=\"数据加载中...\",Object(r[\"b\"])(\"/cpfunc/truncated-tree/\"+e.companyId,{truncateLvl:2,roleId:e.roleId}).then(function(t){0===t.status&&(e.companyLoading=\"暂无数据\",e.sysData=t.data.tree,e.defaultAuthList=t.data.roleFuncAuthIds,e.sysRootNode=JSON.parse(JSON.stringify(t.data.tree)),e.sysRootNode.length>0&&(e.sysRootNode[0].children=[]),e.$nextTick(function(){for(var a=0;a<t.data.checkedIds.length;a++)e.$refs.sysTree.setChecked(t.data.checkedIds[a],!0,!1)}))}))},getTreeNode:function(e){var t=[],a=function e(a){a.forEach(function(a){t.push(a),a.children&&a.children.length>0&&e(a.children)})};return a(e),t},sysClick:function(e,t){var a=this;null===e.children?Object(r[\"b\"])(\"/cpfunc/\"+this.companyId+\"/\"+e.funcId+\"/\"+this.roleId,null).then(function(e){if(0===e.status){for(var t=e.data,n=0;n<t.length;n++)null===t[n].roleFuncAuth?a.clickList.hasOwnProperty(t[n].id)?t[n].roleFuncAuth=a.clickList[t[n].id]:(t[n].roleFuncAuth=JSON.parse(JSON.stringify(a.defaultFuncAuth)),t[n].roleFuncAuth.cpFuncId=t[n].id,t[n].roleFuncAuth.cpFuncPid=t[n].funcPid):(t[n].roleFuncAuth.type=1,t[n].roleFuncAuth.cpFuncPid=t[n].funcPid,t[n].roleFuncAuth.rightSelect=!!t[n].roleFuncAuth.rightSelect,t[n].roleFuncAuth.rightInsert=!!t[n].roleFuncAuth.rightInsert,t[n].roleFuncAuth.rightDelete=!!t[n].roleFuncAuth.rightDelete,t[n].roleFuncAuth.rightUpdate=!!t[n].roleFuncAuth.rightUpdate,t[n].roleFuncAuth.rightAudit=!!t[n].roleFuncAuth.rightAudit,t[n].roleFuncAuth.rightPrint=!!t[n].roleFuncAuth.rightPrint,t[n].roleFuncAuth.rightExport=!!t[n].roleFuncAuth.rightExport),a.getList.hasOwnProperty(t[n].id)||(a.getList[t[n].id]=JSON.parse(JSON.stringify(t[n].roleFuncAuth)));a.functionData=t}}):this.functionData=[]},handleCheck:function(e,t){var a=e.row.roleFuncAuth;this.clickList[e.row.id]=a},saveRole:function(){var e=Object(o[\"a\"])(regeneratorRuntime.mark(function e(){var t,a=this;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:t=this,this.$refs.addRoleForm.validate(function(e){if(e){var n={cpid:a.companyId,showName:a.addRoleForm.name,roleFuncAuth:[]},s=t.$refs.sysTree.getCheckedNodes(!1,!0),o=[],i=[],l=Object.values(a.clickList);if(a.loading=!0,0===t.addType){for(var c=0;c<s.length;c++)if(o.push({cpFuncId:s[c].id,rightSelect:1}),null===s[c].children&&l.length>0){var u=l.filter(function(e){return e.cpFuncPid===s[c].funcId});i=i.concat(u)}i=i.filter(function(e){return e.rightAudit||e.rightDelete||e.rightExport||e.rightInsert||e.rightPrint||e.rightSelect||e.rightUpdate}),n.roleFuncAuth=o.concat(a.trueToOne(i)),console.log(n),Object(r[\"c\"])(\"/role/save\",n).then(function(e){a.loading=!1,0===e.status?a.$message({message:\"角色添加成功\",type:\"success\",duration:3e3}):a.$message({message:e.msg,type:\"warning\",duration:3e3}),t.$emit(\"submitrole\")})}else{for(var d=JSON.parse(JSON.stringify(t.defaultAuthList)),m=[],p=0;p<s.length;p++){if(null!==s[p].roleFuncAuth){var h=d.findIndex(function(e){return e===s[p].roleFuncAuth.id});h>=0&&d.splice(h,1)}else m.push({roleId:t.roleId,cpFuncId:s[p].id,rightSelect:1});if(null===s[p].children&&l.length>0){var f=l.filter(function(e){return e.cpFuncPid===s[p].funcId});i=i.concat(f)}}for(var g=[],y=[],b=[],v=0;v<i.length;v++){var w=i[v];w.rightAudit||w.rightDelete||w.rightExport||w.rightInsert||w.rightPrint||w.rightSelect||w.rightUpdate?0===w.type?g.push(w):w!==a.getList[w.cpFuncId]&&y.push(w):1===a.getList[w.cpFuncId].type&&b.push(w.id)}Object(r[\"c\"])(\"/role/updateName\",{id:a.roleId,showName:a.addRoleForm.name}).then(function(e){0===e.status?Object(r[\"a\"])(\"/rolefunc\",d.concat(b)).then(function(e){0===e.status?Object(r[\"d\"])(\"/rolefunc\",a.trueToOne(y)).then(function(n){0===n.status?(m=t.trueToOne(m),Object(r[\"c\"])(\"/rolefunc\",m.concat(a.trueToOne(g))).then(function(n){0===n.status?(a.loading=!1,a.$message({message:\"角色修改成功\",type:\"success\",duration:3e3}),t.$emit(\"submitrole\")):(a.loading=!1,a.$message({message:e.msg,type:\"warning\",duration:3e3}),t.$emit(\"submitrole\"))})):(a.loading=!1,a.$message({message:e.msg,type:\"warning\",duration:3e3}),t.$emit(\"submitrole\"))}):(a.loading=!1,a.$message({message:e.msg,type:\"warning\",duration:3e3}),t.$emit(\"submitrole\"))}):(a.loading=!1,a.$message({message:e.msg,type:\"warning\",duration:3e3}))})}}});case 2:case\"end\":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}(),cancelRole:function(){this.$emit(\"cancelrole\")},trueToOne:function(e){for(var t=0;t<e.length;t++)e[t].rightSelect=1*e[t].rightSelect,e[t].rightInsert=1*e[t].rightInsert,e[t].rightDelete=1*e[t].rightDelete,e[t].rightUpdate=1*e[t].rightUpdate,e[t].rightAudit=1*e[t].rightAudit,e[t].rightPrint=1*e[t].rightPrint,e[t].rightExport=1*e[t].rightExport;return e}}},l=i,c=(a(\"6669\"),a(\"6c1e\"),a(\"2877\")),u=Object(c[\"a\"])(l,n,s,!1,null,\"4c0b1328\",null);t[\"default\"]=u.exports},4731:function(e,t,a){},\"4f81\":function(e,t,a){\"use strict\";var n=a(\"177e\"),s=a.n(n);s.a},6669:function(e,t,a){\"use strict\";var n=a(\"d80b\"),s=a.n(n);s.a},\"6c1e\":function(e,t,a){\"use strict\";var n=a(\"12b5\"),s=a.n(n);s.a},\"71dc\":function(e,t,a){\"use strict\";var n=a(\"4731\"),s=a.n(n);s.a},7499:function(e,t,a){\"use strict\";var n=a(\"c71e\"),s=a.n(n);s.a},\"78d1\":function(e,t,a){\"use strict\";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a(\"div\",{staticClass:\"auth-transfer\"},[a(\"el-row\",{attrs:{gutter:20}},[a(\"el-col\",{staticClass:\"auth-all-item\",attrs:{span:10}},[a(\"div\",{staticClass:\"auth-tree-title\"},[e._v(\"功能清单\")]),e._v(\" \"),a(\"el-scrollbar\",{staticClass:\"auth-tree\"},[a(\"el-tree\",{ref:\"sysTree\",attrs:{data:e.sysData,props:e.defaultProps,\"node-key\":\"id\",\"empty-text\":e.authLoading,\"highlight-current\":\"\",accordion:\"\",\"show-checkbox\":\"\",\"default-expand-all\":\"\"}})],1)],1),e._v(\" \"),a(\"el-col\",{attrs:{span:4}},[a(\"div\",{staticClass:\"company auth-bg\"},[a(\"div\",{staticClass:\"auth-set-btn\"},[a(\"div\",{class:0===e.btnStatus?\"auth-disable\":\"auth-available\",on:{click:e.addAuth}},[e._v(\"授权\")]),e._v(\" \"),a(\"div\",{class:0===e.btnStatus?\"auth-disable\":\"auth-available\",on:{click:e.removeAuth}},[e._v(\"移除\")])])])]),e._v(\" \"),a(\"el-col\",{staticClass:\"auth-item\",attrs:{span:10}},[a(\"div\",{staticClass:\"auth-tree-title\"},[e._v(\"授权功能\")]),e._v(\" \"),a(\"el-scrollbar\",{staticClass:\"auth-tree\"},[a(\"el-tree\",{ref:\"setTree\",attrs:{data:e.setData,props:e.defaultProps,\"node-key\":e.setKey,\"empty-text\":e.setLoading,\"highlight-current\":\"\",accordion:\"\",\"show-checkbox\":\"\",\"default-expand-all\":\"\"}})],1)],1)],1)],1)},s=[],o=(a(\"ac6a\"),a(\"7f7f\"),a(\"20d6\"),a(\"96cf\"),a(\"3b8d\")),r=a(\"db72\"),i=(a(\"c5f6\"),a(\"0d5e\")),l=a(\"2f62\"),c={props:{selectCompanyId:{type:Number,default:0},btnStatus:{type:Number,default:0}},data:function(){return{authLoading:\"暂无数据\",setLoading:\"暂无数据\",sysRootNode:[],sysData:[],setKey:\"id\",setPKey:\"pid\",setData:[],setDefault:[],defaultProps:{children:\"children\",label:\"name\"}}},computed:Object(r[\"a\"])({},Object(l[\"b\"])([\"companyId\"])),watch:{selectCompanyId:{handler:function(e,t){this.getCompanySys(e)}}},created:function(){this.getAllSys()},methods:{getAllSys:function(){var e=this;this.authLoading=\"数据加载中...\",12===this.companyId?Object(i[\"b\"])(\"/sysfunc/tree\",null).then(function(t){0===t.status&&(e.sysData=t.data,e.sysRootNode=JSON.parse(JSON.stringify(t.data)),e.sysRootNode[0].children=[]),e.authLoading=\"暂无数据\"}):(this.setKey=\"funcId\",this.setPKey=\"funcPid\",Object(i[\"b\"])(\"/cpfunc/tree/\"+this.companyId,null).then(function(t){0===t.status&&(e.sysData=t.data,e.sysRootNode=JSON.parse(JSON.stringify(t.data)),e.sysRootNode[0].children=[]),e.authLoading=\"暂无数据\"}),this.getCompanySys(this.selectCompanyId))},getCompanySys:function(e){var t=this;this.selectCompanyId>0&&(this.setLoading=\"数据加载中...\",Object(i[\"b\"])(\"/cpfunc/tree/\"+this.selectCompanyId,null).then(function(e){0===e.status&&(t.setData=e.data,e.data.length>0?t.setDefault=t.getTreeNode(e.data):t.setDefault=[]),t.setLoading=\"暂无数据\"}))},addAuth:function(){var e=this;if(0!==this.btnStatus){var t=this,a=this.$refs.sysTree.getCheckedNodes(!1,!0);a.length<=1||null===a||(t.setData=JSON.parse(JSON.stringify(this.sysRootNode)),t.$nextTick(function(){for(var n,s=JSON.parse(JSON.stringify(a)),o=1;o<s.length;o++)n=s[o],n.children=[],t.$refs.setTree.append(n,n[e.setPKey])}))}},removeAuth:function(){if(0!==this.btnStatus)for(var e=this,t=e.$refs.setTree.getCheckedKeys(),a=0;a<t.length;a++)e.$refs.setTree.remove(t[a]),e.$refs.sysTree.setChecked(t[a],!1)},saveAuth:function(){var e=Object(o[\"a\"])(regeneratorRuntime.mark(function e(){var t,a,n,s,o,r,i,l,c,u=this;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(t=this.$refs.setTree.data,null!==t){e.next=16;break}if(!(this.setDefault.length>0)){e.next=13;break}return e.next=5,this.deleteAuth(this.setDefault);case 5:if(!e.sent){e.next=10;break}this.$message({message:\"授权保存成功\",type:\"success\",duration:3e3}),this.setDefault=[],e.next=11;break;case 10:this.$message({message:\"授权保存失败\",type:\"warning\",duration:3e3});case 11:e.next=14;break;case 13:this.$message({message:\"授权保存成功\",type:\"success\",duration:3e3});case 14:e.next=53;break;case 16:if(a=this.getTreeNode(t),!(this.setDefault.length>0)){e.next=44;break}for(n=JSON.parse(JSON.stringify(this.setDefault)),s=JSON.parse(JSON.stringify(a)),o=0;o<a.length;o++)r=n.findIndex(function(e){return e.name===a[o].name}),r>=0&&n.splice(r,1);if(i=!0,!(n.length>0)){e.next=26;break}return e.next=25,this.deleteAuth(n);case 25:i=e.sent;case 26:if(!i){e.next=41;break}for(l=0;l<this.setDefault.length;l++)c=s.findIndex(function(e){return e.name===u.setDefault[l].name}),c>=0&&s.splice(c,1);if(!(s.length>0)){e.next=38;break}return e.next=31,this.postAuth(s);case 31:if(!e.sent){e.next=35;break}this.$message({message:\"授权保存成功\",type:\"success\",duration:3e3}),e.next=36;break;case 35:this.$message({message:\"授权保存失败\",type:\"warning\",duration:3e3});case 36:e.next=39;break;case 38:this.$message({message:\"授权保存成功\",type:\"success\",duration:3e3});case 39:e.next=42;break;case 41:this.$message({message:\"授权保存失败\",type:\"warning\",duration:3e3});case 42:e.next=51;break;case 44:return e.next=46,this.postAuth(a);case 46:if(!e.sent){e.next=50;break}this.$message({message:\"授权保存成功\",type:\"success\",duration:3e3}),e.next=51;break;case 50:this.$message({message:\"授权保存失败\",type:\"warning\",duration:3e3});case 51:this.getCompanySys(this.selectCompanyId),this.$emit(\"authend\");case 53:case\"end\":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}(),getTreeNode:function(e){var t=[],a=function e(a){a.forEach(function(a){t.push(a),a.children&&a.children.length>0&&e(a.children)})};return a(e),t},deleteAuth:function(e){var t=[];return e.forEach(function(e){t.push(e.id)}),new Promise(function(e,a){Object(i[\"a\"])(\"/cpfunc\",t).then(function(t){e(0===t.status)}).catch(function(){a(!1)})})},postAuth:function(e){var t=this;if(\"funcPid\"===this.setPKey)for(var a=0;a<e.length;a++)e[a].id=e[a].funcId,e[a].pid=e[a].funcPid;return new Promise(function(a,n){Object(i[\"c\"])(\"/cpfunc/\"+t.selectCompanyId,e).then(function(e){a(0===e.status)}).catch(function(){n(!1)})})}}},u=c,d=(a(\"4f81\"),a(\"2877\")),m=Object(d[\"a\"])(u,n,s,!1,null,null,null);t[\"default\"]=m.exports},\"78ed\":function(e,t,a){\"use strict\";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a(\"div\",{staticClass:\"account-container\"},[a(\"el-form\",{ref:\"accountForm\",staticClass:\"account-form\",attrs:{model:e.accountForm,rules:e.accountRules,autocomplete:\"off\",\"hide-required-asterisk\":\"\",\"label-width\":\"80px\"}},[a(\"el-form-item\",{attrs:{label:\"姓名\",prop:\"name\"}},[a(\"el-input\",{attrs:{placeholder:\"姓名\"},model:{value:e.accountForm.name,callback:function(t){e.$set(e.accountForm,\"name\",t)},expression:\"accountForm.name\"}})],1),e._v(\" \"),a(\"el-form-item\",{attrs:{label:\"手机号\",prop:\"mobile\"}},[a(\"el-input\",{attrs:{name:\"mobile\",maxlength:\"11\",clearable:\"\",placeholder:\"手机号\"},model:{value:e.accountForm.mobile,callback:function(t){e.$set(e.accountForm,\"mobile\",e._n(t))},expression:\"accountForm.mobile\"}})],1),e._v(\" \"),a(\"el-form-item\",{attrs:{label:\"职位\",prop:\"post\"}},[a(\"el-input\",{attrs:{name:\"post\",clearable:\"\",placeholder:\"职位\",autocomplete:\"off\"},model:{value:e.accountForm.post,callback:function(t){e.$set(e.accountForm,\"post\",t)},expression:\"accountForm.post\"}}),e._v(\" \"),a(\"el-input\",{directives:[{name:\"show\",rawName:\"v-show\",value:!1,expression:\"false\"}],attrs:{clearable:\"\",placeholder:\"职位\"}})],1),e._v(\" \"),1!=e.userInfo.type?a(\"el-form-item\",{attrs:{label:\"密码\",prop:\"password\"}},[a(\"el-input\",{directives:[{name:\"show\",rawName:\"v-show\",value:!1,expression:\"false\"}],attrs:{type:\"password\",placeholder:\"密码\"}}),e._v(\" \"),a(\"el-input\",{ref:\"password\",attrs:{type:\"password\",name:\"password\",clearable:\"\",placeholder:\"密码\",autocomplete:\"off\",\"auto-complete\":\"new-password\"},model:{value:e.accountForm.password,callback:function(t){e.$set(e.accountForm,\"password\",t)},expression:\"accountForm.password\"}})],1):e._e(),e._v(\" \"),a(\"div\",{staticClass:\"account-btn\",style:{\"padding-top\":1!=e.userInfo.type?\"0\":\"50px\"}},[a(\"el-button\",{staticClass:\"el-button-default\",attrs:{round:\"\",size:\"mini\"},on:{click:e.cancel}},[e._v(\"取消\")]),e._v(\" \"),a(\"el-button\",{attrs:{loading:e.loading,round:\"\",size:\"mini\",type:\"primary\"},on:{click:e.submit}},[e._v(\"保存\")])],1)],1),e._v(\" \"),a(\"div\",{staticClass:\"photo\"},[a(\"el-upload\",{ref:\"upload\",staticClass:\"avatar-uploader\",attrs:{action:\"\",drag:\"\",\"on-change\":e.onchange,\"show-file-list\":!1,\"on-success\":e.handleAvatarSuccess,\"before-upload\":e.beforeAvatarUpload,\"auto-upload\":!1,\"http-request\":e.upLoadAvatar}},[e.imageUrl?a(\"img\",{staticClass:\"avatar\",attrs:{src:e.imageUrl}}):a(\"i\",{staticClass:\"el-icon-plus avatar-uploader-icon\"}),e._v(\" \"),a(\"div\",{staticClass:\"el-upload__tip\",attrs:{slot:\"tip\"},slot:\"tip\"},[e._v(\"只能上传jpg/png文件，且不超过2MB\")])])],1)],1)},s=[],o=(a(\"7f7f\"),a(\"0d5e\")),r=a(\"c24f\"),i=a(\"61f7\"),l={name:\"Account\",props:{userInfo:{type:Object,default:null}},data:function(){var e=function(e,t,a){\"\"===t?a(new Error(\"请输入新手机号码\")):Object(i[\"e\"])(t)?a():a(new Error(\"手机号输入不正确!\"))};return{loading:!1,userId:0,showCropper:!1,imageUrl:\"\",imageUpdate:!1,imgData:{accept:\"image/jpeg, image/png, image/jpg\"},accountForm:{name:\"\",mobile:\"\",post:\"\",password:\"\"},accountRules:{name:[{required:!0,trigger:\"blur\",message:\"请输入姓名\"}],mobile:[{required:!0,trigger:\"blur\",validator:e}],post:[{required:!0,trigger:\"blur\",message:\"请输入职位\"}],password:[{required:!0,trigger:\"blur\",message:\"请输入密码\"},{min:6,message:\"密码必须大于6位\",trigger:\"blur\"}]}}},created:function(){var e=this;1===e.userInfo.type?(e.userId=e.userInfo.userId,e.accountForm.name=e.userInfo.cusName,e.accountForm.mobile=e.userInfo.phone,e.accountForm.post=e.userInfo.postName,e.accountForm.password=\"111111\",e.imageUrl=\"http://192.168.1.32:8081/user/img/\"+e.userInfo.cusPic+\"?t=\"+(new Date).getTime()):(e.accountForm.name=\"\",e.accountForm.mobile=\"\",e.accountForm.post=\"\",e.accountForm.password=\"\",e.imageUrl=\"\")},methods:{getObjectURL:function(e){var t=null;return void 0!==window.createObjectURL?t=window.createObjectURL(e):void 0!==window.URL?t=window.URL.createObjectURL(e):void 0!==window.webkitURL&&(t=window.webkitURL.createObjectURL(e)),t},onchange:function(e,t){var a=e.raw;if(a){var n=a.type,s=a.size;if(-1===this.imgData.accept.indexOf(n)||\"\"===n)return this.$message({message:\"请选择jpg、jpeg、png格式图片文件\",type:\"warning\"}),!1;if(s>2097152)return this.$message({message:\"请选择2M以下图片文件\",type:\"warning\"}),!1;this.imageUpdate=!0,this.imageUrl=this.getObjectURL(a)}},upLoadAvatar:function(e){var t=this,a=new FormData;a.append(\"file\",e.file),Object(r[\"g\"])(this.userId,a).then(function(e){t.loading=!1,t.$emit(\"submituser\")})},submit:function(){var e=this,t=this;this.$refs.accountForm.validate(function(a){if(a){var n={cpid:t.userInfo.cpid,cusName:t.accountForm.name,phone:t.accountForm.mobile,deptId:t.userInfo.deptId,postName:t.accountForm.post,cusPassword:t.accountForm.password};t.loading=!0,0===t.userInfo.type?Object(o[\"c\"])(\"/user\",n).then(function(a){0===a.status?(e.userId=a.data.userId,e.$message({message:\"添加成功\",type:\"success\",duration:3e3}),\"\"!==e.imageUrl?t.$refs.upload.submit():(t.loading=!1,t.$emit(\"submituser\"))):(e.$message({message:a.msg,type:\"warning\",duration:3e3}),t.loading=!1,t.$emit(\"submituser\"))}):(n.userId=t.userInfo.userId,n.cusName=n.cusName===t.userInfo.cusName?null:n.cusName,n.phone=n.phone===t.userInfo.phone?null:n.phone,n.postName=n.postName===t.userInfo.postName?null:n.postName,n.cusPassword=null,Object(o[\"d\"])(\"/user\",n).then(function(a){0===a.status?(e.$message({message:\"修改成功\",type:\"success\",duration:3e3}),\"\"!==e.imageUrl&&e.imageUpdate?t.$refs.upload.submit():(t.loading=!1,t.$emit(\"submituser\"))):(e.$message({message:a.msg,type:\"warning\",duration:3e3}),t.loading=!1,t.$emit(\"submituser\"))}))}})},cancel:function(){this.$emit(\"canceluser\")},handleAvatarSuccess:function(e,t){this.imageUrl=URL.createObjectURL(t.raw)},beforeAvatarUpload:function(e){var t=\"image/jpeg\"===e.type,a=e.size/1024/1024<2;return t||this.$message.error(\"上传头像图片只能是 JPG 格式!\"),a||this.$message.error(\"上传头像图片大小不能超过 2MB!\"),t&&a}}},c=l,u=(a(\"1ad2\"),a(\"adf4\"),a(\"2877\")),d=Object(u[\"a\"])(c,n,s,!1,null,\"d908b5a6\",null);t[\"default\"]=d.exports},\"7c2f\":function(e,t,a){},\"9c30\":function(e,t,a){\"use strict\";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a(\"div\",{staticClass:\"structure-container default-container\"},[a(\"el-row\",{staticClass:\"first-row\",attrs:{gutter:15}},[a(\"el-col\",{attrs:{span:5}},[a(\"div\",{staticClass:\"company bg\"},[a(\"div\",{staticClass:\"company-title\"},[a(\"p\",{staticClass:\"title f-l\"},[e._v(\"公司\")]),e._v(\" \"),a(\"p\",{staticClass:\"p-btn f-r\",class:{\"btn-disable\":!e.companyDelBtn},on:{click:function(t){return e.deleteCompany()}}},[e._v(\"删除\")]),e._v(\" \"),a(\"p\",{staticClass:\"p-btn f-r\",class:{\"btn-disable\":!e.companyDelBtn},on:{click:function(t){return e.addCompany(1)}}},[e._v(\"修改\")]),e._v(\" \"),a(\"p\",{staticClass:\"p-btn f-r\",on:{click:function(t){return e.addCompany(0)}}},[e._v(\"增加\")]),e._v(\" \"),a(\"p\",{staticClass:\"p-btn f-r\",class:{\"btn-disable\":!e.companyDelBtn},on:{click:function(t){return e.authCompany()}}},[e._v(\"授权\")])]),e._v(\" \"),a(\"el-scrollbar\",{staticClass:\"company-tree\"},[a(\"el-tree\",{ref:\"companyTree\",attrs:{data:e.companyData,props:e.defaultProps,\"node-key\":\"companyId\",\"highlight-current\":\"\",accordion:\"\"},on:{\"node-click\":e.companyClick}})],1)],1),e._v(\" \"),a(\"div\",{staticClass:\"department bg\"},[a(\"div\",[a(\"p\",{staticClass:\"title f-l\"},[e._v(\"部门\")]),e._v(\" \"),a(\"p\",{staticClass:\"p-btn f-r\",on:{click:function(t){return e.deleteDepartment()}}},[e._v(\"删除\")]),e._v(\" \"),a(\"p\",{staticClass:\"p-btn f-r\",on:{click:function(t){return e.addDepartment(1)}}},[e._v(\"修改\")]),e._v(\" \"),a(\"p\",{staticClass:\"p-btn f-r\",on:{click:function(t){return e.addDepartment(0)}}},[e._v(\"增加\")])]),e._v(\" \"),a(\"el-scrollbar\",{staticClass:\"company-tree\"},[a(\"el-tree\",{ref:\"departmentTree\",attrs:{data:e.departmentData,props:{children:\"children\",label:\"name\"},\"node-key\":\"id\",\"highlight-current\":\"\",accordion:\"\"},on:{\"node-click\":e.departmentClick}})],1)],1)]),e._v(\" \"),a(\"el-col\",{attrs:{span:19}},[a(\"div\",{staticClass:\"user-info bg\"},[a(\"div\",[a(\"p\",{staticClass:\"title f-l\"},[e._v(\"账号信息\")]),e._v(\" \"),a(\"p\",{staticClass:\"p-btn f-l\",on:{click:function(t){return e.deleteUser()}}},[e._v(\"删除\")]),e._v(\" \"),a(\"p\",{staticClass:\"p-btn f-l\",on:{click:function(t){return e.addUser(0)}}},[e._v(\"增加\")])]),e._v(\" \"),a(\"div\",{staticClass:\"user-table\"},[a(\"el-table\",{directives:[{name:\"loading\",rawName:\"v-loading\",value:e.userLoading,expression:\"userLoading\"}],ref:\"userTable\",staticStyle:{width:\"100%\"},attrs:{data:e.userData,\"row-key\":e.userData.userId,\"max-height\":\"100%\",height:\"100%\",\"header-row-class-name\":\"car-table-header\",\"row-class-name\":\"car-table-item\",\"highlight-current-row\":\"\"}},[a(\"el-table-column\",{attrs:{type:\"selection\",align:\"center\",width:\"40\",\"class-name\":\"user-table-check\"}}),e._v(\" \"),a(\"el-table-column\",{attrs:{prop:\"cusName\",label:\"姓名\",width:\"80\"}}),e._v(\" \"),a(\"el-table-column\",{attrs:{prop:\"dept.name\",label:\"部门\",width:\"90\"}}),e._v(\" \"),a(\"el-table-column\",{attrs:{prop:\"postName\",label:\"职位\",width:\"90\"}}),e._v(\" \"),a(\"el-table-column\",{attrs:{prop:\"phone\",label:\"手机号\",width:\"110\"}}),e._v(\" \"),a(\"el-table-column\",{attrs:{prop:\"username\",label:\"账号\",width:\"110\"}}),e._v(\" \"),a(\"el-table-column\",{attrs:{prop:\"roleList[0].showName\",label:\"角色\",width:\"100\"}}),e._v(\" \"),a(\"el-table-column\",{attrs:{label:\"操作\",width:\"auto\",\"class-name\":\"user-table-btn\"},scopedSlots:e._u([{key:\"default\",fn:function(t){return[a(\"p\",{staticClass:\"p-btn\",staticStyle:{\"margin-left\":\"0\"},on:{click:function(a){return e.updateUserRole(t)}}},[e._v(\"修改角色\")]),e._v(\" \"),a(\"p\",{staticClass:\"p-btn\",on:{click:function(a){return e.updateUser(t)}}},[e._v(\"修改账号\")]),e._v(\" \"),a(\"p\",{staticClass:\"p-btn\",on:{click:function(a){return e.deleteUserById(t)}}},[e._v(\"删除账号\")]),e._v(\" \"),a(\"p\",{staticClass:\"p-btn\",on:{click:function(a){return e.resetPassword(t)}}},[e._v(\"重置密码\")])]}}])})],1)],1),e._v(\" \"),a(\"pagination\",{directives:[{name:\"show\",rawName:\"v-show\",value:e.total>0,expression:\"total>0\"}],attrs:{total:e.total,page:e.listQuery.page,limit:e.listQuery.limit},on:{\"update:page\":function(t){return e.$set(e.listQuery,\"page\",t)},\"update:limit\":function(t){return e.$set(e.listQuery,\"limit\",t)},pagination:function(t){return e.pageChange(arguments)}}})],1),e._v(\" \"),a(\"div\",{staticClass:\"role-info bg\"},[a(\"div\",[a(\"p\",{staticClass:\"title f-l\"},[e._v(\"角色\")]),e._v(\" \"),a(\"p\",{staticClass:\"p-btn f-l\",on:{click:function(t){return e.addRole()}}},[e._v(\"增加\")])]),e._v(\" \"),a(\"div\",{staticClass:\"role-table\"},[a(\"el-table\",{directives:[{name:\"loading\",rawName:\"v-loading\",value:e.roleLoading,expression:\"roleLoading\"}],ref:\"roleTable\",attrs:{data:e.roleData,\"row-key\":e.roleData.id,\"show-header\":!1,height:\"100%\",\"row-class-name\":\"role-table-item\",\"highlight-current-row\":\"\"}},[a(\"el-table-column\",{attrs:{prop:\"showName\",label:\"角色\",width:\"100\"}}),e._v(\" \"),a(\"el-table-column\",{attrs:{width:\"auto\",fixed:\"right\",\"class-name\":\"user-table-btn\"},scopedSlots:e._u([{key:\"default\",fn:function(t){return[a(\"p\",{staticClass:\"p-btn\",staticStyle:{\"margin-left\":\"0\"},on:{click:function(a){return e.updateRole(t.row)}}},[e._v(\"修改\")]),e._v(\" \"),a(\"p\",{staticClass:\"p-btn\",on:{click:function(a){return e.deleteRole(t.row)}}},[e._v(\"删除\")])]}}])})],1)],1)])])],1),e._v(\" \"),a(\"el-dialog\",{attrs:{visible:e.showCompany,title:0===e.addCompanyType?\"新增公司\":\"修改公司\",width:\"30%\"},on:{\"update:visible\":function(t){e.showCompany=t}}},[e.showCompany?a(\"el-form\",{ref:\"addCompanyForm\",staticClass:\"add-company-dlg\",attrs:{model:e.addCompanyForm,rules:e.addCompanyRules,\"hide-required-asterisk\":\"\",\"label-width\":\"80px\",autocomplete:\"on\",size:\"mini\"}},[1===e.addCompanyType?a(\"el-form-item\",{attrs:{label:\"原名称\"}},[a(\"el-input\",{attrs:{disabled:!0,placeholder:\"原名称\"},model:{value:e.addCompanyForm.oldName,callback:function(t){e.$set(e.addCompanyForm,\"oldName\",t)},expression:\"addCompanyForm.oldName\"}})],1):e._e(),e._v(\" \"),a(\"el-form-item\",{attrs:{label:\"公司名称\",prop:\"name\"}},[a(\"el-input\",{attrs:{clearable:\"\",placeholder:\"公司名称\"},model:{value:e.addCompanyForm.name,callback:function(t){e.$set(e.addCompanyForm,\"name\",t)},expression:\"addCompanyForm.name\"}})],1),e._v(\" \"),0===e.addCompanyType?a(\"el-form-item\",{attrs:{label:\"负责人\",prop:\"principal\"}},[a(\"el-input\",{attrs:{clearable:\"\",placeholder:\"负责人姓名\"},model:{value:e.addCompanyForm.principal,callback:function(t){e.$set(e.addCompanyForm,\"principal\",t)},expression:\"addCompanyForm.principal\"}})],1):e._e(),e._v(\" \"),0===e.addCompanyType?a(\"el-form-item\",{attrs:{label:\"手机号\",prop:\"mobile\"}},[a(\"el-input\",{attrs:{clearable:\"\",placeholder:\"负责人手机号\"},model:{value:e.addCompanyForm.mobile,callback:function(t){e.$set(e.addCompanyForm,\"mobile\",t)},expression:\"addCompanyForm.mobile\"}})],1):e._e()],1):e._e(),e._v(\" \"),a(\"span\",{staticClass:\"dialog-footer\",attrs:{slot:\"footer\"},slot:\"footer\"},[a(\"el-button\",{staticClass:\"el-button-default\",attrs:{round:\"\",size:\"mini\"},on:{click:e.cancelCompany}},[e._v(\"取消\")]),e._v(\" \"),a(\"el-button\",{attrs:{round:\"\",size:\"mini\",type:\"primary\"},on:{click:e.submitCompany}},[e._v(\"确定\")])],1)],1),e._v(\" \"),a(\"el-dialog\",{attrs:{visible:e.showDepartment,title:0===e.addDepartmentType?\"新增部门\":\"修改部门\",width:\"30%\"},on:{\"update:visible\":function(t){e.showDepartment=t}}},[e.showDepartment?a(\"el-form\",{ref:\"addDepartmentForm\",staticClass:\"add-company-dlg\",attrs:{model:e.addDepartmentForm,rules:e.addDepartmentRules,\"hide-required-asterisk\":\"\",\"label-width\":\"80px\",autocomplete:\"on\",size:\"mini\"}},[1===e.addDepartmentType?a(\"el-form-item\",{attrs:{label:\"原名称\"}},[a(\"el-input\",{attrs:{disabled:!0,placeholder:\"原名称\"},model:{value:e.addDepartmentForm.oldName,callback:function(t){e.$set(e.addDepartmentForm,\"oldName\",t)},expression:\"addDepartmentForm.oldName\"}})],1):e._e(),e._v(\" \"),a(\"el-form-item\",{attrs:{label:\"部门名称\",prop:\"name\"}},[a(\"el-input\",{attrs:{clearable:\"\",placeholder:\"部门名称\"},model:{value:e.addDepartmentForm.name,callback:function(t){e.$set(e.addDepartmentForm,\"name\",t)},expression:\"addDepartmentForm.name\"}})],1)],1):e._e(),e._v(\" \"),a(\"span\",{staticClass:\"dialog-footer\",attrs:{slot:\"footer\"},slot:\"footer\"},[a(\"el-button\",{staticClass:\"el-button-default\",attrs:{round:\"\",size:\"mini\"},on:{click:e.cancelDepartment}},[e._v(\"取消\")]),e._v(\" \"),a(\"el-button\",{attrs:{round:\"\",size:\"mini\",type:\"primary\"},on:{click:e.submitDepartment}},[e._v(\"确定\")])],1)],1),e._v(\" \"),a(\"el-dialog\",{attrs:{visible:e.showUser,title:0===e.addUserType?\"新增用户\":\"修改用户\",width:\"700px\"},on:{\"update:visible\":function(t){e.showUser=t}}},[e.showUser?a(\"account\",{attrs:{\"user-info\":e.addUserInfo},on:{canceluser:function(t){e.showUser=!1},submituser:e.submitUser}}):e._e()],1),e._v(\" \"),a(\"el-dialog\",{attrs:{visible:e.showUserRole,title:\"修改用户角色\",width:\"300px\"},on:{\"update:visible\":function(t){e.showUserRole=t}}},[e.showUserRole?a(\"el-form\",{staticClass:\"add-company-dlg\",attrs:{\"label-width\":\"80px\",\"hide-required-asterisk\":\"\",autocomplete:\"on\",size:\"mini\"}},[a(\"el-form-item\",{attrs:{label:\"角色名称\"}},[a(\"el-dropdown\",{attrs:{type:\"primary\",placement:\"bottom-start\",plain:\"\"},on:{command:function(t){return e.handleDD.apply(void 0,arguments)}}},[a(\"el-button\",{staticClass:\"el-dropdown-link\"},[e._v(\"\\n            \"+e._s(e.userRoleForm.showName)),a(\"i\",{staticClass:\"el-icon-caret-bottom el-icon--right\"})]),e._v(\" \"),a(\"el-dropdown-menu\",{attrs:{slot:\"dropdown\"},slot:\"dropdown\"},e._l(e.roleData,function(t){return a(\"el-dropdown-item\",{key:t.id,attrs:{command:t}},[e._v(e._s(t.showName))])}),1)],1)],1)],1):e._e(),e._v(\" \"),a(\"span\",{staticClass:\"dialog-footer\",attrs:{slot:\"footer\"},slot:\"footer\"},[a(\"el-button\",{staticClass:\"el-button-default\",attrs:{round:\"\",size:\"mini\"},on:{click:e.cancelUserRole}},[e._v(\"取消\")]),e._v(\" \"),a(\"el-button\",{attrs:{round:\"\",size:\"mini\",type:\"primary\"},on:{click:e.submitUserRole}},[e._v(\"确定\")])],1)],1),e._v(\" \"),a(\"el-dialog\",{attrs:{visible:e.showRole,title:0===e.addRoleType?\"新增角色\":\"修改角色\",width:\"80%\"},on:{\"update:visible\":function(t){e.showRole=t}}},[e.showRole?a(\"role\",{ref:\"roleDlg\",attrs:{\"add-type\":e.addRoleType,\"role-id\":e.addRoleId,\"company-id\":e.selectCompanyId,\"role-name\":e.addRoleName},on:{cancelrole:function(t){e.showRole=!1},submitrole:e.submitRole}}):e._e()],1),e._v(\" \"),a(\"el-dialog\",{staticClass:\"auth-dlg\",attrs:{visible:e.showAuth,title:\"子公司授权\",width:\"750px\"},on:{\"update:visible\":function(t){e.showAuth=t}}},[e.showAuth?a(\"div\",{staticClass:\"auth-wapper\"},[a(\"tree-transfer\",{ref:\"treeTransfer\",attrs:{\"select-company-id\":e.selectCompanyId,\"btn-status\":1},on:{authend:e.authend}}),e._v(\" \"),a(\"el-button\",{staticClass:\"auth-edit-btn el-button-default\",attrs:{round:\"\",size:\"mini\",loading:e.authLoading},on:{click:e.authSave}},[e._v(\"保存\")])],1):e._e()])],1)},s=[],o=(a(\"ac6a\"),a(\"7f7f\"),a(\"db72\")),r=a(\"0d5e\"),i=a(\"333d\"),l=a(\"78ed\"),c=a(\"31ce\"),u=a(\"78d1\"),d=a(\"2f62\"),m=a(\"61f7\"),p={components:{Pagination:i[\"a\"],Account:l[\"default\"],TreeTransfer:u[\"default\"],Role:c[\"default\"]},data:function(){var e=function(e,t,a){\"\"===t?a(new Error(\"请输入新手机号码\")):Object(m[\"e\"])(t)?a():a(new Error(\"手机号输入不正确!\"))};return{companyData:[],selectCompanyNode:null,companyDelBtn:!1,showCompany:!1,addCompanyForm:{name:\"\",oldName:\"\",principal:\"\",mobile:\"\"},addCompanyRules:{name:[{required:!0,message:\"请输入公司名称\",trigger:\"blur\"}],principal:[{required:!0,message:\"请输入负责人姓名\",trigger:\"blur\"}],mobile:[{required:!0,trigger:\"blur\",validator:e}]},addCompanyType:0,defaultProps:{children:\"children\",label:\"companyName\"},showAuth:!1,authLoading:!1,selectCompanyId:0,departmentData:[],showDepartment:!1,addDepartmentForm:{name:\"\",oldName:\"\"},addDepartmentRules:{name:[{required:!0,message:\"请输入部门名称\",trigger:\"blur\"}]},addDepartmentType:0,selectDepartmentNode:null,userData:[],showUser:!1,addUserType:0,addUserInfo:{uid:0,type:0,cpid:\"\",deptId:\"\",cusName:\"\",phone:\"\",postName:\"\",cusPassword:\"\",cusPic:\"\"},total:0,userLoading:!1,userSearchType:0,listQuery:{page:1,limit:5},showUserRole:!1,userRoleForm:{id:0,index:-1,showName:\"\",roleId:0},roleLoading:!1,roleData:[],showRole:!1,addRoleId:0,addRoleType:0,addRoleName:\"\"}},computed:Object(o[\"a\"])({},Object(d[\"b\"])([\"companyId\"])),created:function(){this.init()},methods:{init:function(){var e=this;Object(r[\"b\"])(\"/company/\"+this.companyId+\"/tree\",null).then(function(t){0===t.status&&(e.companyData=t.data)})},companyClick:function(e,t){this.selectCompanyNode=e,1===t.level?this.companyDelBtn=!1:this.companyDelBtn=!0,this.addCompanyForm.oldName=e.companyName,this.showCompanyInfo(e)},showCompanyInfo:function(e){this.selectCompanyId=e.companyId,this.getDepartmentInfo(e.companyId),this.getRoleInfo(e.companyId),this.getUserInfoByCompany(e.companyId,1)},authCompany:function(){this.showAuth=!0},authSave:function(){this.authLoading=!0,this.$refs.treeTransfer.saveAuth()},authend:function(){this.authLoading=!1,this.showAuth=!1},deleteCompany:function(){var e=this;null===this.selectCompanyNode?this.$message({message:\"请选择需要删除的公司\",type:\"warning\",duration:3e3}):this.$confirm('是否删除公司\"'+this.selectCompanyNode.companyName+'\"',\"提示\",{confirmButtonText:\"确定\",cancelButtonText:\"取消\",type:\"warning\"}).then(function(){Object(r[\"a\"])(\"/company/\"+e.selectCompanyNode.companyId,null).then(function(t){0===t.status?(e.$refs.companyTree.remove(e.selectCompanyNode),e.selectCompanyNode=null,e.$message({message:\"公司删除成功\",type:\"success\",duration:3e3})):e.$message({message:\"删除失败，请稍后重试\",type:\"warning\",duration:3e3})})}).catch(function(){})},addCompany:function(e){this.addCompanyType=e,1!==e||null!==this.selectCompanyNode?this.showCompany=!0:this.$message({message:\"请选择需要修改的公司\",type:\"warning\",duration:3e3})},submitCompany:function(){var e=this,t=this;this.$refs.addCompanyForm.validate(function(a){if(a){var n={companyId:null,pid:null,companyName:e.addCompanyForm.name};0===e.addCompanyType?(null!==e.selectCompanyNode?n.pid=e.selectCompanyNode.companyId:n.pid=e.companyId,n.master=e.addCompanyForm.principal,n.phone=e.addCompanyForm.mobile,Object(r[\"c\"])(\"/company\",n).then(function(a){0===a.status?(e.$message({message:\"公司添加成功\",type:\"success\",duration:3e3}),e.$refs.companyTree.append(a.data,a.data.pid)):e.$message({message:a.msg,type:\"warning\",duration:3e3}),t.cancelCompany()})):(n.companyId=e.selectCompanyNode.companyId,n.headCpId=e.companyId,Object(r[\"d\"])(\"/company\",n).then(function(a){0===a.status?(e.companyData=a.data,e.$message({message:\"公司修改成功\",type:\"success\",duration:3e3})):e.$message({message:a.msg,type:\"warning\",duration:3e3}),t.cancelCompany()}))}})},cancelCompany:function(){this.showCompany=!1,this.$refs.addCompanyForm.resetFields()},getDepartmentInfo:function(e){var t=this;Object(r[\"b\"])(\"/dept/list/\"+e,null).then(function(e){0===e.status&&(t.departmentData=e.data)})},departmentClick:function(e){this.selectDepartmentNode=e,this.addDepartmentForm.oldName=e.name,this.getUserInfoByDepartment(e.id,1)},addDepartment:function(e){null===this.selectCompanyNode?this.$message({message:\"请选择需要添加部门的公司\",type:\"warning\",duration:3e3}):(this.addDepartmentType=e,this.showDepartment=!0)},deleteDepartment:function(){var e=this;null===this.selectDepartmentNode?this.$message({message:\"请选择需要删除的部门\",type:\"warning\",duration:3e3}):this.$confirm('是否删除部门\"'+this.selectDepartmentNode.name+'\"',\"提示\",{confirmButtonText:\"确定\",cancelButtonText:\"取消\",type:\"warning\"}).then(function(){Object(r[\"a\"])(\"/dept/\"+e.selectDepartmentNode.id,null).then(function(t){0===t.status?(e.$refs.departmentTree.remove(e.selectDepartmentNode.id),e.selectDepartmentNode=null,e.$message({message:\"部门删除成功\",type:\"success\",duration:3e3})):e.$message({message:t.msg,type:\"warning\",duration:3e3})})}).catch(function(){})},getUserInfoByDepartment:function(e,t){var a=this;this.userLoading=!0,this.userSearchType=1,Object(r[\"b\"])(\"/user/page/dp\"+e,{size:this.listQuery.limit,page:t-1}).then(function(e){a.userLoading=!1,0===e.status&&(a.total=e.data.totalElements,a.userData=e.data.content)})},submitDepartment:function(){var e=this,t=this;this.$refs.addDepartmentForm.validate(function(a){if(a){var n={id:null,cpid:null,name:e.addDepartmentForm.name};0===e.addDepartmentType?(n.cpid=e.selectCompanyNode.companyId,Object(r[\"c\"])(\"/dept\",n).then(function(a){0===a.status?(e.$message({message:\"部门添加成功\",type:\"success\",duration:3e3}),e.$refs.departmentTree.append(a.data,0)):e.$message({message:\"添加失败，请稍后重试\",type:\"warning\",duration:3e3}),t.cancelDepartment()})):Object(r[\"d\"])(\"/dept/\"+e.selectDepartmentNode.id+\"/\"+e.selectCompanyNode.companyId+\"/\"+e.addDepartmentForm.name,null).then(function(a){0===a.status?(e.departmentData=a.data,e.$message({message:\"部门修改成功\",type:\"success\",duration:3e3})):e.$message({message:\"添加失败，请稍后重试\",type:\"warning\",duration:3e3}),t.cancelDepartment()})}})},cancelDepartment:function(){this.showDepartment=!1,this.$refs.addDepartmentForm.resetFields()},addUser:function(e){null===this.selectDepartmentNode?this.$message({message:\"请选择需要添加用户的部门\",type:\"warning\",duration:3e3}):(this.addUserInfo.cpid=this.selectCompanyNode.companyId,this.addUserInfo.deptId=this.selectDepartmentNode.id,this.addUserInfo.type=e,this.addUserType=e,this.showUser=!0)},deleteUser:function(){var e=this,t=this.$refs.userTable.selection;t.length>0?this.$confirm(\"确定删除勾选的用户吗？\",\"提示\",{confirmButtonText:\"确定\",cancelButtonText:\"取消\",type:\"warning\"}).then(function(){var a=[];t.forEach(function(e){a.push(e.userId)}),Object(r[\"a\"])(\"/user/ids\",a).then(function(t){0===t.status?e.$message({message:\"用户删除成功\",type:\"success\",duration:3e3}):e.$message({message:t.msg,type:\"warning\",duration:3e3})})}):this.$message({message:\"请勾选需要删除的用户\",type:\"warning\",duration:3e3})},updateUser:function(e){this.addUserInfo.cpid=e.row.cpid,this.addUserInfo.deptId=e.row.deptId,this.addUserInfo.userId=e.row.userId,this.addUserInfo.cusName=e.row.cusName,this.addUserInfo.phone=e.row.phone,this.addUserInfo.postName=e.row.postName,this.addUserInfo.cusPic=e.row.cusPic,this.addUserInfo.type=1,this.addUserType=1,this.showUser=!0},handleDD:function(e){this.userRoleForm.showName=e.showName,this.userRoleForm.roleId=e.id},cancelUserRole:function(){this.userRoleForm.id=0,this.userRoleForm.index=-1,this.userRoleForm.showName=\"\",this.userRoleForm.roleId=0,this.showUserRole=!1},updateUserRole:function(e){this.userRoleForm.id=e.row.userId,this.userRoleForm.index=e.$index,this.userRoleForm.showName=e.row.roleList.length>0?e.row.roleList[0].showName:\"\",this.showUserRole=!0},submitUserRole:function(){var e=this;this.userRoleForm.roleId<=0?this.$message({message:\"请选择角色\",type:\"warning\",duration:3e3}):Object(r[\"d\"])(\"/user/\"+this.userRoleForm.id+\"/\"+this.userRoleForm.roleId,null).then(function(t){0===t.status?(e.userData[e.userRoleForm.index].roleList.length>0?e.userData[e.userRoleForm.index].roleList[0].showName=e.userRoleForm.showName:e.userData[e.userRoleForm.index].roleList.push({id:e.userRoleForm.roleId,showName:e.userRoleForm.showName}),e.$message({message:\"用户角色修改成功\",type:\"success\",duration:3e3})):e.$message({message:t.msg,type:\"warning\",duration:3e3}),e.showUserRole=!1})},deleteUserById:function(e){var t=this;this.$confirm('确定删除用户\"'+e.row.cusName+'\"吗？',\"提示\",{confirmButtonText:\"确定\",cancelButtonText:\"取消\",type:\"warning\"}).then(function(){Object(r[\"a\"])(\"/user/\"+e.row.userId,null).then(function(a){0===a.status?(t.$message({message:'用户\"'+e.row.cusName+'\"删除成功',type:\"success\",duration:3e3}),t.userData.splice(e.$index)):t.$message({message:a.msg,type:\"warning\",duration:3e3})})})},resetPassword:function(e){var t=this;this.$confirm('确定重置用户\"'+e.row.cusName+'\"的密码吗？',\"提示\",{confirmButtonText:\"确定\",cancelButtonText:\"取消\",type:\"warning\"}).then(function(){Object(r[\"d\"])(\"/user/reset/\"+e.row.userId,null).then(function(a){0===a.status?t.$message({message:'用户\"'+e.row.cusName+'\"密码重置成功',type:\"success\",duration:3e3}):t.$message({message:a.msg,type:\"warning\",duration:3e3})})})},submitUser:function(){this.showUser=!1,0===this.userSearchType?this.getUserInfoByCompany(this.selectCompanyId,this.listQuery.page):this.getUserInfoByDepartment(this.selectDepartmentNode.id,this.listQuery.page)},getUserInfoByCompany:function(e,t){var a=this;this.userLoading=!0,this.userSearchType=0,Object(r[\"b\"])(\"/user/page/cp\"+e,{size:this.listQuery.limit,page:t-1}).then(function(e){a.userLoading=!1,0===e.status&&(a.total=e.data.totalElements,a.userData=e.data.content)})},pageChange:function(e){0===this.userSearchType?this.getUserInfoByCompany(this.selectCompanyId,e[0].page):this.getUserInfoByDepartment(this.selectDepartmentNode.id,e[0].page)},getRoleInfo:function(e){var t=this;this.roleLoading=!0,Object(r[\"b\"])(\"/role/list/\"+e,null).then(function(e){t.roleLoading=!1,0===e.status&&(t.roleData=e.data)})},addRole:function(){null===this.selectCompanyNode?this.$message({message:\"请选择需要添加角色的公司\",type:\"warning\",duration:3e3}):(this.addRoleType=0,this.addRoleId=0,this.addRoleName=\"\",this.showRole=!0)},updateRole:function(e){this.addRoleType=1,this.addRoleId=e.id,this.addRoleName=e.showName,this.showRole=!0},deleteRole:function(e){var t=this;this.$confirm('确定删除角色\"'+e.showName+'\"吗？',\"提示\",{confirmButtonText:\"确定\",cancelButtonText:\"取消\",type:\"warning\"}).then(function(){Object(r[\"c\"])(\"/role/del/\"+e.id,null).then(function(a){0===a.status?(t.getRoleInfo(t.selectCompanyId),t.$message({message:'角色\"'+e.showName+'\"删除成功',type:\"success\",duration:3e3})):t.$message({message:a.msg,type:\"warning\",duration:3e3})})})},submitRole:function(){this.showRole=!1,this.getRoleInfo(this.selectCompanyId)}}},h=p,f=(a(\"7499\"),a(\"71dc\"),a(\"2877\")),g=Object(f[\"a\"])(h,n,s,!1,null,\"1d05fe72\",null);t[\"default\"]=g.exports},adf4:function(e,t,a){\"use strict\";var n=a(\"7c2f\"),s=a.n(n);s.a},c71e:function(e,t,a){},d80b:function(e,t,a){},ed5b:function(e,t,a){}}]);","extractedComments":[]}