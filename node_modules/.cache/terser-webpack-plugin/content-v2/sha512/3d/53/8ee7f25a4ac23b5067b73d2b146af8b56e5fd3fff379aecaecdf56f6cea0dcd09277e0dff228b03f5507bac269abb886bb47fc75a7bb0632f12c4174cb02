{"code":"(window[\"webpackJsonp\"]=window[\"webpackJsonp\"]||[]).push([[\"chunk-1997e9dd\",\"chunk-01b88618\",\"chunk-63ca6359\",\"chunk-75970d09\"],{\"097e\":function(e,t,a){\"use strict\";a.r(t);var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a(\"div\",{staticClass:\"glasys-container default-container\"},[a(\"el-row\",{staticClass:\"first-row mini-form\",attrs:{gutter:15}},[a(\"el-col\",{attrs:{span:5}},[a(\"div\",{staticClass:\"company bg\"},[a(\"div\",{staticClass:\"company-title\"},[a(\"p\",{staticClass:\"title f-l\"},[e._v(\"公司\")]),e._v(\" \"),a(\"p\",{staticClass:\"p-btn f-r\",class:{\"btn-disable\":!e.companyDelBtn},on:{click:function(t){return e.deleteCompany()}}},[e._v(\"删除\")]),e._v(\" \"),a(\"p\",{staticClass:\"p-btn f-r\",class:{\"btn-disable\":!e.isGalasys},on:{click:function(t){return e.addCompany(1)}}},[e._v(\"增加子公司\")]),e._v(\" \"),a(\"p\",{staticClass:\"p-btn f-r\",on:{click:function(t){return e.addCompany(0)}}},[e._v(\"增加\")])]),e._v(\" \"),a(\"el-scrollbar\",{staticClass:\"company-tree\"},[a(\"el-tree\",{ref:\"companyTree\",attrs:{data:e.companyData,props:e.companyProps,\"node-key\":\"companyId\",\"highlight-current\":\"\",accordion:\"\"},on:{\"node-click\":e.companyClick}})],1)],1)]),e._v(\" \"),a(\"el-col\",{attrs:{span:10}},[a(\"div\",{staticClass:\"company-info bg\"},[a(\"el-form\",{ref:\"companyForm\",attrs:{model:e.companyForm,autocomplete:\"on\",size:\"mini\"}},[a(\"div\",{staticClass:\"company-title\"},[a(\"p\",{staticClass:\"title f-l\"},[e._v(\"公司信息\")]),e._v(\" \"),a(\"el-button\",{staticClass:\"el-button-default company-info-btn\",attrs:{round:\"\",size:\"mini\"},on:{click:e.editCompanyInfo}},[e._v(e._s(e.companyForm.btnName))]),e._v(\" \"),0===e.companyForm.status?a(\"div\",{staticClass:\"f-r license-time\"},[e._v(\"\\n              许可时间\\n              \"),a(\"div\",[e._v(e._s(e.companyForm.date[0]))]),e._v(\"\\n              至\\n              \"),a(\"div\",[e._v(e._s(e.companyForm.date[1]))])]):e._e()],1),e._v(\" \"),a(\"el-row\",{staticClass:\"company-info-item\"},[a(\"el-col\",{attrs:{span:3}},[a(\"p\",{staticClass:\"lable\"},[e._v(\"名称\")]),e._v(\" \"),a(\"p\",{staticClass:\"lable\"},[e._v(\"性质\")]),e._v(\" \"),a(\"p\",{staticClass:\"lable\"},[e._v(\"类型\")]),e._v(\" \"),1===e.companyForm.status?a(\"p\",{staticClass:\"lable\"},[e._v(\"许可时间\")]):e._e()]),e._v(\" \"),0===e.companyForm.status?a(\"el-col\",{attrs:{span:11}},[a(\"p\",[e._v(e._s(e.companyForm.name))]),e._v(\" \"),a(\"p\",[e._v(e._s(e.companyForm.nature))]),e._v(\" \"),a(\"p\",[e._v(e._s(e.companyForm.type))])]):a(\"el-col\",{staticClass:\"company-info-row1\",attrs:{span:11}},[a(\"el-form-item\",[a(\"el-input\",{attrs:{clearable:\"\",placeholder:\"公司名称\"},model:{value:e.companyForm.name,callback:function(t){e.$set(e.companyForm,\"name\",t)},expression:\"companyForm.name\"}})],1),e._v(\" \"),a(\"el-form-item\",[a(\"el-dropdown\",{attrs:{type:\"primary\",placement:\"bottom-start\",plain:\"\"},on:{command:function(t){var a=arguments.length,s=Array(a);while(a--)s[a]=arguments[a];return e.handleDD.apply(void 0,[1].concat(s))}}},[a(\"el-button\",{staticClass:\"el-dropdown-link\"},[e._v(\"\\n                    \"+e._s(e.companyForm.nature)),a(\"i\",{staticClass:\"el-icon-caret-bottom el-icon--right\"})]),e._v(\" \"),a(\"el-dropdown-menu\",{attrs:{slot:\"dropdown\"},slot:\"dropdown\"},e._l(e.natureList,function(t){return a(\"el-dropdown-item\",{key:t.val,attrs:{command:t}},[e._v(e._s(t.name))])}),1)],1)],1),e._v(\" \"),a(\"el-form-item\",[a(\"el-dropdown\",{attrs:{type:\"primary\",placement:\"bottom-start\",plain:\"\"},on:{command:function(t){var a=arguments.length,s=Array(a);while(a--)s[a]=arguments[a];return e.handleDD.apply(void 0,[2].concat(s))}}},[a(\"el-button\",{staticClass:\"el-dropdown-link\"},[e._v(\"\\n                    \"+e._s(e.companyForm.type)),a(\"i\",{staticClass:\"el-icon-caret-bottom el-icon--right\"})]),e._v(\" \"),a(\"el-dropdown-menu\",{attrs:{slot:\"dropdown\"},slot:\"dropdown\"},e._l(e.typeList,function(t){return a(\"el-dropdown-item\",{key:t.val,attrs:{command:t}},[e._v(e._s(t.name))])}),1)],1)],1),e._v(\" \"),a(\"el-form-item\",[a(\"el-date-picker\",{staticClass:\"date-picker\",attrs:{type:\"daterange\",\"range-separator\":\"至\",\"start-placeholder\":\"开始日期\",\"end-placeholder\":\"结束日期\",align:\"center\"},model:{value:e.companyForm.date,callback:function(t){e.$set(e.companyForm,\"date\",t)},expression:\"companyForm.date\"}})],1)],1),e._v(\" \"),a(\"el-col\",{attrs:{span:3}},[a(\"p\",{staticClass:\"lable info-lable\"},[e._v(\"负责人\")]),e._v(\" \"),a(\"p\",{staticClass:\"lable info-lable\"},[e._v(\"手机号\")]),e._v(\" \"),a(\"p\",{staticClass:\"lable email\"},[e._v(\"邮箱\")])]),e._v(\" \"),0===e.companyForm.status?a(\"el-col\",{attrs:{span:7}},[a(\"p\",[e._v(e._s(e.companyForm.principal))]),e._v(\" \"),a(\"p\",[e._v(e._s(e.companyForm.mobile))]),e._v(\" \"),a(\"p\",[e._v(e._s(e.companyForm.email))])]):a(\"el-col\",{staticClass:\"company-info-row2\",attrs:{span:7}},[a(\"el-form-item\",[a(\"el-input\",{attrs:{clearable:\"\",placeholder:\"负责人\"},model:{value:e.companyForm.principal,callback:function(t){e.$set(e.companyForm,\"principal\",t)},expression:\"companyForm.principal\"}})],1),e._v(\" \"),a(\"el-form-item\",[a(\"el-input\",{attrs:{maxlength:\"11\",clearable:\"\",placeholder:\"手机号\"},model:{value:e.companyForm.mobile,callback:function(t){e.$set(e.companyForm,\"mobile\",t)},expression:\"companyForm.mobile\"}})],1),e._v(\" \"),a(\"el-form-item\",[a(\"el-input\",{attrs:{clearable:\"\",placeholder:\"邮箱\"},model:{value:e.companyForm.email,callback:function(t){e.$set(e.companyForm,\"email\",t)},expression:\"companyForm.email\"}})],1)],1)],1)],1)],1)]),e._v(\" \"),a(\"el-col\",{attrs:{span:9}},[a(\"div\",{staticClass:\"review bg\"},[a(\"div\",{staticClass:\"company-title\"},[a(\"p\",{staticClass:\"title f-l\"},[e._v(\"审批 / 反审\")])]),e._v(\" \"),a(\"div\",{staticClass:\"review-item\"},[a(\"div\",{staticClass:\"review-step\"},[a(\"div\",{staticClass:\"step-icon\"},[a(\"img\",{attrs:{src:e.reviewCompanyStatus.firstAuditstatus>0?e.reviewOk:e.reviewDefault}})]),e._v(\" \"),a(\"div\",{staticClass:\"step-line\"},[a(\"div\"),e._v(\" \"),a(\"div\")]),e._v(\" \"),a(\"div\",{staticClass:\"step-icon\"},[a(\"img\",{attrs:{src:e.reviewCompanyStatus.secondAuditstatus>0?e.reviewOk:e.reviewDefault}})]),e._v(\" \"),a(\"div\",{staticClass:\"step-line\"},[a(\"div\"),e._v(\" \"),a(\"div\")]),e._v(\" \"),a(\"div\",{staticClass:\"step-icon\"},[a(\"img\",{attrs:{src:e.reviewCompanyStatus.thirdAuditstatus>0?e.reviewOk:e.reviewDefault}})])]),e._v(\" \"),a(\"div\",{staticClass:\"step-btn\"},[a(\"div\",[a(\"p\",{staticClass:\"lable\"},[e._v(\"一级审批\")]),e._v(\" \"),1===e.reviewUser.auditorLevel&&!e.isGalasys&&e.selectCompanyId>0?a(\"el-button\",{staticClass:\"el-button-default\",attrs:{round:\"\",size:\"mini\",disabled:e.reviewCompanyStatus.secondAuditstatus>=0},on:{click:function(t){return e.antiReview()}}},[e._v(\"反审\")]):e._e(),e._v(\" \"),a(\"div\",{staticStyle:{height:\"5px\"}}),e._v(\" \"),1===e.reviewUser.auditorLevel&&!e.isGalasys&&e.selectCompanyId>0?a(\"el-button\",{staticClass:\"el-button-default\",attrs:{round:\"\",type:\"primary\",size:\"mini\",disabled:e.getReviewDisable(1)},on:{click:function(t){return e.review()}}},[e._v(\"审批\")]):e._e(),e._v(\" \"),a(\"el-tooltip\",{attrs:{content:\"审批意见:\"+e.reviewCompanyContent.first,placement:\"top\"}},[a(\"div\",{staticClass:\"review-status\",class:e.getReviewClass(e.reviewCompanyStatus.firstAuditstatus)},[e._v(e._s(e.reviewDic(e.reviewCompanyStatus.firstAuditstatus,1)))])])],1),e._v(\" \"),a(\"div\",[a(\"p\",{staticClass:\"lable\"},[e._v(\"二级审批\")]),e._v(\" \"),2===e.reviewUser.auditorLevel&&!e.isGalasys&&e.selectCompanyId>0?a(\"el-button\",{staticClass:\"el-button-default\",attrs:{round:\"\",size:\"mini\",disabled:e.reviewCompanyStatus.thirdAuditstatus>=0},on:{click:function(t){return e.antiReview()}}},[e._v(\"反审\")]):e._e(),e._v(\" \"),a(\"div\",{staticStyle:{height:\"5px\"}}),e._v(\" \"),2===e.reviewUser.auditorLevel&&!e.isGalasys&&e.selectCompanyId>0?a(\"el-button\",{staticClass:\"el-button-default\",attrs:{round:\"\",type:\"primary\",size:\"mini\",disabled:e.getReviewDisable(2)},on:{click:function(t){return e.review()}}},[e._v(\"审批\")]):e._e(),e._v(\" \"),a(\"el-tooltip\",{attrs:{content:\"审批意见:\"+e.reviewCompanyContent.second,placement:\"top\"}},[a(\"div\",{staticClass:\"review-status\",class:e.getReviewClass(e.reviewCompanyStatus.secondAuditstatus)},[e._v(e._s(e.reviewDic(e.reviewCompanyStatus.secondAuditstatus,2)))])])],1),e._v(\" \"),a(\"div\",[a(\"p\",{staticClass:\"lable\"},[e._v(\"三级审批\")]),e._v(\" \"),3===e.reviewUser.auditorLevel&&!e.isGalasys&&e.selectCompanyId>0?a(\"el-button\",{staticClass:\"el-button-default\",attrs:{round:\"\",size:\"mini\"},on:{click:function(t){return e.antiReview()}}},[e._v(\"反审\")]):e._e(),e._v(\" \"),a(\"div\",{staticStyle:{height:\"5px\"}}),e._v(\" \"),3===e.reviewUser.auditorLevel&&!e.isGalasys&&e.selectCompanyId>0?a(\"el-button\",{staticClass:\"el-button-default\",attrs:{round:\"\",type:\"primary\",size:\"mini\",disabled:e.getReviewDisable(3)},on:{click:function(t){return e.review()}}},[e._v(\"审批\")]):e._e(),e._v(\" \"),a(\"el-tooltip\",{attrs:{content:\"审批意见:\"+e.reviewCompanyContent.third,placement:\"top\"}},[a(\"div\",{staticClass:\"review-status\",class:e.getReviewClass(e.reviewCompanyStatus.thirdAuditstatus)},[e._v(e._s(e.reviewDic(e.reviewCompanyStatus.thirdAuditstatus,3)))])])],1)])])])])],1),e._v(\" \"),a(\"el-row\",{staticClass:\"second-row\",attrs:{gutter:15}},[a(\"el-col\",{attrs:{span:5}},[a(\"div\",{staticClass:\"company bg\"},[a(\"div\",{staticClass:\"company-title\"},[a(\"p\",{staticClass:\"title f-l\"},[e._v(\"部门\")]),e._v(\" \"),a(\"p\",{staticClass:\"p-btn f-r\",class:{\"btn-disable\":!e.isGalasys},on:{click:function(t){return e.addDepartment(1)}}},[e._v(\"修改\")]),e._v(\" \"),a(\"p\",{staticClass:\"p-btn f-r\",class:{\"btn-disable\":!e.isGalasys},on:{click:function(t){return e.deleteDepartment()}}},[e._v(\"删除\")]),e._v(\" \"),a(\"p\",{staticClass:\"p-btn f-r\",class:{\"btn-disable\":!e.isGalasys},on:{click:function(t){return e.addDepartment(0)}}},[e._v(\"增加\")])]),e._v(\" \"),a(\"el-scrollbar\",{staticClass:\"company-tree\"},[a(\"el-tree\",{ref:\"departmentTree\",attrs:{data:e.departmentData,props:e.departmentProps,\"node-key\":\"id\",\"highlight-current\":\"\",accordion:\"\"},on:{\"node-click\":e.departmentClick}})],1)],1)]),e._v(\" \"),a(\"el-col\",{attrs:{span:7}},[a(\"div\",{staticClass:\"company bg user-wapper\"},[a(\"div\",{staticClass:\"company-title\"},[a(\"p\",{staticClass:\"title f-l\"},[e._v(\"账号\")]),e._v(\" \"),a(\"el-button\",{class:[\"company-info-btn\",{\"el-button-default\":e.isGalasys}],attrs:{round:\"\",size:\"mini\",disabled:!e.isGalasys},on:{click:function(t){return e.addUser(0)}}},[e._v(\"增加\")])],1),e._v(\" \"),a(\"div\",{staticClass:\"user-table\"},[a(\"el-table\",{directives:[{name:\"loading\",rawName:\"v-loading\",value:e.userLoading,expression:\"userLoading\"}],attrs:{data:e.userList,\"row-key\":e.userList.id,border:\"\",\"header-row-class-name\":\"car-table-header\",\"row-class-name\":\"car-table-item\",\"max-height\":\"100%\",height:\"100%\"}},[a(\"el-table-column\",{attrs:{prop:\"cusName\",label:\"姓名\",width:\"80\"}}),e._v(\" \"),a(\"el-table-column\",{attrs:{prop:\"roleList[0].showName\",label:\"角色\",width:\"80\"}}),e._v(\" \"),a(\"el-table-column\",{attrs:{label:\"操作\",width:\"auto\"},scopedSlots:e._u([{key:\"default\",fn:function(t){return[a(\"div\",{staticClass:\"modify-btn\"},[a(\"p\",{staticClass:\"p-btn\",class:{\"btn-disable\":!e.isGalasys},on:{click:function(a){return e.updateUserRole(t)}}},[e._v(\"修改角色\")]),e._v(\" \"),a(\"p\",{staticClass:\"p-btn\",class:{\"btn-disable\":!e.isGalasys},on:{click:function(a){return e.updateUser(t)}}},[e._v(\"修改\")]),e._v(\" \"),a(\"p\",{staticClass:\"p-btn\",class:{\"btn-disable\":!e.isGalasys},on:{click:function(a){return e.deleteUserById(t)}}},[e._v(\"删除\")])])]}}])})],1)],1)]),e._v(\" \"),a(\"div\",{staticClass:\"company bg role-wapper\"},[a(\"div\",{staticClass:\"company-title\"},[a(\"p\",{staticClass:\"title f-l\"},[e._v(\"角色\")]),e._v(\" \"),a(\"el-button\",{class:[\"company-info-btn\",{\"el-button-default\":e.isGalasys}],attrs:{round:\"\",size:\"mini\",disabled:!e.isGalasys},on:{click:function(t){return e.addRole()}}},[e._v(\"增加\")])],1),e._v(\" \"),a(\"div\",{staticClass:\"user-table\"},[a(\"el-table\",{directives:[{name:\"loading\",rawName:\"v-loading\",value:e.roleLoading,expression:\"roleLoading\"}],attrs:{data:e.roleList,\"row-key\":e.roleList.id,border:\"\",\"header-row-class-name\":\"car-table-header\",\"row-class-name\":\"car-table-item\",\"max-height\":\"100%\",height:\"100%\"}},[a(\"el-table-column\",{attrs:{prop:\"showName\",label:\"角色\",width:\"120\"}}),e._v(\" \"),a(\"el-table-column\",{attrs:{label:\"操作\",width:\"auto\"},scopedSlots:e._u([{key:\"default\",fn:function(t){return[a(\"div\",{staticClass:\"modify-btn\"},[a(\"p\",{staticClass:\"p-btn\",class:{\"btn-disable\":!e.isGalasys},on:{click:function(a){return e.updateRole(t.row)}}},[e._v(\"修改\")]),e._v(\" \"),a(\"p\",{staticClass:\"p-btn\",class:{\"btn-disable\":!e.isGalasys},on:{click:function(a){return e.deleteRole(t.row)}}},[e._v(\"删除\")])])]}}])})],1)],1)])]),e._v(\" \"),a(\"el-col\",{attrs:{span:12}},[a(\"div\",{staticClass:\"company bg\"},[a(\"div\",{staticClass:\"company-title\",staticStyle:{height:\"30px\"}},[a(\"p\",{staticClass:\"title f-l\"},[e._v(\"授权\")])]),e._v(\" \"),a(\"div\",{staticClass:\"auth-wapper\"},[a(\"tree-transfer\",{ref:\"treeTransfer\",attrs:{\"select-company-id\":e.selectCompanyId,\"btn-status\":e.authStatus},on:{authend:function(t){e.authLoading=!1}}}),e._v(\" \"),a(\"el-button\",{class:[\"company-info-btn\",\"auth-edit-btn\",{\"el-button-default\":!e.authBtnStatus}],attrs:{round:\"\",size:\"mini\",loading:e.authLoading,disabled:e.authBtnStatus},on:{click:e.authEdit}},[e._v(e._s(e.authBtnText))])],1)])])],1),e._v(\" \"),a(\"el-dialog\",{staticClass:\"mini-form\",attrs:{visible:e.showAddCompany,title:0===e.addCompanyType?\"新增公司\":\"新增子公司\",width:\"730px\"},on:{\"update:visible\":function(t){e.showAddCompany=t}}},[e.showAddCompany?a(\"el-form\",{ref:\"addCompanyForm\",staticClass:\"add-company-dlg\",attrs:{model:e.addCompanyForm,rules:e.addCompanyRules,\"label-width\":\"80px\",\"hide-required-asterisk\":\"\",autocomplete:\"on\",size:\"mini\"}},[a(\"el-row\",{attrs:{gutter:15}},[a(\"el-col\",{attrs:{span:12}},[a(\"el-form-item\",{attrs:{label:\"名称\",prop:\"name\"}},[a(\"el-input\",{attrs:{clearable:\"\",placeholder:\"公司名称\"},model:{value:e.addCompanyForm.name,callback:function(t){e.$set(e.addCompanyForm,\"name\",t)},expression:\"addCompanyForm.name\"}})],1),e._v(\" \"),a(\"el-form-item\",{attrs:{label:\"性质\"}},[a(\"el-dropdown\",{attrs:{type:\"primary\",placement:\"bottom-start\",plain:\"\"},on:{command:function(t){var a=arguments.length,s=Array(a);while(a--)s[a]=arguments[a];return e.handleDD.apply(void 0,[3].concat(s))}}},[a(\"el-button\",{staticClass:\"el-dropdown-link\"},[e._v(\"\\n                \"+e._s(e.addCompanyForm.nature)),a(\"i\",{staticClass:\"el-icon-caret-bottom el-icon--right\"})]),e._v(\" \"),a(\"el-dropdown-menu\",{attrs:{slot:\"dropdown\"},slot:\"dropdown\"},e._l(e.natureList,function(t){return a(\"el-dropdown-item\",{key:t.val,attrs:{command:t}},[e._v(e._s(t.name))])}),1)],1)],1),e._v(\" \"),a(\"el-form-item\",{attrs:{label:\"类型\",prop:\"type\"}},[a(\"el-dropdown\",{attrs:{type:\"primary\",placement:\"bottom-start\",plain:\"\"},on:{command:function(t){var a=arguments.length,s=Array(a);while(a--)s[a]=arguments[a];return e.handleDD.apply(void 0,[4].concat(s))}}},[a(\"el-button\",{staticClass:\"el-dropdown-link\"},[e._v(\"\\n                \"+e._s(e.addCompanyForm.type)),a(\"i\",{staticClass:\"el-icon-caret-bottom el-icon--right\"})]),e._v(\" \"),a(\"el-dropdown-menu\",{attrs:{slot:\"dropdown\"},slot:\"dropdown\"},e._l(e.typeList,function(t){return a(\"el-dropdown-item\",{key:t.val,attrs:{command:t}},[e._v(e._s(t.name))])}),1)],1)],1),e._v(\" \"),a(\"el-form-item\",{attrs:{label:\"许可时间\",prop:\"companyName\"}},[a(\"el-date-picker\",{staticClass:\"date-picker\",attrs:{type:\"daterange\",\"range-separator\":\"至\",\"start-placeholder\":\"开始日期\",\"end-placeholder\":\"结束日期\",align:\"center\"},model:{value:e.addCompanyForm.date,callback:function(t){e.$set(e.addCompanyForm,\"date\",t)},expression:\"addCompanyForm.date\"}})],1)],1),e._v(\" \"),a(\"el-col\",{attrs:{span:12}},[a(\"el-form-item\",{attrs:{label:\"负责人\",prop:\"principal\"}},[a(\"el-input\",{attrs:{clearable:\"\",placeholder:\"负责人\"},model:{value:e.addCompanyForm.principal,callback:function(t){e.$set(e.addCompanyForm,\"principal\",t)},expression:\"addCompanyForm.principal\"}})],1),e._v(\" \"),a(\"el-form-item\",{attrs:{label:\"手机号\",prop:\"mobile\"}},[a(\"el-input\",{attrs:{maxlength:\"11\",clearable:\"\",placeholder:\"手机号\"},model:{value:e.addCompanyForm.mobile,callback:function(t){e.$set(e.addCompanyForm,\"mobile\",t)},expression:\"addCompanyForm.mobile\"}})],1),e._v(\" \"),a(\"el-form-item\",{attrs:{label:\"邮箱\",prop:\"email\"}},[a(\"el-input\",{attrs:{type:\"email\",clearable:\"\",placeholder:\"邮箱\"},model:{value:e.addCompanyForm.email,callback:function(t){e.$set(e.addCompanyForm,\"email\",t)},expression:\"addCompanyForm.email\"}})],1)],1)],1)],1):e._e(),e._v(\" \"),a(\"span\",{staticClass:\"dialog-footer\",attrs:{slot:\"footer\"},slot:\"footer\"},[a(\"el-button\",{staticClass:\"el-button-default\",attrs:{round:\"\",size:\"mini\"},on:{click:e.cancelCompany}},[e._v(\"取消\")]),e._v(\" \"),a(\"el-button\",{attrs:{round:\"\",size:\"mini\",loading:e.addCompanyLoading,type:\"primary\"},on:{click:e.submitCompany}},[e._v(\"确定\")])],1)],1),e._v(\" \"),a(\"el-dialog\",{attrs:{visible:e.showDepartment,title:0===e.addDepartmentType?\"新增部门\":\"修改部门\",width:\"30%\"},on:{\"update:visible\":function(t){e.showDepartment=t}}},[e.showDepartment?a(\"el-form\",{ref:\"addDepartmentForm\",staticClass:\"add-company-dlg\",attrs:{model:e.addDepartmentForm,rules:e.addDepartmentRules,\"hide-required-asterisk\":\"\",\"label-width\":\"80px\",autocomplete:\"on\",size:\"mini\"}},[1===e.addDepartmentType?a(\"el-form-item\",{attrs:{label:\"原名称\"}},[a(\"el-input\",{attrs:{disabled:!0,placeholder:\"原名称\"},model:{value:e.addDepartmentForm.oldName,callback:function(t){e.$set(e.addDepartmentForm,\"oldName\",t)},expression:\"addDepartmentForm.oldName\"}})],1):e._e(),e._v(\" \"),a(\"el-form-item\",{attrs:{label:\"部门名称\",prop:\"name\"}},[a(\"el-input\",{attrs:{clearable:\"\",placeholder:\"部门名称\"},model:{value:e.addDepartmentForm.name,callback:function(t){e.$set(e.addDepartmentForm,\"name\",t)},expression:\"addDepartmentForm.name\"}})],1)],1):e._e(),e._v(\" \"),a(\"span\",{staticClass:\"dialog-footer\",attrs:{slot:\"footer\"},slot:\"footer\"},[a(\"el-button\",{staticClass:\"el-button-default\",attrs:{round:\"\",size:\"mini\"},on:{click:e.cancelDepartment}},[e._v(\"取消\")]),e._v(\" \"),a(\"el-button\",{attrs:{round:\"\",size:\"mini\",type:\"primary\"},on:{click:e.submitDepartment}},[e._v(\"确定\")])],1)],1),e._v(\" \"),a(\"el-dialog\",{attrs:{visible:e.showUser,title:0===e.addUserType?\"新增用户\":\"修改用户\",width:\"700px\"},on:{\"update:visible\":function(t){e.showUser=t}}},[e.showUser?a(\"account\",{attrs:{\"user-info\":e.addUserInfo},on:{canceluser:function(t){e.showUser=!1},submituser:e.submitUser}}):e._e()],1),e._v(\" \"),a(\"el-dialog\",{staticClass:\"mini-form\",attrs:{visible:e.showUserRole,title:\"修改用户角色\",width:\"300px\"},on:{\"update:visible\":function(t){e.showUserRole=t}}},[e.showUserRole?a(\"el-form\",{staticClass:\"add-company-dlg\",attrs:{\"label-width\":\"80px\",\"hide-required-asterisk\":\"\",autocomplete:\"on\",size:\"mini\"}},[a(\"el-form-item\",{attrs:{label:\"角色名称\"}},[a(\"el-dropdown\",{attrs:{type:\"primary\",placement:\"bottom-start\",plain:\"\"},on:{command:function(t){return e.handleRoleDD.apply(void 0,arguments)}}},[a(\"el-button\",{staticClass:\"el-dropdown-link\"},[e._v(\"\\n            \"+e._s(e.userRoleForm.showName)),a(\"i\",{staticClass:\"el-icon-caret-bottom el-icon--right\"})]),e._v(\" \"),a(\"el-dropdown-menu\",{attrs:{slot:\"dropdown\"},slot:\"dropdown\"},e._l(e.roleList,function(t){return a(\"el-dropdown-item\",{key:t.id,attrs:{command:t}},[e._v(e._s(t.showName))])}),1)],1)],1)],1):e._e(),e._v(\" \"),a(\"span\",{staticClass:\"dialog-footer\",attrs:{slot:\"footer\"},slot:\"footer\"},[a(\"el-button\",{staticClass:\"el-button-default\",attrs:{round:\"\",size:\"mini\"},on:{click:e.cancelUserRole}},[e._v(\"取消\")]),e._v(\" \"),a(\"el-button\",{attrs:{round:\"\",size:\"mini\",type:\"primary\"},on:{click:e.submitUserRole}},[e._v(\"确定\")])],1)],1),e._v(\" \"),a(\"el-dialog\",{attrs:{visible:e.showRole,title:0===e.addRoleType?\"新增角色\":\"修改角色\",width:\"80%\"},on:{\"update:visible\":function(t){e.showRole=t}}},[e.showRole?a(\"role\",{ref:\"roleDlg\",attrs:{\"add-type\":e.addRoleType,\"role-id\":e.addRoleId,\"company-id\":e.selectCompanyId,\"role-name\":e.addRoleName},on:{cancelrole:function(t){e.showRole=!1},submitrole:e.submitRole}}):e._e()],1),e._v(\" \"),a(\"el-dialog\",{attrs:{visible:e.showReview,title:0===e.reviewType?\"审批通过\":\"反审\",width:\"400px\"},on:{\"update:visible\":function(t){e.showReview=t}}},[e.showReview?a(\"el-form\",{staticClass:\"add-company-dlg\",attrs:{\"label-width\":\"80px\",\"hide-required-asterisk\":\"\",autocomplete:\"off\",size:\"mini\"}},[a(\"el-form-item\",{attrs:{label:\"审批\"}},[a(\"el-select\",{staticStyle:{width:\"100%\"},attrs:{placeholder:\"请选择\"},model:{value:e.reviewStatus,callback:function(t){e.reviewStatus=t},expression:\"reviewStatus\"}},[a(\"el-option\",{attrs:{label:\"通过\",value:\"通过\"}}),e._v(\" \"),a(\"el-option\",{attrs:{label:\"不通过\",value:\"不通过\"}})],1)],1),e._v(\" \"),a(\"el-form-item\",{attrs:{label:\"审批意见\"}},[a(\"el-input\",{attrs:{type:\"textarea\",placeholder:\"请输入审批意见\",rows:\"3\"},model:{value:e.reviewText,callback:function(t){e.reviewText=t},expression:\"reviewText\"}})],1)],1):e._e(),e._v(\" \"),a(\"span\",{staticClass:\"dialog-footer\",attrs:{slot:\"footer\"},slot:\"footer\"},[a(\"el-button\",{staticClass:\"el-button-default\",attrs:{round:\"\",size:\"mini\"},on:{click:e.cancelReview}},[e._v(\"取消\")]),e._v(\" \"),a(\"el-button\",{attrs:{round:\"\",loading:e.reviewLoading,size:\"mini\",type:\"primary\"},on:{click:e.submitReview}},[e._v(\"确定\")])],1)],1)],1)},n=[],o=(a(\"ac6a\"),a(\"28a5\"),a(\"7f7f\"),a(\"0d5e\")),i=a(\"61f7\"),r=a(\"ed08\"),l=a(\"78d1\"),c=a(\"31ce\"),d=a(\"78ed\"),u=a(\"f7ad\"),m=a.n(u),p=a(\"5368\"),h=a.n(p),f={components:{TreeTransfer:l[\"default\"],Role:c[\"default\"],Account:d[\"default\"]},data:function(){var e=new Date,t=function(e,t,a){\"\"===t?a(new Error(\"请输入手机号码\")):Object(i[\"e\"])(t)?a():a(new Error(\"手机号输入不正确!\"))},a=function(e,t,a){\"\"===t?a(new Error(\"请输入邮箱\")):Object(i[\"d\"])(t)?a():a(new Error(\"邮箱格式不正确!\"))};return{reviewUser:{id:0,auditorId:0,auditorName:\"\",auditorEmail:\"\",auditorLevel:0},reviewType:0,showReview:!1,reviewText:\"\",reviewStatus:\"通过\",isGalasys:!1,companyDelBtn:!1,selectCompanyNode:null,selectCompanyId:0,selectLicenseId:0,natureList:[],typeList:[],companyData:[],companyProps:{children:\"children\",label:\"companyName\"},companyForm:{btnName:\"编辑\",status:0,companyId:0,name:\"\",principal:\"\",nature:\"\",natureId:0,mobile:\"\",type:\"\",typeId:0,email:\"\",date:[\"\",\"\"]},showAddCompany:!1,addCompanyType:0,addCompanyForm:{name:\"\",principal:\"\",nature:\"\",natureId:0,mobile:\"\",type:\"\",typeId:0,email:\"\",licenseId:0,date:[e.getFullYear()+\"-\"+(e.getMonth()+1)+\"-\"+e.getDate(),e.getFullYear()+1+\"-\"+(e.getMonth()+1)+\"-\"+e.getDate()]},addCompanyRules:{name:[{required:!0,message:\"请输入公司名称\",trigger:\"blur\"}],principal:[{required:!0,message:\"请输入负责人\",trigger:\"blur\"}],mobile:[{required:!0,validator:t,trigger:\"blur\"}],email:[{required:!0,validator:a,trigger:\"blur\"}]},addCompanyLoading:!1,reviewOk:m.a,reviewDefault:h.a,reviewCompanyStatus:{auditStatus:0,id:0,licenseEnd:\"\",licenseStart:\"\",firstAuditstatus:0,secondAuditstatus:0,thirdAuditstatus:0,updateBy:null,updateDate:null},reviewCompanyContent:{first:\"\",firstResult:0,second:\"\",secondResult:0,third:\"\",thirdResult:0},departmentData:[],departmentProps:{children:\"children\",label:\"name\"},showDepartment:!1,addDepartmentForm:{name:\"\",oldName:\"\"},addDepartmentRules:{name:[{required:!0,message:\"请输入部门名称\",trigger:\"blur\"}]},addDepartmentType:0,selectDepartmentNode:null,userSearchType:0,userLoading:!1,userList:[],showUser:!1,addUserType:0,addUserInfo:{uid:0,type:0,cpid:\"\",deptId:\"\",cusName:\"\",phone:\"\",postName:\"\",cusPassword:\"\",cusPic:\"\"},showUserRole:!1,userRoleForm:{id:0,index:-1,showName:\"\",roleId:0},roleLoading:!1,roleList:[],showRole:!1,addRoleId:0,addRoleType:0,addRoleName:\"\",authStatus:0,authBtnText:\"编辑\",authBtnStatus:!0,authLoading:!1,reviewLoading:!1}},mounted:function(){this.init(),this.initDDData()},methods:{init:function(){var e=this;Object(o[\"b\"])(\"/company/tree\",null).then(function(t){0===t.status&&(e.companyData=t.data)}),Object(o[\"b\"])(\"/license/auditors\",null).then(function(t){if(0===t.status){var a=t.data.filter(function(t){return t.auditorId===e.$store.state.user.uid&&t.auditorLevel>0});a.length>0&&(e.reviewUser=a[0])}})},initDDData:function(){var e=this;Object(o[\"b\"])(\"/company/const\",null).then(function(t){0===t.status&&(e.natureList=t.data.natures,e.typeList=t.data.types,e.addCompanyForm.nature=e.natureList[1].name,e.addCompanyForm.natureId=e.natureList[1].val,e.addCompanyForm.type=e.typeList[0].name,e.addCompanyForm.typeId=e.typeList[0].val)})},reviewDic:function(e,t){var a=\"\",s=\"\";switch(t){case 1:s=1===this.reviewCompanyContent.firstResult?\"通过\":\"不通过\";break;case 2:s=1===this.reviewCompanyContent.secondResult?\"通过\":\"不通过\";break;case 3:s=1===this.reviewCompanyContent.thirdResult?\"通过\":\"不通过\";break;default:break}return a=e>0?\"审批:\"+s:e<0?\"反审:\"+s:\"待审核\",a},getReviewClass:function(e){var t=\"\";return e<=0&&(t=0===e?\"review-pending\":\"review-return\"),t},getReviewDisable:function(e){var t=!1;switch(e){case 1:1===this.reviewCompanyStatus.secondAuditstatus&&1===this.reviewCompanyContent.secondResult&&(t=!0);break;case 2:(1!==this.reviewCompanyContent.firstResult||1===this.reviewCompanyStatus.thirdAuditstatus&&1===this.reviewCompanyContent.thirdResult)&&(t=!0);break;case 3:1!==this.reviewCompanyContent.secondResult&&(t=!0);break;default:break}return t},addCompany:function(e){this.addCompanyType=e,this.showAddCompany=!0},deleteCompany:function(){var e=this;null===this.selectCompanyNode?this.$message({message:\"请选择需要删除的公司\",type:\"warning\",duration:3e3}):this.$confirm('是否删除公司\"'+this.selectCompanyNode.companyName+'\"',\"提示\",{confirmButtonText:\"确定\",cancelButtonText:\"取消\",type:\"warning\"}).then(function(){Object(o[\"a\"])(\"/company/\"+e.selectCompanyNode.companyId,null).then(function(t){0===t.status?(e.$refs.companyTree.remove(e.selectCompanyNode),e.selectCompanyId=0,e.companyForm.btnName=\"编辑\",e.companyForm.status=0,e.companyForm.companyId=0,e.companyForm.name=\"\",e.companyForm.principal=\"\",e.companyForm.nature=\"\",e.companyForm.natureId=0,e.companyForm.mobile=\"\",e.companyForm.type=\"\",e.companyForm.typeId=0,e.companyForm.email=\"\",e.companyForm.licenseId=0,e.companyForm.date=[\"\",\"\"],e.selectCompanyNode=null,e.selectDepartmentNode=null,e.userList=[],e.roleList=[],e.$message({message:\"公司删除成功\",type:\"success\",duration:3e3})):e.$message({message:t.msg,type:\"warning\",duration:3e3})})}).catch(function(){})},getRootNode:function(e){return 1===e.level?e.data:this.getRootNode(e.parent)},companyClick:function(e,t){this.selectCompanyNode=e,12===e.companyId?(this.companyDelBtn=!1,this.isGalasys=!0,this.showCompanyInfo(e)):12===this.getRootNode(t).companyId?(this.isGalasys=!0,this.companyDelBtn=!0,this.showCompanyInfo(e)):e.pid>0?(this.isGalasys=!1,this.companyDelBtn=!1,this.showCompanyInfo(this.getRootNode(t))):(this.isGalasys=!1,this.companyDelBtn=!0,this.showCompanyInfo(e))},showCompanyInfo:function(e){this.selectCompanyId=e.companyId,this.selectLicenseId=e.licenseId,this.companyForm.companyId=e.companyId,this.companyForm.name=e.companyName,this.companyForm.principal=e.master,this.companyForm.natureId=e.companyNature,this.companyForm.nature=this.natureList.filter(function(t){if(t.val===e.companyNature)return t})[0].name,this.companyForm.mobile=e.phone,this.companyForm.typeId=e.companyType,this.companyForm.type=this.typeList.filter(function(t){if(t.val===e.companyType)return t})[0].name,this.companyForm.email=e.email,this.companyForm.licenseId=e.licenseId,this.companyForm.date=[e.sysLicense.licenseStart.split(\" \")[0],e.sysLicense.licenseEnd.split(\" \")[0]],this.reviewCompanyStatus=e.sysLicense,console.log(e.sysLicense),12===e.companyId?this.authBtnStatus=!1:1===e.sysLicense.firstAuditstatus||1===e.sysLicense.secondAuditstatus||1===e.sysLicense.thirdAuditstatus?this.authBtnStatus=!0:this.authBtnStatus=!1,this.getDepartmentInfo(e.companyId),this.getRoleInfo(e.companyId),this.userSearchType=0,this.getUserInfoByCompany(e.companyId),this.getCompanyStatus(e.licenseId)},getCompanyStatus:function(e){var t=this;Object(o[\"b\"])(\"/license/message/\"+e,null).then(function(e){0===e.status&&e.data.forEach(function(e){if(null!==e)switch(Math.abs(e.auditorLevel)){case 1:t.reviewCompanyContent.first=e.auditMsg,t.reviewCompanyContent.firstResult=e.auditResult;break;case 2:t.reviewCompanyContent.second=e.auditMsg,t.reviewCompanyContent.secondResult=e.auditResult;break;case 3:t.reviewCompanyContent.third=e.auditMsg,t.reviewCompanyContent.thirdResult=e.auditResult;break;default:break}})})},handleDD:function(e,t){switch(e){case 1:this.companyForm.nature=t.name,this.companyForm.natureId=t.val;break;case 2:this.companyForm.type=t.name,this.companyForm.typeId=t.val;break;case 3:this.addCompanyForm.nature=t.name,this.addCompanyForm.natureId=t.val;break;case 4:this.addCompanyForm.type=t.name,this.addCompanyForm.typeId=t.val;break;default:break}},submitCompany:function(){var e=this,t=this;this.$refs.addCompanyForm.validate(function(a){if(a){var s={pid:0===e.addCompanyType?0:e.selectCompanyNode.companyId,companyName:e.addCompanyForm.name,companyNature:e.addCompanyForm.natureId,companyType:e.addCompanyForm.typeId,email:e.addCompanyForm.email,master:e.addCompanyForm.principal,phone:e.addCompanyForm.mobile,sysLicense:{licenseStart:Object(r[\"c\"])(e.addCompanyForm.date[0],\"{y}-{m}-{d} 00:00:00\"),licenseEnd:Object(r[\"c\"])(e.addCompanyForm.date[1],\"{y}-{m}-{d} 23:59:59\")}};e.addCompanyLoading=!0,Object(o[\"c\"])(\"/company\",s).then(function(a){0===a.status?(e.addCompanyLoading=!1,e.$refs.companyTree.append(a.data,a.data.pid),e.$message({message:\"公司添加成功\",type:\"success\",duration:3e3})):e.$message({message:a.msg,type:\"warning\",duration:3e3}),t.cancelCompany()})}})},cancelCompany:function(){this.showAddCompany=!1;var e=new Date;this.addCompanyForm.date=[e.getFullYear()+\"-\"+(e.getMonth()+1)+\"-\"+e.getDate(),e.getFullYear()+1+\"-\"+(e.getMonth()+1)+\"-\"+e.getDate()],this.$refs.addCompanyForm.resetFields()},editCompanyInfo:function(){var e=this;if(this.companyForm.companyId<=0)this.$message({message:\"请选择需要编辑的公司\",type:\"warning\",duration:3e3});else if(0===this.companyForm.status)this.companyForm.btnName=\"保存\",this.companyForm.status=1;else{var t=\"\";if(\"\"===this.companyForm.name?t=\"请输入公司名称\":\"\"===this.companyForm.principal?t=\"请输入负责人\":\"\"===this.companyForm.mobile?t=\"请输入手机号\":Object(i[\"e\"])(this.companyForm.mobile)?\"\"===this.companyForm.email?t=\"请输入邮箱\":Object(i[\"d\"])(this.companyForm.email)||(t=\"邮箱格式输入不正确\"):t=\"手机号格式输入不正确\",\"\"===t){var a={companyId:this.companyForm.companyId,companyName:this.companyForm.name,companyNature:this.companyForm.natureId,companyType:this.companyForm.typeId,email:this.companyForm.email,master:this.companyForm.principal,phone:this.companyForm.mobile,licenseId:this.companyForm.licenseId,sysLicense:{licenseStart:Object(r[\"c\"])(this.companyForm.date[0],\"{y}-{m}-{d}\"),licenseEnd:Object(r[\"c\"])(this.companyForm.date[1],\"{y}-{m}-{d}\")}};Object(o[\"d\"])(\"/company\",a).then(function(t){0===t.status?(e.$message({message:\"公司编辑成功\",type:\"success\",duration:3e3}),e.companyData=t.data,e.companyForm.btnName=\"编辑\",e.companyForm.status=0):e.$message({message:t.msg,type:\"warning\",duration:3e3})})}else this.$message({message:t,type:\"warning\",duration:3e3})}},getDepartmentInfo:function(e){var t=this;Object(o[\"b\"])(\"/dept/list/\"+e,null).then(function(e){0===e.status&&(t.departmentData=e.data)})},departmentClick:function(e){this.selectDepartmentNode=e,this.addDepartmentForm.oldName=e.name,this.userSearchType=1,this.getUserInfoByDepartment(e.id)},addDepartment:function(e){null===this.selectCompanyNode?this.$message({message:\"请选择需要添加部门的公司\",type:\"warning\",duration:3e3}):(this.addDepartmentType=e,this.showDepartment=!0)},deleteDepartment:function(){var e=this;null===this.selectDepartmentNode?this.$message({message:\"请选择需要删除的部门\",type:\"warning\",duration:3e3}):this.$confirm('是否删除部门\"'+this.selectDepartmentNode.name+'\"',\"提示\",{confirmButtonText:\"确定\",cancelButtonText:\"取消\",type:\"warning\"}).then(function(){Object(o[\"a\"])(\"/dept/\"+e.selectDepartmentNode.id,null).then(function(t){0===t.status?(e.$refs.departmentTree.remove(e.selectDepartmentNode),e.selectDepartmentNode=null,e.$message({message:\"部门删除成功\",type:\"success\",duration:3e3})):e.$message({message:t.msg,type:\"warning\",duration:3e3})})}).catch(function(){})},submitDepartment:function(){var e=this,t=this;this.$refs.addDepartmentForm.validate(function(a){if(a){var s={id:null,cpid:null,name:e.addDepartmentForm.name};0===e.addDepartmentType?(s.cpid=e.selectCompanyNode.companyId,Object(o[\"c\"])(\"/dept\",s).then(function(a){0===a.status?(e.$message({message:\"部门添加成功\",type:\"success\",duration:3e3}),e.$refs.departmentTree.append(a.data,0)):e.$message({message:a.msg,type:\"warning\",duration:3e3}),t.cancelDepartment()})):Object(o[\"d\"])(\"/dept/\"+e.selectDepartmentNode.id+\"/\"+e.selectCompanyNode.companyId+\"/\"+e.addDepartmentForm.name,null).then(function(a){0===a.status?(e.departmentData=a.data,e.$message({message:\"部门修改成功\",type:\"success\",duration:3e3})):e.$message({message:a.msg,type:\"warning\",duration:3e3}),t.cancelDepartment()})}})},cancelDepartment:function(){this.showDepartment=!1,this.$refs.addDepartmentForm.resetFields()},getRoleInfo:function(e){var t=this;this.roleLoading=!0,Object(o[\"b\"])(\"/role/list/\"+e,null).then(function(e){t.roleLoading=!1,0===e.status&&(t.roleList=e.data)})},addUser:function(e){null===this.selectDepartmentNode?this.$message({message:\"请选择需要添加用户的部门\",type:\"warning\",duration:3e3}):(this.addUserInfo.cpid=this.selectCompanyNode.companyId,this.addUserInfo.deptId=this.selectDepartmentNode.id,this.addUserInfo.userId=0,this.addUserInfo.cusName=\"\",this.addUserInfo.phone=\"\",this.addUserInfo.postName=\"\",this.addUserInfo.cusPic=\"\",this.addUserInfo.type=e,this.addUserType=e,this.showUser=!0)},updateUser:function(e){this.addUserInfo.cpid=e.row.cpid,this.addUserInfo.deptId=e.row.deptId,this.addUserInfo.userId=e.row.userId,this.addUserInfo.cusName=e.row.cusName,this.addUserInfo.phone=e.row.phone,this.addUserInfo.postName=e.row.postName,this.addUserInfo.cusPic=e.row.cusPic,this.addUserInfo.type=1,this.addUserType=1,this.showUser=!0},handleRoleDD:function(e){this.userRoleForm.showName=e.showName,this.userRoleForm.roleId=e.id},cancelUserRole:function(){this.userRoleForm.id=0,this.userRoleForm.index=-1,this.userRoleForm.showName=\"\",this.userRoleForm.roleId=0,this.showUserRole=!1},updateUserRole:function(e){this.userRoleForm.id=e.row.userId,this.userRoleForm.index=e.$index,this.userRoleForm.showName=e.row.roleList.length>0?e.row.roleList[0].showName:\"\",this.showUserRole=!0},submitUserRole:function(){var e=this;this.userRoleForm.roleId<=0?this.$message({message:\"请选择角色\",type:\"warning\",duration:3e3}):Object(o[\"d\"])(\"/user/\"+this.userRoleForm.id+\"/\"+this.userRoleForm.roleId,null).then(function(t){0===t.status?(e.userList[e.userRoleForm.index].roleList.length>0?e.userList[e.userRoleForm.index].roleList[0].showName=e.userRoleForm.showName:e.userList[e.userRoleForm.index].roleList.push({id:e.userRoleForm.roleId,showName:e.userRoleForm.showName}),e.$message({message:\"用户角色修改成功\",type:\"success\",duration:3e3})):e.$message({message:t.msg,type:\"warning\",duration:3e3}),e.showUserRole=!1})},deleteUserById:function(e){var t=this;this.$confirm('确定删除用户\"'+e.row.cusName+'\"吗？',\"提示\",{confirmButtonText:\"确定\",cancelButtonText:\"取消\",type:\"warning\"}).then(function(){Object(o[\"a\"])(\"/user/\"+e.row.userId,null).then(function(a){0===a.status?(t.$message({message:'用户\"'+e.row.cusName+'\"删除成功',type:\"success\",duration:3e3}),t.userList.splice(e.$index)):t.$message({message:a.msg,type:\"warning\",duration:3e3})})})},submitUser:function(){this.showUser=!1,0===this.userSearchType?this.getUserInfoByCompany(this.selectCompanyId):this.getUserInfoByDepartment(this.selectDepartmentNode.id)},getUserInfoByCompany:function(e){var t=this;this.userLoading=!0,Object(o[\"b\"])(\"/user/list/cp\"+e,null).then(function(e){t.userLoading=!1,0===e.status&&(t.userList=e.data)})},getUserInfoByDepartment:function(e){var t=this;this.userLoading=!0,Object(o[\"b\"])(\"/user/list/dp\"+e,null).then(function(e){t.userLoading=!1,0===e.status&&(t.userList=e.data)})},addRole:function(){null===this.selectCompanyNode?this.$message({message:\"请选择需要添加角色的公司\",type:\"warning\",duration:3e3}):(this.addRoleType=0,this.addRoleId=0,this.addRoleName=\"\",this.showRole=!0)},updateRole:function(e){this.addRoleType=1,this.addRoleId=e.id,this.addRoleName=e.showName,this.showRole=!0},deleteRole:function(e){var t=this;this.$confirm('确定删除角色\"'+e.showName+'\"吗？',\"提示\",{confirmButtonText:\"确定\",cancelButtonText:\"取消\",type:\"warning\"}).then(function(){Object(o[\"c\"])(\"/role/del/\"+e.id,null).then(function(a){0===a.status?(t.getRoleInfo(t.selectCompanyId),t.$message({message:'角色\"'+e.showName+'\"删除成功',type:\"success\",duration:3e3})):t.$message({message:a.msg,type:\"warning\",duration:3e3})})})},submitRole:function(){this.showRole=!1,this.getRoleInfo(this.selectCompanyId)},authEdit:function(){0===this.authStatus?(this.authStatus=1,this.authBtnText=\"保存\"):(this.authStatus=0,this.authBtnText=\"编辑\",this.authLoading=!0,this.$refs.treeTransfer.saveAuth())},review:function(){this.reviewType=0,this.reviewStatus=\"通过\",this.showReview=!0},antiReview:function(){this.reviewType=1,this.reviewStatus=\"通过\",this.showReview=!0},cancelReview:function(){this.reviewText=\"\",this.showReview=!1},submitReview:function(){var e=this;if(12!==this.selectCompanyId){var t={licenseId:this.selectLicenseId,auditorId:this.$store.state.user.uid,auditorName:this.reviewUser.auditorName,auditorEmail:this.reviewUser.auditorEmail,auditMsg:this.reviewText,auditResult:\"通过\"===this.reviewStatus?1:0,auditorLevel:this.reviewUser.auditorLevel*(0===this.reviewType?1:-1)};this.reviewLoading=!0,Object(o[\"c\"])(\"/license/audit\",t).then(function(a){if(e.reviewLoading=!1,0===a.status){for(var s=e.companyData.length,n=0;n<s;n++)if(e.companyData[n].companyId===e.selectCompanyId)switch(e.reviewUser.auditorLevel){case 1:e.reviewCompanyContent.first=e.reviewText,e.reviewCompanyContent.firstResult=t.auditResult,e.companyData[n].sysLicense.firstAuditstatus=0===e.reviewType?1:-1;break;case 2:e.reviewCompanyContent.second=e.reviewText,e.reviewCompanyContent.secondResult=t.auditResult,e.companyData[n].sysLicense.secondAuditstatus=0===e.reviewType?1:-1;break;case 3:e.reviewCompanyContent.third=e.reviewText,e.reviewCompanyContent.thirdResult=t.auditResult,e.companyData[n].sysLicense.thirdAuditstatus=0===e.reviewType?1:-1;break;default:break}e.$message({message:(0===e.reviewType?\"审批\":\"反审\")+\"成功\",type:\"success\",duration:3e3})}else e.$message({message:a.msg,type:\"warning\",duration:3e3});e.cancelReview()})}}}},y=f,v=(a(\"a76e\"),a(\"15f5\"),a(\"2877\")),g=Object(v[\"a\"])(y,s,n,!1,null,\"0873ec72\",null);t[\"default\"]=g.exports},\"0d5e\":function(e,t,a){\"use strict\";a.d(t,\"b\",function(){return n}),a.d(t,\"c\",function(){return o}),a.d(t,\"d\",function(){return i}),a.d(t,\"a\",function(){return r});var s=a(\"b775\");function n(e,t){return Object(s[\"a\"])({url:e,method:\"get\",params:t})}function o(e,t){return Object(s[\"a\"])({url:e,method:\"post\",data:t})}function i(e,t){return Object(s[\"a\"])({url:e,method:\"put\",data:t})}function r(e,t){return Object(s[\"a\"])({url:e,method:\"delete\",data:t})}},\"12b5\":function(e,t,a){},\"14e3\":function(e,t,a){},\"15f5\":function(e,t,a){\"use strict\";var s=a(\"14e3\"),n=a.n(s);n.a},\"177e\":function(e,t,a){},\"1ad2\":function(e,t,a){\"use strict\";var s=a(\"ed5b\"),n=a.n(s);n.a},\"31ce\":function(e,t,a){\"use strict\";a.r(t);var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a(\"div\",{staticClass:\"role-container\"},[a(\"div\",{staticClass:\"role-wapper\"},[a(\"div\",{staticClass:\"role-top\"},[a(\"div\",{staticClass:\"f-l\"},[a(\"el-form\",{ref:\"addRoleForm\",attrs:{model:e.addRoleForm,rules:e.addRoleRules,\"hide-required-asterisk\":\"\",\"label-width\":\"80px\",autocomplete:\"off\",size:\"mini\"}},[a(\"el-form-item\",{attrs:{label:\"角色名称\",prop:\"name\"}},[a(\"el-input\",{attrs:{clearable:\"\",placeholder:\"角色名称\"},model:{value:e.addRoleForm.name,callback:function(t){e.$set(e.addRoleForm,\"name\",t)},expression:\"addRoleForm.name\"}})],1)],1)],1),e._v(\" \"),a(\"el-button\",{staticClass:\"el-button-default company-info-btn f-r\",staticStyle:{\"margin-left\":\"20px\"},attrs:{round:\"\",size:\"mini\"},on:{click:e.cancelRole}},[e._v(\"取消\")]),e._v(\" \"),a(\"el-button\",{staticClass:\"company-info-btn f-r\",attrs:{round:\"\",loading:e.loading,size:\"mini\",type:\"primary\"},on:{click:e.saveRole}},[e._v(\"保存\")])],1),e._v(\" \"),a(\"el-row\",{staticClass:\"first-row\",attrs:{gutter:15}},[a(\"el-col\",{attrs:{span:7}},[a(\"div\",{staticClass:\"company bg\"},[a(\"div\",{staticClass:\"auth-tree-title\"},[e._v(\"系统模块\")]),e._v(\" \"),a(\"el-scrollbar\",{staticClass:\"company-tree\"},[a(\"el-tree\",{ref:\"sysTree\",attrs:{data:e.sysData,props:e.defaultProps,\"node-key\":\"id\",\"empty-text\":e.companyLoading,\"highlight-current\":\"\",\"show-checkbox\":\"\",\"default-expand-all\":\"\"},on:{\"node-click\":e.sysClick}})],1)],1)]),e._v(\" \"),a(\"el-col\",{attrs:{span:17}},[a(\"div\",{staticClass:\"function-table\"},[a(\"el-table\",{ref:\"functionTable\",staticStyle:{width:\"100%\"},attrs:{data:e.functionData,\"max-height\":\"100%\",height:\"100%\",\"header-row-class-name\":\"car-table-header\",\"row-class-name\":\"car-table-item\",\"highlight-current-row\":\"\"}},[a(\"el-table-column\",{attrs:{prop:\"name\",label:\"功能\",width:\"auto\",\"class-name\":\"function-table-begin\"}}),e._v(\" \"),a(\"el-table-column\",{attrs:{label:\"游览\",width:\"70\",\"class-name\":\"role-select\"},scopedSlots:e._u([{key:\"default\",fn:function(t){return[a(\"el-checkbox\",{on:{change:function(a){var s=arguments.length,n=Array(s);while(s--)n[s]=arguments[s];return e.handleCheck.apply(void 0,[t].concat(n,[\"rightSelect\"]))}},model:{value:t.row.roleFuncAuth.rightSelect,callback:function(a){e.$set(t.row.roleFuncAuth,\"rightSelect\",a)},expression:\"scope.row.roleFuncAuth.rightSelect\"}})]}}])}),e._v(\" \"),a(\"el-table-column\",{attrs:{label:\"新建\",width:\"70\"},scopedSlots:e._u([{key:\"default\",fn:function(t){return[a(\"el-checkbox\",{on:{change:function(a){var s=arguments.length,n=Array(s);while(s--)n[s]=arguments[s];return e.handleCheck.apply(void 0,[t].concat(n,[\"rightInsert\"]))}},model:{value:t.row.roleFuncAuth.rightInsert,callback:function(a){e.$set(t.row.roleFuncAuth,\"rightInsert\",a)},expression:\"scope.row.roleFuncAuth.rightInsert\"}})]}}])}),e._v(\" \"),a(\"el-table-column\",{attrs:{label:\"删除\",width:\"70\"},scopedSlots:e._u([{key:\"default\",fn:function(t){return[a(\"el-checkbox\",{on:{change:function(a){var s=arguments.length,n=Array(s);while(s--)n[s]=arguments[s];return e.handleCheck.apply(void 0,[t].concat(n,[\"rightDelete\"]))}},model:{value:t.row.roleFuncAuth.rightDelete,callback:function(a){e.$set(t.row.roleFuncAuth,\"rightDelete\",a)},expression:\"scope.row.roleFuncAuth.rightDelete\"}})]}}])}),e._v(\" \"),a(\"el-table-column\",{attrs:{label:\"保存\",width:\"70\"},scopedSlots:e._u([{key:\"default\",fn:function(t){return[a(\"el-checkbox\",{on:{change:function(a){var s=arguments.length,n=Array(s);while(s--)n[s]=arguments[s];return e.handleCheck.apply(void 0,[t].concat(n,[\"rightUpdate\"]))}},model:{value:t.row.roleFuncAuth.rightUpdate,callback:function(a){e.$set(t.row.roleFuncAuth,\"rightUpdate\",a)},expression:\"scope.row.roleFuncAuth.rightUpdate\"}})]}}])}),e._v(\" \"),a(\"el-table-column\",{attrs:{label:\"审批\",width:\"70\"},scopedSlots:e._u([{key:\"default\",fn:function(t){return[a(\"el-checkbox\",{on:{change:function(a){var s=arguments.length,n=Array(s);while(s--)n[s]=arguments[s];return e.handleCheck.apply(void 0,[t].concat(n,[\"rightAudit\"]))}},model:{value:t.row.roleFuncAuth.rightAudit,callback:function(a){e.$set(t.row.roleFuncAuth,\"rightAudit\",a)},expression:\"scope.row.roleFuncAuth.rightAudit\"}})]}}])}),e._v(\" \"),a(\"el-table-column\",{attrs:{label:\"打印\",width:\"70\"},scopedSlots:e._u([{key:\"default\",fn:function(t){return[a(\"el-checkbox\",{on:{change:function(a){var s=arguments.length,n=Array(s);while(s--)n[s]=arguments[s];return e.handleCheck.apply(void 0,[t].concat(n,[\"rightPrint\"]))}},model:{value:t.row.roleFuncAuth.rightPrint,callback:function(a){e.$set(t.row.roleFuncAuth,\"rightPrint\",a)},expression:\"scope.row.roleFuncAuth.rightPrint\"}})]}}])}),e._v(\" \"),a(\"el-table-column\",{attrs:{label:\"导出\",width:\"100\",\"class-name\":\"function-table-end\"},scopedSlots:e._u([{key:\"default\",fn:function(t){return[a(\"el-checkbox\",{on:{change:function(a){var s=arguments.length,n=Array(s);while(s--)n[s]=arguments[s];return e.handleCheck.apply(void 0,[t].concat(n,[\"rightExport\"]))}},model:{value:t.row.roleFuncAuth.rightExport,callback:function(a){e.$set(t.row.roleFuncAuth,\"rightExport\",a)},expression:\"scope.row.roleFuncAuth.rightExport\"}})]}}])})],1)],1)])],1)],1)])},n=[],o=(a(\"20d6\"),a(\"8615\"),a(\"7f7f\"),a(\"96cf\"),a(\"3b8d\")),i=(a(\"ac6a\"),a(\"c5f6\"),a(\"0d5e\")),r={props:{companyId:{type:Number,default:0},addType:{type:Number,default:0},roleId:{type:Number,default:0},roleName:{type:String,default:\"\"}},data:function(){return{loading:!1,companyLoading:\"暂无数据\",addRoleForm:{name:this.roleName},addRoleRules:{name:[{required:!0,message:\"请输入角色名称\",trigger:\"blur\"}]},sysData:[],sysRootNode:[],setData:[],defaultProps:{children:\"children\",label:\"name\"},defaultAuthList:[],functionData:[],getList:{},clickList:{},addList:{},updateList:{},deleteList:{},defaultFuncAuth:{roleId:this.roleId,cpFuncId:0,cpFuncPid:0,rightSelect:0,rightInsert:0,rightDelete:0,rightUpdate:0,rightAudit:0,rightPrint:0,rightExport:0,type:0}}},mounted:function(){this.initAuthList()},methods:{initAuthList:function(){var e=this;e.companyId>0&&(e.companyLoading=\"数据加载中...\",Object(i[\"b\"])(\"/cpfunc/truncated-tree/\"+e.companyId,{truncateLvl:2,roleId:e.roleId}).then(function(t){0===t.status&&(e.companyLoading=\"暂无数据\",e.sysData=t.data.tree,e.defaultAuthList=t.data.roleFuncAuthIds,e.sysRootNode=JSON.parse(JSON.stringify(t.data.tree)),e.sysRootNode.length>0&&(e.sysRootNode[0].children=[]),e.$nextTick(function(){for(var a=0;a<t.data.checkedIds.length;a++)e.$refs.sysTree.setChecked(t.data.checkedIds[a],!0,!1)}))}))},getTreeNode:function(e){var t=[],a=function e(a){a.forEach(function(a){t.push(a),a.children&&a.children.length>0&&e(a.children)})};return a(e),t},sysClick:function(e,t){var a=this;null===e.children?Object(i[\"b\"])(\"/cpfunc/\"+this.companyId+\"/\"+e.funcId+\"/\"+this.roleId,null).then(function(e){if(0===e.status){for(var t=e.data,s=0;s<t.length;s++)null===t[s].roleFuncAuth?a.clickList.hasOwnProperty(t[s].id)?t[s].roleFuncAuth=a.clickList[t[s].id]:(t[s].roleFuncAuth=JSON.parse(JSON.stringify(a.defaultFuncAuth)),t[s].roleFuncAuth.cpFuncId=t[s].id,t[s].roleFuncAuth.cpFuncPid=t[s].funcPid):(t[s].roleFuncAuth.type=1,t[s].roleFuncAuth.cpFuncPid=t[s].funcPid,t[s].roleFuncAuth.rightSelect=!!t[s].roleFuncAuth.rightSelect,t[s].roleFuncAuth.rightInsert=!!t[s].roleFuncAuth.rightInsert,t[s].roleFuncAuth.rightDelete=!!t[s].roleFuncAuth.rightDelete,t[s].roleFuncAuth.rightUpdate=!!t[s].roleFuncAuth.rightUpdate,t[s].roleFuncAuth.rightAudit=!!t[s].roleFuncAuth.rightAudit,t[s].roleFuncAuth.rightPrint=!!t[s].roleFuncAuth.rightPrint,t[s].roleFuncAuth.rightExport=!!t[s].roleFuncAuth.rightExport),a.getList.hasOwnProperty(t[s].id)||(a.getList[t[s].id]=JSON.parse(JSON.stringify(t[s].roleFuncAuth)));a.functionData=t}}):this.functionData=[]},handleCheck:function(e,t){var a=e.row.roleFuncAuth;this.clickList[e.row.id]=a},saveRole:function(){var e=Object(o[\"a\"])(regeneratorRuntime.mark(function e(){var t,a=this;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:t=this,this.$refs.addRoleForm.validate(function(e){if(e){var s={cpid:a.companyId,showName:a.addRoleForm.name,roleFuncAuth:[]},n=t.$refs.sysTree.getCheckedNodes(!1,!0),o=[],r=[],l=Object.values(a.clickList);if(a.loading=!0,0===t.addType){for(var c=0;c<n.length;c++)if(o.push({cpFuncId:n[c].id,rightSelect:1}),null===n[c].children&&l.length>0){var d=l.filter(function(e){return e.cpFuncPid===n[c].funcId});r=r.concat(d)}r=r.filter(function(e){return e.rightAudit||e.rightDelete||e.rightExport||e.rightInsert||e.rightPrint||e.rightSelect||e.rightUpdate}),s.roleFuncAuth=o.concat(a.trueToOne(r)),console.log(s),Object(i[\"c\"])(\"/role/save\",s).then(function(e){a.loading=!1,0===e.status?a.$message({message:\"角色添加成功\",type:\"success\",duration:3e3}):a.$message({message:e.msg,type:\"warning\",duration:3e3}),t.$emit(\"submitrole\")})}else{for(var u=JSON.parse(JSON.stringify(t.defaultAuthList)),m=[],p=0;p<n.length;p++){if(null!==n[p].roleFuncAuth){var h=u.findIndex(function(e){return e===n[p].roleFuncAuth.id});h>=0&&u.splice(h,1)}else m.push({roleId:t.roleId,cpFuncId:n[p].id,rightSelect:1});if(null===n[p].children&&l.length>0){var f=l.filter(function(e){return e.cpFuncPid===n[p].funcId});r=r.concat(f)}}for(var y=[],v=[],g=[],b=0;b<r.length;b++){var w=r[b];w.rightAudit||w.rightDelete||w.rightExport||w.rightInsert||w.rightPrint||w.rightSelect||w.rightUpdate?0===w.type?y.push(w):w!==a.getList[w.cpFuncId]&&v.push(w):1===a.getList[w.cpFuncId].type&&g.push(w.id)}Object(i[\"c\"])(\"/role/updateName\",{id:a.roleId,showName:a.addRoleForm.name}).then(function(e){0===e.status?Object(i[\"a\"])(\"/rolefunc\",u.concat(g)).then(function(e){0===e.status?Object(i[\"d\"])(\"/rolefunc\",a.trueToOne(v)).then(function(s){0===s.status?(m=t.trueToOne(m),Object(i[\"c\"])(\"/rolefunc\",m.concat(a.trueToOne(y))).then(function(s){0===s.status?(a.loading=!1,a.$message({message:\"角色修改成功\",type:\"success\",duration:3e3}),t.$emit(\"submitrole\")):(a.loading=!1,a.$message({message:e.msg,type:\"warning\",duration:3e3}),t.$emit(\"submitrole\"))})):(a.loading=!1,a.$message({message:e.msg,type:\"warning\",duration:3e3}),t.$emit(\"submitrole\"))}):(a.loading=!1,a.$message({message:e.msg,type:\"warning\",duration:3e3}),t.$emit(\"submitrole\"))}):(a.loading=!1,a.$message({message:e.msg,type:\"warning\",duration:3e3}))})}}});case 2:case\"end\":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}(),cancelRole:function(){this.$emit(\"cancelrole\")},trueToOne:function(e){for(var t=0;t<e.length;t++)e[t].rightSelect=1*e[t].rightSelect,e[t].rightInsert=1*e[t].rightInsert,e[t].rightDelete=1*e[t].rightDelete,e[t].rightUpdate=1*e[t].rightUpdate,e[t].rightAudit=1*e[t].rightAudit,e[t].rightPrint=1*e[t].rightPrint,e[t].rightExport=1*e[t].rightExport;return e}}},l=r,c=(a(\"6669\"),a(\"6c1e\"),a(\"2877\")),d=Object(c[\"a\"])(l,s,n,!1,null,\"4c0b1328\",null);t[\"default\"]=d.exports},\"4f81\":function(e,t,a){\"use strict\";var s=a(\"177e\"),n=a.n(s);n.a},5368:function(e,t){e.exports=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAaCAMAAACaYWzBAAAAQlBMVEUAAADo6/jo6/jo6/jo6/jo6/jo6/jo6/jo6/jo6/jo6/jo6/jo6/jo6/jo6/jo6/jo6/jo6/jo6/jo6/jo6/jo6/jmuOqSAAAAFXRSTlMAD1DR6hoG3qqWSTvYwaOed2xeKiIZ8DvOAAAAhUlEQVQoz83PSw6DMBAE0QKPDdj8oe9/1SQOMlLiA/BWM6pVcwspBSpak6zlz6HsoPCz+zBp2yTLz+yBSZcOOl0maFQMg4omh+JhIQ8w+553sJMo9SH0UuS0EhZgVIKkEVhKcAEvrbBKnuBKkBtMUt9LssE9ZnklYKowYFfFzpuP7Y/o4QWTiCSFHychVgAAAABJRU5ErkJggg==\"},6669:function(e,t,a){\"use strict\";var s=a(\"d80b\"),n=a.n(s);n.a},\"6c1e\":function(e,t,a){\"use strict\";var s=a(\"12b5\"),n=a.n(s);n.a},\"78d1\":function(e,t,a){\"use strict\";a.r(t);var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a(\"div\",{staticClass:\"auth-transfer\"},[a(\"el-row\",{attrs:{gutter:20}},[a(\"el-col\",{staticClass:\"auth-all-item\",attrs:{span:10}},[a(\"div\",{staticClass:\"auth-tree-title\"},[e._v(\"功能清单\")]),e._v(\" \"),a(\"el-scrollbar\",{staticClass:\"auth-tree\"},[a(\"el-tree\",{ref:\"sysTree\",attrs:{data:e.sysData,props:e.defaultProps,\"node-key\":\"id\",\"empty-text\":e.authLoading,\"highlight-current\":\"\",accordion:\"\",\"show-checkbox\":\"\",\"default-expand-all\":\"\"}})],1)],1),e._v(\" \"),a(\"el-col\",{attrs:{span:4}},[a(\"div\",{staticClass:\"company auth-bg\"},[a(\"div\",{staticClass:\"auth-set-btn\"},[a(\"div\",{class:0===e.btnStatus?\"auth-disable\":\"auth-available\",on:{click:e.addAuth}},[e._v(\"授权\")]),e._v(\" \"),a(\"div\",{class:0===e.btnStatus?\"auth-disable\":\"auth-available\",on:{click:e.removeAuth}},[e._v(\"移除\")])])])]),e._v(\" \"),a(\"el-col\",{staticClass:\"auth-item\",attrs:{span:10}},[a(\"div\",{staticClass:\"auth-tree-title\"},[e._v(\"授权功能\")]),e._v(\" \"),a(\"el-scrollbar\",{staticClass:\"auth-tree\"},[a(\"el-tree\",{ref:\"setTree\",attrs:{data:e.setData,props:e.defaultProps,\"node-key\":e.setKey,\"empty-text\":e.setLoading,\"highlight-current\":\"\",accordion:\"\",\"show-checkbox\":\"\",\"default-expand-all\":\"\"}})],1)],1)],1)],1)},n=[],o=(a(\"ac6a\"),a(\"7f7f\"),a(\"20d6\"),a(\"96cf\"),a(\"3b8d\")),i=a(\"db72\"),r=(a(\"c5f6\"),a(\"0d5e\")),l=a(\"2f62\"),c={props:{selectCompanyId:{type:Number,default:0},btnStatus:{type:Number,default:0}},data:function(){return{authLoading:\"暂无数据\",setLoading:\"暂无数据\",sysRootNode:[],sysData:[],setKey:\"id\",setPKey:\"pid\",setData:[],setDefault:[],defaultProps:{children:\"children\",label:\"name\"}}},computed:Object(i[\"a\"])({},Object(l[\"b\"])([\"companyId\"])),watch:{selectCompanyId:{handler:function(e,t){this.getCompanySys(e)}}},created:function(){this.getAllSys()},methods:{getAllSys:function(){var e=this;this.authLoading=\"数据加载中...\",12===this.companyId?Object(r[\"b\"])(\"/sysfunc/tree\",null).then(function(t){0===t.status&&(e.sysData=t.data,e.sysRootNode=JSON.parse(JSON.stringify(t.data)),e.sysRootNode[0].children=[]),e.authLoading=\"暂无数据\"}):(this.setKey=\"funcId\",this.setPKey=\"funcPid\",Object(r[\"b\"])(\"/cpfunc/tree/\"+this.companyId,null).then(function(t){0===t.status&&(e.sysData=t.data,e.sysRootNode=JSON.parse(JSON.stringify(t.data)),e.sysRootNode[0].children=[]),e.authLoading=\"暂无数据\"}),this.getCompanySys(this.selectCompanyId))},getCompanySys:function(e){var t=this;this.selectCompanyId>0&&(this.setLoading=\"数据加载中...\",Object(r[\"b\"])(\"/cpfunc/tree/\"+this.selectCompanyId,null).then(function(e){0===e.status&&(t.setData=e.data,e.data.length>0?t.setDefault=t.getTreeNode(e.data):t.setDefault=[]),t.setLoading=\"暂无数据\"}))},addAuth:function(){var e=this;if(0!==this.btnStatus){var t=this,a=this.$refs.sysTree.getCheckedNodes(!1,!0);a.length<=1||null===a||(t.setData=JSON.parse(JSON.stringify(this.sysRootNode)),t.$nextTick(function(){for(var s,n=JSON.parse(JSON.stringify(a)),o=1;o<n.length;o++)s=n[o],s.children=[],t.$refs.setTree.append(s,s[e.setPKey])}))}},removeAuth:function(){if(0!==this.btnStatus)for(var e=this,t=e.$refs.setTree.getCheckedKeys(),a=0;a<t.length;a++)e.$refs.setTree.remove(t[a]),e.$refs.sysTree.setChecked(t[a],!1)},saveAuth:function(){var e=Object(o[\"a\"])(regeneratorRuntime.mark(function e(){var t,a,s,n,o,i,r,l,c,d=this;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(t=this.$refs.setTree.data,null!==t){e.next=16;break}if(!(this.setDefault.length>0)){e.next=13;break}return e.next=5,this.deleteAuth(this.setDefault);case 5:if(!e.sent){e.next=10;break}this.$message({message:\"授权保存成功\",type:\"success\",duration:3e3}),this.setDefault=[],e.next=11;break;case 10:this.$message({message:\"授权保存失败\",type:\"warning\",duration:3e3});case 11:e.next=14;break;case 13:this.$message({message:\"授权保存成功\",type:\"success\",duration:3e3});case 14:e.next=53;break;case 16:if(a=this.getTreeNode(t),!(this.setDefault.length>0)){e.next=44;break}for(s=JSON.parse(JSON.stringify(this.setDefault)),n=JSON.parse(JSON.stringify(a)),o=0;o<a.length;o++)i=s.findIndex(function(e){return e.name===a[o].name}),i>=0&&s.splice(i,1);if(r=!0,!(s.length>0)){e.next=26;break}return e.next=25,this.deleteAuth(s);case 25:r=e.sent;case 26:if(!r){e.next=41;break}for(l=0;l<this.setDefault.length;l++)c=n.findIndex(function(e){return e.name===d.setDefault[l].name}),c>=0&&n.splice(c,1);if(!(n.length>0)){e.next=38;break}return e.next=31,this.postAuth(n);case 31:if(!e.sent){e.next=35;break}this.$message({message:\"授权保存成功\",type:\"success\",duration:3e3}),e.next=36;break;case 35:this.$message({message:\"授权保存失败\",type:\"warning\",duration:3e3});case 36:e.next=39;break;case 38:this.$message({message:\"授权保存成功\",type:\"success\",duration:3e3});case 39:e.next=42;break;case 41:this.$message({message:\"授权保存失败\",type:\"warning\",duration:3e3});case 42:e.next=51;break;case 44:return e.next=46,this.postAuth(a);case 46:if(!e.sent){e.next=50;break}this.$message({message:\"授权保存成功\",type:\"success\",duration:3e3}),e.next=51;break;case 50:this.$message({message:\"授权保存失败\",type:\"warning\",duration:3e3});case 51:this.getCompanySys(this.selectCompanyId),this.$emit(\"authend\");case 53:case\"end\":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}(),getTreeNode:function(e){var t=[],a=function e(a){a.forEach(function(a){t.push(a),a.children&&a.children.length>0&&e(a.children)})};return a(e),t},deleteAuth:function(e){var t=[];return e.forEach(function(e){t.push(e.id)}),new Promise(function(e,a){Object(r[\"a\"])(\"/cpfunc\",t).then(function(t){e(0===t.status)}).catch(function(){a(!1)})})},postAuth:function(e){var t=this;if(\"funcPid\"===this.setPKey)for(var a=0;a<e.length;a++)e[a].id=e[a].funcId,e[a].pid=e[a].funcPid;return new Promise(function(a,s){Object(r[\"c\"])(\"/cpfunc/\"+t.selectCompanyId,e).then(function(e){a(0===e.status)}).catch(function(){s(!1)})})}}},d=c,u=(a(\"4f81\"),a(\"2877\")),m=Object(u[\"a\"])(d,s,n,!1,null,null,null);t[\"default\"]=m.exports},\"78ed\":function(e,t,a){\"use strict\";a.r(t);var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a(\"div\",{staticClass:\"account-container\"},[a(\"el-form\",{ref:\"accountForm\",staticClass:\"account-form\",attrs:{model:e.accountForm,rules:e.accountRules,autocomplete:\"off\",\"hide-required-asterisk\":\"\",\"label-width\":\"80px\"}},[a(\"el-form-item\",{attrs:{label:\"姓名\",prop:\"name\"}},[a(\"el-input\",{attrs:{placeholder:\"姓名\"},model:{value:e.accountForm.name,callback:function(t){e.$set(e.accountForm,\"name\",t)},expression:\"accountForm.name\"}})],1),e._v(\" \"),a(\"el-form-item\",{attrs:{label:\"手机号\",prop:\"mobile\"}},[a(\"el-input\",{attrs:{name:\"mobile\",maxlength:\"11\",clearable:\"\",placeholder:\"手机号\"},model:{value:e.accountForm.mobile,callback:function(t){e.$set(e.accountForm,\"mobile\",e._n(t))},expression:\"accountForm.mobile\"}})],1),e._v(\" \"),a(\"el-form-item\",{attrs:{label:\"职位\",prop:\"post\"}},[a(\"el-input\",{attrs:{name:\"post\",clearable:\"\",placeholder:\"职位\",autocomplete:\"off\"},model:{value:e.accountForm.post,callback:function(t){e.$set(e.accountForm,\"post\",t)},expression:\"accountForm.post\"}}),e._v(\" \"),a(\"el-input\",{directives:[{name:\"show\",rawName:\"v-show\",value:!1,expression:\"false\"}],attrs:{clearable:\"\",placeholder:\"职位\"}})],1),e._v(\" \"),1!=e.userInfo.type?a(\"el-form-item\",{attrs:{label:\"密码\",prop:\"password\"}},[a(\"el-input\",{directives:[{name:\"show\",rawName:\"v-show\",value:!1,expression:\"false\"}],attrs:{type:\"password\",placeholder:\"密码\"}}),e._v(\" \"),a(\"el-input\",{ref:\"password\",attrs:{type:\"password\",name:\"password\",clearable:\"\",placeholder:\"密码\",autocomplete:\"off\",\"auto-complete\":\"new-password\"},model:{value:e.accountForm.password,callback:function(t){e.$set(e.accountForm,\"password\",t)},expression:\"accountForm.password\"}})],1):e._e(),e._v(\" \"),a(\"div\",{staticClass:\"account-btn\",style:{\"padding-top\":1!=e.userInfo.type?\"0\":\"50px\"}},[a(\"el-button\",{staticClass:\"el-button-default\",attrs:{round:\"\",size:\"mini\"},on:{click:e.cancel}},[e._v(\"取消\")]),e._v(\" \"),a(\"el-button\",{attrs:{loading:e.loading,round:\"\",size:\"mini\",type:\"primary\"},on:{click:e.submit}},[e._v(\"保存\")])],1)],1),e._v(\" \"),a(\"div\",{staticClass:\"photo\"},[a(\"el-upload\",{ref:\"upload\",staticClass:\"avatar-uploader\",attrs:{action:\"\",drag:\"\",\"on-change\":e.onchange,\"show-file-list\":!1,\"on-success\":e.handleAvatarSuccess,\"before-upload\":e.beforeAvatarUpload,\"auto-upload\":!1,\"http-request\":e.upLoadAvatar}},[e.imageUrl?a(\"img\",{staticClass:\"avatar\",attrs:{src:e.imageUrl}}):a(\"i\",{staticClass:\"el-icon-plus avatar-uploader-icon\"}),e._v(\" \"),a(\"div\",{staticClass:\"el-upload__tip\",attrs:{slot:\"tip\"},slot:\"tip\"},[e._v(\"只能上传jpg/png文件，且不超过2MB\")])])],1)],1)},n=[],o=(a(\"7f7f\"),a(\"0d5e\")),i=a(\"c24f\"),r=a(\"61f7\"),l={name:\"Account\",props:{userInfo:{type:Object,default:null}},data:function(){var e=function(e,t,a){\"\"===t?a(new Error(\"请输入新手机号码\")):Object(r[\"e\"])(t)?a():a(new Error(\"手机号输入不正确!\"))};return{loading:!1,userId:0,showCropper:!1,imageUrl:\"\",imageUpdate:!1,imgData:{accept:\"image/jpeg, image/png, image/jpg\"},accountForm:{name:\"\",mobile:\"\",post:\"\",password:\"\"},accountRules:{name:[{required:!0,trigger:\"blur\",message:\"请输入姓名\"}],mobile:[{required:!0,trigger:\"blur\",validator:e}],post:[{required:!0,trigger:\"blur\",message:\"请输入职位\"}],password:[{required:!0,trigger:\"blur\",message:\"请输入密码\"},{min:6,message:\"密码必须大于6位\",trigger:\"blur\"}]}}},created:function(){var e=this;1===e.userInfo.type?(e.userId=e.userInfo.userId,e.accountForm.name=e.userInfo.cusName,e.accountForm.mobile=e.userInfo.phone,e.accountForm.post=e.userInfo.postName,e.accountForm.password=\"111111\",e.imageUrl=\"http://192.168.1.32:8081/user/img/\"+e.userInfo.cusPic+\"?t=\"+(new Date).getTime()):(e.accountForm.name=\"\",e.accountForm.mobile=\"\",e.accountForm.post=\"\",e.accountForm.password=\"\",e.imageUrl=\"\")},methods:{getObjectURL:function(e){var t=null;return void 0!==window.createObjectURL?t=window.createObjectURL(e):void 0!==window.URL?t=window.URL.createObjectURL(e):void 0!==window.webkitURL&&(t=window.webkitURL.createObjectURL(e)),t},onchange:function(e,t){var a=e.raw;if(a){var s=a.type,n=a.size;if(-1===this.imgData.accept.indexOf(s)||\"\"===s)return this.$message({message:\"请选择jpg、jpeg、png格式图片文件\",type:\"warning\"}),!1;if(n>2097152)return this.$message({message:\"请选择2M以下图片文件\",type:\"warning\"}),!1;this.imageUpdate=!0,this.imageUrl=this.getObjectURL(a)}},upLoadAvatar:function(e){var t=this,a=new FormData;a.append(\"file\",e.file),Object(i[\"g\"])(this.userId,a).then(function(e){t.loading=!1,t.$emit(\"submituser\")})},submit:function(){var e=this,t=this;this.$refs.accountForm.validate(function(a){if(a){var s={cpid:t.userInfo.cpid,cusName:t.accountForm.name,phone:t.accountForm.mobile,deptId:t.userInfo.deptId,postName:t.accountForm.post,cusPassword:t.accountForm.password};t.loading=!0,0===t.userInfo.type?Object(o[\"c\"])(\"/user\",s).then(function(a){0===a.status?(e.userId=a.data.userId,e.$message({message:\"添加成功\",type:\"success\",duration:3e3}),\"\"!==e.imageUrl?t.$refs.upload.submit():(t.loading=!1,t.$emit(\"submituser\"))):(e.$message({message:a.msg,type:\"warning\",duration:3e3}),t.loading=!1,t.$emit(\"submituser\"))}):(s.userId=t.userInfo.userId,s.cusName=s.cusName===t.userInfo.cusName?null:s.cusName,s.phone=s.phone===t.userInfo.phone?null:s.phone,s.postName=s.postName===t.userInfo.postName?null:s.postName,s.cusPassword=null,Object(o[\"d\"])(\"/user\",s).then(function(a){0===a.status?(e.$message({message:\"修改成功\",type:\"success\",duration:3e3}),\"\"!==e.imageUrl&&e.imageUpdate?t.$refs.upload.submit():(t.loading=!1,t.$emit(\"submituser\"))):(e.$message({message:a.msg,type:\"warning\",duration:3e3}),t.loading=!1,t.$emit(\"submituser\"))}))}})},cancel:function(){this.$emit(\"canceluser\")},handleAvatarSuccess:function(e,t){this.imageUrl=URL.createObjectURL(t.raw)},beforeAvatarUpload:function(e){var t=\"image/jpeg\"===e.type,a=e.size/1024/1024<2;return t||this.$message.error(\"上传头像图片只能是 JPG 格式!\"),a||this.$message.error(\"上传头像图片大小不能超过 2MB!\"),t&&a}}},c=l,d=(a(\"1ad2\"),a(\"adf4\"),a(\"2877\")),u=Object(d[\"a\"])(c,s,n,!1,null,\"d908b5a6\",null);t[\"default\"]=u.exports},\"7c2f\":function(e,t,a){},a76e:function(e,t,a){\"use strict\";var s=a(\"ef8c\"),n=a.n(s);n.a},adf4:function(e,t,a){\"use strict\";var s=a(\"7c2f\"),n=a.n(s);n.a},d80b:function(e,t,a){},ed5b:function(e,t,a){},ef8c:function(e,t,a){},f7ad:function(e,t){e.exports=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAaCAMAAACaYWzBAAAANlBMVEUAAAAA2KkA2KkA2KkA2KkA2KkA2KkA2KkA2KkA2KkA2KkA2KkA2KkA2KkA2KkA2KkA2KkA2KmfxKpKAAAAEXRSTlMADk/RpRvd7L8n5pRrXjv0sAppmh4AAACGSURBVCjPrZBLDsMgDAUfH2PIr/X9L1uKgi0Eu2Q2NjNiYxjuuhwWeBZhP/sijWKGYviziRyHyNYekQBkuUlA6nsGnCj7brvToLwXUsnLkAiONQweUX/M3sJn8BYihcH3wHUE8xYk1/lVb6EVqLfQinoNvagfg/Dj64JXngGcq3CiQn6CgB9Y5hxzI3cqzAAAAABJRU5ErkJggg==\"}}]);","extractedComments":[]}