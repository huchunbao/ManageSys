{"code":"(window[\"webpackJsonp\"]=window[\"webpackJsonp\"]||[]).push([[\"chunk-63ca6359\"],{\"0d5e\":function(t,e,n){\"use strict\";n.d(e,\"b\",function(){return o}),n.d(e,\"c\",function(){return i}),n.d(e,\"d\",function(){return a}),n.d(e,\"a\",function(){return c});var r=n(\"b775\");function o(t,e){return Object(r[\"a\"])({url:t,method:\"get\",params:e})}function i(t,e){return Object(r[\"a\"])({url:t,method:\"post\",data:e})}function a(t,e){return Object(r[\"a\"])({url:t,method:\"put\",data:e})}function c(t,e){return Object(r[\"a\"])({url:t,method:\"delete\",data:e})}},\"12b5\":function(t,e,n){},\"31ce\":function(t,e,n){\"use strict\";n.r(e);var r=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n(\"div\",{staticClass:\"role-container\"},[n(\"div\",{staticClass:\"role-wapper\"},[n(\"div\",{staticClass:\"role-top\"},[n(\"div\",{staticClass:\"f-l\"},[n(\"el-form\",{ref:\"addRoleForm\",attrs:{model:t.addRoleForm,rules:t.addRoleRules,\"hide-required-asterisk\":\"\",\"label-width\":\"80px\",autocomplete:\"off\",size:\"mini\"}},[n(\"el-form-item\",{attrs:{label:\"角色名称\",prop:\"name\"}},[n(\"el-input\",{attrs:{clearable:\"\",placeholder:\"角色名称\"},model:{value:t.addRoleForm.name,callback:function(e){t.$set(t.addRoleForm,\"name\",e)},expression:\"addRoleForm.name\"}})],1)],1)],1),t._v(\" \"),n(\"el-button\",{staticClass:\"el-button-default company-info-btn f-r\",staticStyle:{\"margin-left\":\"20px\"},attrs:{round:\"\",size:\"mini\"},on:{click:t.cancelRole}},[t._v(\"取消\")]),t._v(\" \"),n(\"el-button\",{staticClass:\"company-info-btn f-r\",attrs:{round:\"\",loading:t.loading,size:\"mini\",type:\"primary\"},on:{click:t.saveRole}},[t._v(\"保存\")])],1),t._v(\" \"),n(\"el-row\",{staticClass:\"first-row\",attrs:{gutter:15}},[n(\"el-col\",{attrs:{span:7}},[n(\"div\",{staticClass:\"company bg\"},[n(\"div\",{staticClass:\"auth-tree-title\"},[t._v(\"系统模块\")]),t._v(\" \"),n(\"el-scrollbar\",{staticClass:\"company-tree\"},[n(\"el-tree\",{ref:\"sysTree\",attrs:{data:t.sysData,props:t.defaultProps,\"node-key\":\"id\",\"empty-text\":t.companyLoading,\"highlight-current\":\"\",\"show-checkbox\":\"\",\"default-expand-all\":\"\"},on:{\"node-click\":t.sysClick}})],1)],1)]),t._v(\" \"),n(\"el-col\",{attrs:{span:17}},[n(\"div\",{staticClass:\"function-table\"},[n(\"el-table\",{ref:\"functionTable\",staticStyle:{width:\"100%\"},attrs:{data:t.functionData,\"max-height\":\"100%\",height:\"100%\",\"header-row-class-name\":\"car-table-header\",\"row-class-name\":\"car-table-item\",\"highlight-current-row\":\"\"}},[n(\"el-table-column\",{attrs:{prop:\"name\",label:\"功能\",width:\"auto\",\"class-name\":\"function-table-begin\"}}),t._v(\" \"),n(\"el-table-column\",{attrs:{label:\"游览\",width:\"70\",\"class-name\":\"role-select\"},scopedSlots:t._u([{key:\"default\",fn:function(e){return[n(\"el-checkbox\",{on:{change:function(n){var r=arguments.length,o=Array(r);while(r--)o[r]=arguments[r];return t.handleCheck.apply(void 0,[e].concat(o,[\"rightSelect\"]))}},model:{value:e.row.roleFuncAuth.rightSelect,callback:function(n){t.$set(e.row.roleFuncAuth,\"rightSelect\",n)},expression:\"scope.row.roleFuncAuth.rightSelect\"}})]}}])}),t._v(\" \"),n(\"el-table-column\",{attrs:{label:\"新建\",width:\"70\"},scopedSlots:t._u([{key:\"default\",fn:function(e){return[n(\"el-checkbox\",{on:{change:function(n){var r=arguments.length,o=Array(r);while(r--)o[r]=arguments[r];return t.handleCheck.apply(void 0,[e].concat(o,[\"rightInsert\"]))}},model:{value:e.row.roleFuncAuth.rightInsert,callback:function(n){t.$set(e.row.roleFuncAuth,\"rightInsert\",n)},expression:\"scope.row.roleFuncAuth.rightInsert\"}})]}}])}),t._v(\" \"),n(\"el-table-column\",{attrs:{label:\"删除\",width:\"70\"},scopedSlots:t._u([{key:\"default\",fn:function(e){return[n(\"el-checkbox\",{on:{change:function(n){var r=arguments.length,o=Array(r);while(r--)o[r]=arguments[r];return t.handleCheck.apply(void 0,[e].concat(o,[\"rightDelete\"]))}},model:{value:e.row.roleFuncAuth.rightDelete,callback:function(n){t.$set(e.row.roleFuncAuth,\"rightDelete\",n)},expression:\"scope.row.roleFuncAuth.rightDelete\"}})]}}])}),t._v(\" \"),n(\"el-table-column\",{attrs:{label:\"保存\",width:\"70\"},scopedSlots:t._u([{key:\"default\",fn:function(e){return[n(\"el-checkbox\",{on:{change:function(n){var r=arguments.length,o=Array(r);while(r--)o[r]=arguments[r];return t.handleCheck.apply(void 0,[e].concat(o,[\"rightUpdate\"]))}},model:{value:e.row.roleFuncAuth.rightUpdate,callback:function(n){t.$set(e.row.roleFuncAuth,\"rightUpdate\",n)},expression:\"scope.row.roleFuncAuth.rightUpdate\"}})]}}])}),t._v(\" \"),n(\"el-table-column\",{attrs:{label:\"审批\",width:\"70\"},scopedSlots:t._u([{key:\"default\",fn:function(e){return[n(\"el-checkbox\",{on:{change:function(n){var r=arguments.length,o=Array(r);while(r--)o[r]=arguments[r];return t.handleCheck.apply(void 0,[e].concat(o,[\"rightAudit\"]))}},model:{value:e.row.roleFuncAuth.rightAudit,callback:function(n){t.$set(e.row.roleFuncAuth,\"rightAudit\",n)},expression:\"scope.row.roleFuncAuth.rightAudit\"}})]}}])}),t._v(\" \"),n(\"el-table-column\",{attrs:{label:\"打印\",width:\"70\"},scopedSlots:t._u([{key:\"default\",fn:function(e){return[n(\"el-checkbox\",{on:{change:function(n){var r=arguments.length,o=Array(r);while(r--)o[r]=arguments[r];return t.handleCheck.apply(void 0,[e].concat(o,[\"rightPrint\"]))}},model:{value:e.row.roleFuncAuth.rightPrint,callback:function(n){t.$set(e.row.roleFuncAuth,\"rightPrint\",n)},expression:\"scope.row.roleFuncAuth.rightPrint\"}})]}}])}),t._v(\" \"),n(\"el-table-column\",{attrs:{label:\"导出\",width:\"100\",\"class-name\":\"function-table-end\"},scopedSlots:t._u([{key:\"default\",fn:function(e){return[n(\"el-checkbox\",{on:{change:function(n){var r=arguments.length,o=Array(r);while(r--)o[r]=arguments[r];return t.handleCheck.apply(void 0,[e].concat(o,[\"rightExport\"]))}},model:{value:e.row.roleFuncAuth.rightExport,callback:function(n){t.$set(e.row.roleFuncAuth,\"rightExport\",n)},expression:\"scope.row.roleFuncAuth.rightExport\"}})]}}])})],1)],1)])],1)],1)])},o=[],i=(n(\"20d6\"),n(\"8615\"),n(\"7f7f\"),n(\"96cf\"),n(\"3b8d\")),a=(n(\"ac6a\"),n(\"c5f6\"),n(\"0d5e\")),c={props:{companyId:{type:Number,default:0},addType:{type:Number,default:0},roleId:{type:Number,default:0},roleName:{type:String,default:\"\"}},data:function(){return{loading:!1,companyLoading:\"暂无数据\",addRoleForm:{name:this.roleName},addRoleRules:{name:[{required:!0,message:\"请输入角色名称\",trigger:\"blur\"}]},sysData:[],sysRootNode:[],setData:[],defaultProps:{children:\"children\",label:\"name\"},defaultAuthList:[],functionData:[],getList:{},clickList:{},addList:{},updateList:{},deleteList:{},defaultFuncAuth:{roleId:this.roleId,cpFuncId:0,cpFuncPid:0,rightSelect:0,rightInsert:0,rightDelete:0,rightUpdate:0,rightAudit:0,rightPrint:0,rightExport:0,type:0}}},mounted:function(){this.initAuthList()},methods:{initAuthList:function(){var t=this;t.companyId>0&&(t.companyLoading=\"数据加载中...\",Object(a[\"b\"])(\"/cpfunc/truncated-tree/\"+t.companyId,{truncateLvl:2,roleId:t.roleId}).then(function(e){0===e.status&&(t.companyLoading=\"暂无数据\",t.sysData=e.data.tree,t.defaultAuthList=e.data.roleFuncAuthIds,t.sysRootNode=JSON.parse(JSON.stringify(e.data.tree)),t.sysRootNode.length>0&&(t.sysRootNode[0].children=[]),t.$nextTick(function(){for(var n=0;n<e.data.checkedIds.length;n++)t.$refs.sysTree.setChecked(e.data.checkedIds[n],!0,!1)}))}))},getTreeNode:function(t){var e=[],n=function t(n){n.forEach(function(n){e.push(n),n.children&&n.children.length>0&&t(n.children)})};return n(t),e},sysClick:function(t,e){var n=this;null===t.children?Object(a[\"b\"])(\"/cpfunc/\"+this.companyId+\"/\"+t.funcId+\"/\"+this.roleId,null).then(function(t){if(0===t.status){for(var e=t.data,r=0;r<e.length;r++)null===e[r].roleFuncAuth?n.clickList.hasOwnProperty(e[r].id)?e[r].roleFuncAuth=n.clickList[e[r].id]:(e[r].roleFuncAuth=JSON.parse(JSON.stringify(n.defaultFuncAuth)),e[r].roleFuncAuth.cpFuncId=e[r].id,e[r].roleFuncAuth.cpFuncPid=e[r].funcPid):(e[r].roleFuncAuth.type=1,e[r].roleFuncAuth.cpFuncPid=e[r].funcPid,e[r].roleFuncAuth.rightSelect=!!e[r].roleFuncAuth.rightSelect,e[r].roleFuncAuth.rightInsert=!!e[r].roleFuncAuth.rightInsert,e[r].roleFuncAuth.rightDelete=!!e[r].roleFuncAuth.rightDelete,e[r].roleFuncAuth.rightUpdate=!!e[r].roleFuncAuth.rightUpdate,e[r].roleFuncAuth.rightAudit=!!e[r].roleFuncAuth.rightAudit,e[r].roleFuncAuth.rightPrint=!!e[r].roleFuncAuth.rightPrint,e[r].roleFuncAuth.rightExport=!!e[r].roleFuncAuth.rightExport),n.getList.hasOwnProperty(e[r].id)||(n.getList[e[r].id]=JSON.parse(JSON.stringify(e[r].roleFuncAuth)));n.functionData=e}}):this.functionData=[]},handleCheck:function(t,e){var n=t.row.roleFuncAuth;this.clickList[t.row.id]=n},saveRole:function(){var t=Object(i[\"a\"])(regeneratorRuntime.mark(function t(){var e,n=this;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:e=this,this.$refs.addRoleForm.validate(function(t){if(t){var r={cpid:n.companyId,showName:n.addRoleForm.name,roleFuncAuth:[]},o=e.$refs.sysTree.getCheckedNodes(!1,!0),i=[],c=[],l=Object.values(n.clickList);if(n.loading=!0,0===e.addType){for(var u=0;u<o.length;u++)if(i.push({cpFuncId:o[u].id,rightSelect:1}),null===o[u].children&&l.length>0){var s=l.filter(function(t){return t.cpFuncPid===o[u].funcId});c=c.concat(s)}c=c.filter(function(t){return t.rightAudit||t.rightDelete||t.rightExport||t.rightInsert||t.rightPrint||t.rightSelect||t.rightUpdate}),r.roleFuncAuth=i.concat(n.trueToOne(c)),console.log(r),Object(a[\"c\"])(\"/role/save\",r).then(function(t){n.loading=!1,0===t.status?n.$message({message:\"角色添加成功\",type:\"success\",duration:3e3}):n.$message({message:t.msg,type:\"warning\",duration:3e3}),e.$emit(\"submitrole\")})}else{for(var h=JSON.parse(JSON.stringify(e.defaultAuthList)),d=[],g=0;g<o.length;g++){if(null!==o[g].roleFuncAuth){var p=h.findIndex(function(t){return t===o[g].roleFuncAuth.id});p>=0&&h.splice(p,1)}else d.push({roleId:e.roleId,cpFuncId:o[g].id,rightSelect:1});if(null===o[g].children&&l.length>0){var f=l.filter(function(t){return t.cpFuncPid===o[g].funcId});c=c.concat(f)}}for(var m=[],b=[],y=[],A=0;A<c.length;A++){var v=c[A];v.rightAudit||v.rightDelete||v.rightExport||v.rightInsert||v.rightPrint||v.rightSelect||v.rightUpdate?0===v.type?m.push(v):v!==n.getList[v.cpFuncId]&&b.push(v):1===n.getList[v.cpFuncId].type&&y.push(v.id)}Object(a[\"c\"])(\"/role/updateName\",{id:n.roleId,showName:n.addRoleForm.name}).then(function(t){0===t.status?Object(a[\"a\"])(\"/rolefunc\",h.concat(y)).then(function(t){0===t.status?Object(a[\"d\"])(\"/rolefunc\",n.trueToOne(b)).then(function(r){0===r.status?(d=e.trueToOne(d),Object(a[\"c\"])(\"/rolefunc\",d.concat(n.trueToOne(m))).then(function(r){0===r.status?(n.loading=!1,n.$message({message:\"角色修改成功\",type:\"success\",duration:3e3}),e.$emit(\"submitrole\")):(n.loading=!1,n.$message({message:t.msg,type:\"warning\",duration:3e3}),e.$emit(\"submitrole\"))})):(n.loading=!1,n.$message({message:t.msg,type:\"warning\",duration:3e3}),e.$emit(\"submitrole\"))}):(n.loading=!1,n.$message({message:t.msg,type:\"warning\",duration:3e3}),e.$emit(\"submitrole\"))}):(n.loading=!1,n.$message({message:t.msg,type:\"warning\",duration:3e3}))})}}});case 2:case\"end\":return t.stop()}},t,this)}));function e(){return t.apply(this,arguments)}return e}(),cancelRole:function(){this.$emit(\"cancelrole\")},trueToOne:function(t){for(var e=0;e<t.length;e++)t[e].rightSelect=1*t[e].rightSelect,t[e].rightInsert=1*t[e].rightInsert,t[e].rightDelete=1*t[e].rightDelete,t[e].rightUpdate=1*t[e].rightUpdate,t[e].rightAudit=1*t[e].rightAudit,t[e].rightPrint=1*t[e].rightPrint,t[e].rightExport=1*t[e].rightExport;return t}}},l=c,u=(n(\"6669\"),n(\"6c1e\"),n(\"2877\")),s=Object(u[\"a\"])(l,r,o,!1,null,\"4c0b1328\",null);e[\"default\"]=s.exports},6669:function(t,e,n){\"use strict\";var r=n(\"d80b\"),o=n.n(r);o.a},\"6c1e\":function(t,e,n){\"use strict\";var r=n(\"12b5\"),o=n.n(r);o.a},d80b:function(t,e,n){}}]);","extractedComments":[]}