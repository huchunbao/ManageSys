{"remainingRequest":"D:\\办公\\projectwc\\前端\\ManageSys\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\办公\\projectwc\\前端\\ManageSys\\src\\views\\map\\mapinstall.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\办公\\projectwc\\前端\\ManageSys\\src\\views\\map\\mapinstall.vue","mtime":1576811950358},{"path":"D:\\办公\\projectwc\\前端\\ManageSys\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"D:\\办公\\projectwc\\前端\\ManageSys\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\办公\\projectwc\\前端\\ManageSys\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport { post, get } from '@/api/axios'\nimport shengshi from '@/assets/shengshi'\nimport VueAMap from 'vue-amap'\n\nconst amapManager = new VueAMap.AMapManager()\n// let timer = null\nexport default {\n  name: 'Map',\n  data() {\n    return {\n      name: '电子地图管理',\n      options2: [],\n      imageUrl: '',\n      tape: 1,\n      zoom: 16,\n      amapManager,\n      markers: [\n        {\n          position: [116.338535, 39.943609], // [116.338535, 39.943609],\n          icon: '',\n          draggable: false,\n          events: {\n            'click': (e) => {\n              var lng = e.lnglat.lng\n              var lat = e.lnglat.lat\n              var list = [lng, lat]\n              // this.markers[0].draggable = true\n              this.markers[0].position = list\n            },\n            dragging: (e) => {\n              this.input_longitude = e.lnglat.lng\n              this.input_latitude = e.lnglat.lat\n              this.markers[0].position = [e.lnglat.lng, e.lnglat.lat]\n            }\n          }\n        }\n      ],\n      center: [116.336496, 39.942178],\n      events: {\n        'click': (e) => {\n          var lng = e.lnglat.lng\n          var lat = e.lnglat.lat\n          var list = [lng, lat]\n          if (this.add_marker) {\n            this.input_longitude = lng\n            this.input_latitude = lat\n            this.markers[0].position = list\n            // var map = amapManager.getMap()\n            // map.add(this.markers[0])\n            // map.setFitView()\n          } else {\n            this.$alert('请先点击修改按钮才可执行此操作', '', {\n              confirmButtonText: '确定'\n              // callback: action => {\n              //   this.$message({\n              //     type: 'info',\n              //     message: `action: ${ action }`\n              //   })\n              // }\n            })\n          }\n        }\n      },\n      mapStyle1: 'amap://styles/normal',\n      mapStyle2: 'amap://styles/whitesmoke',\n      mapStyle3: 'amap://styles/fresh',\n      id: 0,\n      options: shengshi,\n      value: '',\n      value1: '',\n      input_longitude: '',\n      input_latitude: '',\n      fun: null,\n      save: false, // 可点击\n      edit: true,\n      disabled: true,\n      add_marker: false, // 是否可添加marker\n      save_success: false // 是否成功保存\n    }\n  },\n  watch: {\n    value() {\n      this.options2 = JSON.parse(this.value).citys\n      this.value1 = ''\n    }\n    // input_longitude: function(val, old) {\n    //   if (timer !== null) {\n    //     clearTimeout(timer)\n    //   }\n    //   // var that = this\n    //   timer = setTimeout(() => {\n    //     console.log(Number(val))\n    //     this.input_longitude = Number(val)\n    //   }, 1000)\n    // }\n  },\n  created() {\n  },\n  mounted() {\n    this.input_longitude = 116.336496\n    this.input_latitude = 39.942178\n    // marker.setMap(o)\n    this.tapefun(this.tape)\n    this.huo()\n  },\n  methods: {\n    SelectChange(val) {\n      console.log(val)\n    },\n    Save_btn() {\n      if (this.value && this.value1 && this.input_longitude && this.input_latitude) { // 可保存\n        this.tapefun(this.tape)\n        this.save_success = true // 保存成功\n        this.save = false\n        this.edit = true // 可编辑\n        this.disabled = true\n        this.add_marker = false\n        this.markers[0].draggable = false\n      } else { // 不可保存\n        var titles = ''\n        if (!this.value) {\n          titles = '省'\n        } else if (!this.value1) {\n          titles = '市'\n        } else if (!this.input_longitude || this.input_latitude) {\n          titles = '经纬度'\n        }\n        this.$alert('请检查' + titles + '是否填写', '', {\n          confirmButtonText: '确定'\n          // callback: action => {\n          //   this.$message({\n          //     type: 'info',\n          //     message: `action: ${ action }`\n          //   })\n          // }\n        })\n      }\n    },\n    Edit_btn() {\n      if (this.edit === true) { // 可编辑状态\n        console.log('可以编辑')\n        this.edit = false\n        this.save = true\n        this.add_marker = true // 可修改marker\n        this.disabled = false // 各选项框可编辑\n        this.markers[0].draggable = true\n      } else { // 不可编辑\n        return false\n      }\n    },\n    tapefun(data) {\n      this.tape = data\n      var name = data === 1 ? '高德' : data === 2 ? '百度' : data === 3 ? '腾讯' : '手绘'\n      var data2 = {\n        cpid: this.$store.state.user.companyId,\n        id: this.id,\n        mapName: name,\n        mapType: data,\n        province: this.value.provinceName,\n        city: this.value1,\n        mngMapLon: this.input_longitude,\n        mngMapLat: this.input_latitude\n      }\n      post('/mngmapconfig/updMapConfigbyCpid', data2).then(res => {\n        console.log(res)\n      })\n    },\n    huo() {\n      get('/mngmapconfig/getMapConfigbyCpid', { cpid: this.$store.state.user.companyId }).then(res => {\n        console.log(res)\n        this.tape = res.data.mapType\n        this.id = res.data.id\n      })\n    }\n  }\n\n}\n",null]}