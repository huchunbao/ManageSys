{"remainingRequest":"D:\\办公\\projectwc\\前端\\ManageSys\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\办公\\projectwc\\前端\\ManageSys\\src\\views\\structure\\components\\account.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\办公\\projectwc\\前端\\ManageSys\\src\\views\\structure\\components\\account.vue","mtime":1577252313191},{"path":"D:\\办公\\projectwc\\前端\\ManageSys\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\办公\\projectwc\\前端\\ManageSys\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"D:\\办公\\projectwc\\前端\\ManageSys\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\办公\\projectwc\\前端\\ManageSys\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport { post, put } from '@/api/axios'\nimport { updateAvatar } from '@/api/user'\nimport { validMobile } from '@/utils/validate'\nexport default {\n  name: 'Account',\n  props: {\n    userInfo: {\n      type: Object,\n      'default': null\n    }\n  },\n  data() {\n    const validateMobile = (rule, value, callback) => {\n      if (value === '') {\n        callback(new Error('请输入新手机号码'))\n      } else if (!validMobile(value)) {\n        callback(new Error('手机号输入不正确!'))\n      } else {\n        callback()\n      }\n    }\n    return {\n      loading: false,\n      userId: 0,\n      showCropper: false,\n      imageUrl: '',\n      imageUpdate: false,\n      imgData: {\n        accept: 'image/jpeg, image/png, image/jpg'\n      },\n      accountForm: {\n        name: '',\n        mobile: '',\n        post: '',\n        password: ''\n      },\n      accountRules: {\n        name: [{ required: true, trigger: 'blur', message: '请输入姓名' }],\n        mobile: [{ required: true, trigger: 'blur', validator: validateMobile }],\n        post: [{ required: true, trigger: 'blur', message: '请输入职位' }],\n        password: [{ required: true, trigger: 'blur', message: '请输入密码' },\n          { min: 6, message: '密码必须大于6位', trigger: 'blur' }\n        ]\n      }\n    }\n  },\n  created() {\n    var that = this\n    if (that.userInfo.type === 1) { // 修改用户\n      that.userId = that.userInfo.userId\n      that.accountForm.name = that.userInfo.cusName\n      that.accountForm.mobile = that.userInfo.phone\n      that.accountForm.post = that.userInfo.postName\n      that.accountForm.password = '111111'\n      that.imageUrl = process.env.VUE_APP_BASE_API + '/user/img/' + that.userInfo.cusPic + '?t=' + new Date().getTime()\n    } else { // 添加用户\n      that.accountForm.name = ''\n      that.accountForm.mobile = ''\n      that.accountForm.post = ''\n      that.accountForm.password = ''\n      that.imageUrl = ''\n    }\n  },\n  methods: {\n    getObjectURL: function(file) {\n      var url = null\n      if (window.createObjectURL !== undefined) { // basic\n        url = window.createObjectURL(file)\n      } else if (window.URL !== undefined) { // mozilla(firefox)\n        url = window.URL.createObjectURL(file)\n      } else if (window.webkitURL !== undefined) { // webkit or chrome\n        url = window.webkitURL.createObjectURL(file)\n      }\n      return url\n    },\n    onchange: function(file, fileList) {\n      const fileData = file.raw\n      if (!fileData) return\n      const type = fileData.type // 文件的类型，判断是否是图片\n      const size = fileData.size // 文件的大小，判断图片的大小\n      if (this.imgData.accept.indexOf(type) === -1 || type === '') {\n        this.$message({\n          message: '请选择jpg、jpeg、png格式图片文件',\n          type: 'warning'\n        })\n        return false\n      }\n      if (size > 2097152) {\n        this.$message({\n          message: '请选择2M以下图片文件',\n          type: 'warning'\n        })\n        return false\n      }\n      this.imageUpdate = true\n      this.imageUrl = this.getObjectURL(fileData)\n    },\n    upLoadAvatar(params) {\n      var that = this\n      var formData = new FormData()\n      formData.append('file', params.file)\n      updateAvatar(this.userId, formData).then(response => {\n        that.loading = false\n        that.$emit('submituser')\n      })\n    },\n    submit() {\n      var that = this\n      this.$refs.accountForm.validate((valid) => {\n        if (valid) {\n          var user = {\n            cpid: that.userInfo.cpid,\n            cusName: that.accountForm.name,\n            phone: that.accountForm.mobile,\n            deptId: that.userInfo.deptId,\n            postName: that.accountForm.post,\n            cusPassword: that.accountForm.password\n          }\n          that.loading = true\n          if (that.userInfo.type === 0) {\n            post('/user', user).then(response => {\n              if (response.status === 0) {\n                this.userId = response.data.userId\n                this.$message({\n                  message: '添加成功',\n                  type: 'success',\n                  duration: 3000\n                })\n                if (this.imageUrl !== '') {\n                  that.$refs.upload.submit()\n                } else {\n                  that.loading = false\n                  that.$emit('submituser')\n                }\n              } else {\n                this.$message({\n                  message: response.msg,\n                  type: 'warning',\n                  duration: 3000\n                })\n                that.loading = false\n                that.$emit('submituser')\n              }\n            })\n          } else {\n            user.userId = that.userInfo.userId\n            user.cusName = (user.cusName === that.userInfo.cusName ? null : user.cusName)\n            user.phone = (user.phone === that.userInfo.phone ? null : user.phone)\n            user.postName = (user.postName === that.userInfo.postName ? null : user.postName)\n            user.cusPassword = null\n            put('/user', user).then(response => {\n              if (response.status === 0) {\n                this.$message({\n                  message: '修改成功',\n                  type: 'success',\n                  duration: 3000\n                })\n                if (this.imageUrl !== '' && this.imageUpdate) {\n                  that.$refs.upload.submit()\n                } else {\n                  that.loading = false\n                  that.$emit('submituser')\n                }\n              } else {\n                this.$message({\n                  message: response.msg,\n                  type: 'warning',\n                  duration: 3000\n                })\n                that.loading = false\n                that.$emit('submituser')\n              }\n            })\n          }\n        } else {\n          return\n        }\n      })\n    },\n    cancel() {\n      this.$emit('canceluser')\n    },\n    handleAvatarSuccess(res, file) {\n      this.imageUrl = URL.createObjectURL(file.raw)\n    },\n    beforeAvatarUpload(file) {\n      const isJPG = file.type === 'image/jpeg'\n      const isLt2M = file.size / 1024 / 1024 < 2\n\n      if (!isJPG) {\n        this.$message.error('上传头像图片只能是 JPG 格式!')\n      }\n      if (!isLt2M) {\n        this.$message.error('上传头像图片大小不能超过 2MB!')\n      }\n      return isJPG && isLt2M\n    }\n  }\n}\n",null]}