{"remainingRequest":"D:\\办公\\projectwc\\前端\\ManageSys\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\办公\\projectwc\\前端\\ManageSys\\src\\views\\acquisition\\index.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\办公\\projectwc\\前端\\ManageSys\\src\\views\\acquisition\\index.vue","mtime":1577252313667},{"path":"D:\\办公\\projectwc\\前端\\ManageSys\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\办公\\projectwc\\前端\\ManageSys\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"D:\\办公\\projectwc\\前端\\ManageSys\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\办公\\projectwc\\前端\\ManageSys\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport { get, post, put, byDelete } from '@/api/axios'\nimport { mapGetters } from 'vuex'\nimport DataWapper from './components/DataWapper'\nexport default {\n  components: { DataWapper },\n  data() {\n    return {\n      companyData: [],\n      selectCompanyNode: null,\n      defaultProps: {\n        children: 'children',\n        label: 'companyName'\n      },\n      collectionData: [],\n      childSysList: [],\n      childSysText: '',\n      selectCollectionNode: null,\n      showDialog: false,\n      dataForm: {\n        name: '',\n        company: '',\n        childSys: '',\n        childId: 0,\n        server: '',\n        username: '',\n        password: '',\n        protocol: '',\n        coding: '',\n        remark: ''\n      }\n    }\n  },\n  computed: {\n    ...mapGetters(['companyId'])\n  },\n  created() {\n    this.init()\n  },\n  methods: {\n    init() {\n      get('/company/' + this.companyId + '/tree', null).then(response => { // 获取公司\n        if (response.status === 0) {\n          this.companyData = response.data\n          this.companyData[0].children = [] // 只显示当前公司，不显示子公司\n        }\n      })\n      this.initCollection()\n      get('/subsystem/list-all', null).then(response => { // 获取子系统\n        if (response.status === 0) {\n          this.childSysList = response.data\n          this.childSysText = this.childSysList[0].name\n        }\n      })\n    },\n    initCollection() {\n      get('/data-collection/list/' + this.companyId, null).then(response => { // 数据采集列表\n        if (response.status === 0) {\n          this.collectionData = response.data\n        }\n      })\n    },\n    companyClick(node, all) {\n\n    },\n    addCollection(data) { // 添加数据采集\n      const form = {\n        cpid: this.companyId,\n        subsystemId: data[0].childId,\n        collectionName: data[0].name,\n        shopName: data[0].company,\n        ip: data[0].server,\n        name: data[0].username,\n        password: data[0].password,\n        protocolType: data[0].protocol,\n        contents: data[0].coding,\n        describes: data[0].remark\n      }\n      post('/data-collection', form).then(response => {\n        if (response.status === 0) {\n          this.$refs.dataDialog.loading = false\n          this.$message({\n            message: '数据采集添加成功',\n            type: 'success',\n            duration: 3000\n          })\n        } else {\n          this.$message({\n            message: response.msg,\n            type: 'warning',\n            duration: 3000\n          })\n        }\n        this.initCollection()\n        this.showDialog = false\n      })\n    },\n    collectionClick(node) { // 数据列表点击显示\n      this.selectCollectionNode = JSON.parse(JSON.stringify(node))\n      this.$refs.dataPage.collectionForm.id = this.selectCollectionNode.id\n      this.$refs.dataPage.collectionForm.name = this.selectCollectionNode.collectionName\n      this.$refs.dataPage.collectionForm.company = this.selectCollectionNode.shopName\n      this.$refs.dataPage.collectionForm.childSys = this.selectCollectionNode.subSystem.name\n      this.$refs.dataPage.collectionForm.childId = this.selectCollectionNode.subsystemId\n      this.$refs.dataPage.collectionForm.server = this.selectCollectionNode.ip\n      this.$refs.dataPage.collectionForm.username = this.selectCollectionNode.name\n      this.$refs.dataPage.collectionForm.password = this.selectCollectionNode.password\n      this.$refs.dataPage.collectionForm.protocol = this.selectCollectionNode.protocolType\n      this.$refs.dataPage.collectionForm.coding = this.selectCollectionNode.contents\n      this.$refs.dataPage.collectionForm.remark = this.selectCollectionNode.describes\n    },\n    deleteCollect() { // 删除数据采集\n      if (this.selectCollectionNode === null) {\n        this.$message({\n          message: '请选择需要删除的数据采集',\n          type: 'warning',\n          duration: 3000\n        })\n      } else {\n        this.$confirm('是否删除\"' + this.selectCollectionNode.collectionName + '\"', '提示', {\n          confirmButtonText: '确定',\n          cancelButtonText: '取消',\n          type: 'warning'\n        }).then(() => {\n          byDelete('/data-collection/' + this.selectCollectionNode.id, null).then(response => {\n            if (response.status === 0) {\n              this.$refs.collectionTree.remove(this.selectCollectionNode)\n              this.$refs.dataPage.btnSave = false\n              this.$refs.dataPage.$refs.collectionForm.resetFields()\n              this.selectCollectionNode = null\n              this.$message({\n                message: '数据采集删除成功',\n                type: 'success',\n                duration: 3000\n              })\n            } else {\n              this.$message({\n                message: response.msg,\n                type: 'warning',\n                duration: 3000\n              })\n            }\n          })\n        })\n      }\n    },\n    updateCollection(data) { // 修改数据采集\n      const form = {\n        id: this.selectCollectionNode.id,\n        subsystemId: data[0].childId,\n        subSystem: {\n          id: data[0].childId,\n          name: data[0].childSys\n        },\n        collectionName: data[0].name,\n        shopName: data[0].company,\n        ip: data[0].server,\n        name: data[0].username,\n        password: data[0].password,\n        protocolType: data[0].protocol,\n        contents: data[0].coding,\n        describes: data[0].remark\n      }\n      put('/data-collection', form).then(response => {\n        if (response.status === 0) {\n          this.$message({\n            message: '修改成功',\n            type: 'success',\n            duration: 3000\n          })\n          const len = this.collectionData.length\n          for (let i = 0; i < len; i++) {\n            if (this.collectionData[i].id === this.selectCollectionNode.id) {\n              this.collectionData[i].collectionName = form.collectionName\n              this.collectionData[i].shopName = form.shopName\n              this.collectionData[i].subSystem.name = form.subSystem.name\n              this.collectionData[i].subSystem.id = form.subsystemId\n              this.collectionData[i].subsystemId = form.subsystemId\n              this.collectionData[i].ip = form.ip\n              this.collectionData[i].name = form.name\n              this.collectionData[i].password = form.password\n              this.collectionData[i].protocolType = form.protocolType\n              this.collectionData[i].contents = form.contents\n              this.collectionData[i].describes = form.describes\n            }\n          }\n          this.$refs.dataPage.loading = false\n          this.$refs.dataPage.btnSave = false\n        } else {\n          this.$message({\n            message: response.msg,\n            type: 'warning',\n            duration: 3000\n          })\n        }\n      })\n    }\n  }\n}\n",null]}