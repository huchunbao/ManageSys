{"remainingRequest":"D:\\办公\\projectwc\\前端\\ManageSys\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\办公\\projectwc\\前端\\ManageSys\\src\\views\\map\\watchman.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\办公\\projectwc\\前端\\ManageSys\\src\\views\\map\\watchman.vue","mtime":1576811950355},{"path":"D:\\办公\\projectwc\\前端\\ManageSys\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\办公\\projectwc\\前端\\ManageSys\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"D:\\办公\\projectwc\\前端\\ManageSys\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\办公\\projectwc\\前端\\ManageSys\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport VueAMap from 'vue-amap'\n\nimport { get, post } from '@/api/axios'\nvar amapManager = new VueAMap.AMapManager()\nexport default {\n  name: 'Map',\n  data() {\n    return {\n      disabled: false,\n      tank: '',\n      name: '',\n      bei: '',\n      zoom: 16,\n      center: [116.336496, 39.942178],\n      mapStyle1: 'amap://styles/whitesmoke',\n      amapManager,\n      events: {},\n      overlayGroups: [],\n      data: [], // table 列表数据集合\n      rowindex: '',\n      dataid: 0,\n      value: '',\n      options2: [],\n      value2: '',\n      line: ''\n    }\n  },\n  computed: {\n    isopen: function() {\n      return (this.name && this.value2 && this.data)\n    }\n  },\n  watch: {\n    data() {\n    },\n    disabled() {\n      if (!this.disabled) {\n        this.data = []\n        this.name = []\n        this.bei = []\n        this.value2 = ''\n        this.addmarker()\n      }\n    }\n  },\n  created() {\n    this.addfun()\n    this.shebei()\n  },\n  methods: {\n    shebei() {\n      get('/camara/getEqType?', { system_id: 5 }).then(res => {\n        console.log(res)\n        this.options2 = res\n      })\n    },\n    ti() {\n      if (this.name !== '' && this.value2 !== '' && this.data.length > 0) {\n        var markers = []\n        for (var i = 0; i < this.data.length; i++) {\n          markers.push({\n            pointName: this.data[i].name,\n            circuitName: this.name,\n            orderNumber: i + 1,\n            circuitPointLon: this.data[i].indt[0],\n            circuitPointLat: this.data[i].indt[1]\n          })\n        }\n        var data = {\n          cpid: this.$store.state.user.companyId,\n          circuitTypeId: 1,\n          circuitType: '巡更',\n          circuitName: this.name,\n          remark: this.bei,\n          // 设备id    equimentId\n          circuitpointlist: markers,\n          equimentId: this.value2\n        }\n        post('/mngCircuitInfo/savemngcircuitinfo', data).then(res => {\n          post('/camara/updpoint', { pid: data.equimentId * 1, binding: 1 }).then(res => {\n            this.shebei()\n            this.disabled = !this.disabled\n            this.$message({\n              message: '保存成功',\n              type: 'success'\n            })\n          })\n        })\n      } else {\n        this.$message({\n          message: '请认真检查填写项',\n          type: 'warning'\n        })\n      }\n    },\n    addfun() {\n      var that = this\n      this.events = {\n        init(o) {\n          o.on('click', function(e) {\n            that.wei(e.lnglat.getLng(), e.lnglat.getLat(), that)\n          })\n        }\n      }\n    },\n    addmarker() {\n      console.log(123)\n      var that = this\n      var o = amapManager.getMap()\n      var markers = []\n      var open = []\n      o.remove(that.overlayGroups)\n      o.remove(that.line)\n      for (var i = 0; i < that.data.length; i++) {\n        if (that.data[i].indt !== '') {\n          var marker = new AMap.Marker({\n            position: that.data[i].indt,\n            rowindex: that.rowindex,\n            text: '123',\n            icon: 'https://webapi.amap.com/theme/v1.3/markers/n/mark_b' + (markers.length + 1) + '.png'\n          })\n          open.push(that.data[i].indt)\n          markers.push(marker)\n        }\n      }\n      if (open.length > 1) {\n        console.log(open)\n        that.line = new AMap.Polyline({\n          map: o,\n          strokeColor: '#80d8ff',\n          isOutline: true,\n          strokeStyle: 'dashed',\n          outlineColor: 'white',\n          path: open\n        })\n      }\n      this.overlayGroups = new AMap.OverlayGroup(markers)\n      o.add(that.overlayGroups)\n    },\n    wei(a, b, that) {\n      console.log(that.rowindex)\n      if (that.rowindex !== '') {\n        that.data[that.rowindex].indt = [a, b]\n      } else {\n        that.data[that.dataid].indt = [a, b]\n      }\n      this.addmarker()\n    },\n    jia() {\n      this.data.push({ name: '', indt: '' })\n      this.dataid = this.data.length - 1\n      this.rowindex = this.dataid\n      this.$refs.singleTable.setCurrentRow(this.data[this.dataid])\n    },\n    jian() {\n      if (this.rowindex || this.rowindex === 0) {\n        this.data.splice(this.rowindex, 1)\n      } else {\n        this.data.splice(this.dataid, 1)\n      }\n      this.rowindex = this.data.length - 1\n      this.$refs.singleTable.setCurrentRow(this.data[this.data.length - 1])\n      this.addmarker()\n    },\n    shang() {\n      if (this.dataid > 1 || this.dataid === 1) {\n        var a = this.data[this.dataid]\n        this.data[this.dataid] = this.data[this.dataid - 1]\n        this.data[this.dataid - 1] = a\n        this.dataid -= 1\n        this.$refs.singleTable.setCurrentRow(this.data[this.dataid])\n      }\n      this.addmarker()\n    },\n    xia() {\n      console.log(this.rowindex)\n      console.log(this.dataid)\n      if (this.dataid !== this.data.length - 1 && this.data.length > 1) {\n        var a = this.data[this.dataid]\n        this.data[this.dataid] = this.data[this.dataid + 1]\n        this.data[this.dataid + 1] = a\n        this.dataid += 1\n        this.$refs.singleTable.setCurrentRow(this.data[this.dataid])\n      }\n      this.addmarker()\n    },\n    indexMethod(index) {\n      return index + 1\n    },\n    tableRowClassName({ row, rowIndex }) {\n      row.index = rowIndex // 把每一行的索引放进row\n    },\n    onRowClick(row, event, column) {\n      var index = row.index\n      this.rowindex = index // 点击当前行的行数\n      this.dataid = index\n      console.log(this.data)\n    }\n  }\n}\n",null]}