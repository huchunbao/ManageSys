{"remainingRequest":"D:\\办公\\projectwc\\前端\\ManageSys\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\办公\\projectwc\\前端\\ManageSys\\src\\views\\system\\index.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\办公\\projectwc\\前端\\ManageSys\\src\\views\\system\\index.vue","mtime":1577252313041},{"path":"D:\\办公\\projectwc\\前端\\ManageSys\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"D:\\办公\\projectwc\\前端\\ManageSys\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\办公\\projectwc\\前端\\ManageSys\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport { get, post, put, byDelete } from '@/api/axios'\nimport SetDialog from './components/SetDialog'\nimport AddDialog from './components/AddDialog'\nexport default {\n  components: { SetDialog, AddDialog },\n  data() {\n    return {\n      companyId: this.$store.state.user.companyId, // 公司ID\n      manager: '', // 维修管理员\n      bearer: '', // 承载量告警审核人\n      dev: '', // 设备告警审核人\n      integral: { // 积分换算\n        count: '',\n        money: 1,\n        save: true\n      },\n      showDlg: false, // 弹窗显示状态\n      setType: 0, // 0 添加  1 需改\n      dlgTitle: '', // 弹窗标题\n      dlgShowName: '', // 弹窗label\n      dlgUserList: [], // 人员列表\n      tabIndex: 0, // 地图点位 0 设备  1 场所\n      devData: [], // 设备地图点位\n      placeData: [], // 场所地图点位\n      selectDevRow: null, // 设备地图点位当前选中\n      selectPlaceRow: null, // 场所地图点位当前选中\n      templateSave: true, // 模板保存状态\n      channelData: [], // 渠道列表\n      selectChannelRow: null, // 渠道列表当前选中\n      channelText: '', // 渠道模板内容\n      channelEditStatus: true, // 渠道编辑状态\n      channelEditLoading: false, // 渠道保存Loading\n      planData: [], // 方案列表\n      selectPlanRow: null, // 方案列表当前选中\n      planValue: [], // 方案列表当前选中项的渠道\n      showPlanDlg: false, // 添加方案界面显示状态\n      dlgPlanTitle: '', // 添加方案标题\n      planLoading: false, // 添加方案Loading\n      showAddDlg: false, // 添加界面显示状态\n      dlgAddTitle: '', // 添加界面标题\n      addText: '', // 添加名称\n      addType: 0 // 1设备 2场所 3渠道 4方案\n    }\n  },\n  created() {\n    this.init()\n  },\n  methods: {\n    init: function() {\n      get('/property/' + this.companyId, null).then(response => { // 维修员管理 承载量告警审核人 设备告警审核人 积分兑换\n        if (response.status === 0) {\n          this.manager = response.data.propValue\n          response.data.forEach(item => {\n            switch (item.propName) {\n              case 'repair.clerk.name': // 维修人员\n                this.manager = item.propValue\n                break\n              case 'alarm.load-volume.auditor.name': // 承载量审核\n                this.bearer = item.propValue\n                break\n              case 'alarm.equipment.auditor.name': // 设备审核\n                this.dev = item.propValue\n                break\n              case 'point.ratio': // 积分兑换\n                this.integral.count = item.propValue\n                break\n              default:\n                break\n            }\n          })\n        }\n      })\n      this.initMapPoint() // 显示地图点位列表\n      this.initChannel() // 显示渠道列表\n      this.initPlan() // 显示通知方案列表\n      get('/user/list/cp' + this.companyId, null).then(response => { // 所有人员\n        if (response.status === 0) {\n          this.dlgUserList = response.data\n        }\n      })\n    },\n    initMapPoint: function() {\n      get('/mngpoint/point-type/' + this.companyId, null).then(response => { // 获取地图点位\n        if (response.status === 0) {\n          console.log(response.data)\n          this.devData = []\n          this.placeData = []\n          if (response.data.length > 0) {\n            response.data.forEach(item => {\n              switch (item.typeProperties) {\n                case 1:\n                  break\n                case 2:\n                  this.placeData.push({\n                    id: item.id,\n                    name: item.typeName\n                  })\n                  break\n                case 3:\n                  this.devData.push({\n                    id: item.id,\n                    name: item.typeName\n                  })\n                  break\n                case 4:\n                  break\n                default:\n                  break\n              }\n            })\n          }\n        }\n      })\n    },\n    initChannel: function() {\n      get('/notify-template/' + this.companyId, null).then(response => { // 获取渠道通知模板\n        if (response.status === 0) {\n          this.channelData = response.data\n        }\n      })\n    },\n    initPlan: function() {\n      get('/notify-scheme/' + this.companyId, null).then(response => { // 获取通知方案\n        if (response.status === 0) {\n          this.planData = response.data\n        }\n      })\n    },\n    getPlanItem: function(row, column) { // 获取通知方案渠道\n      let plan = ''\n      row.models.forEach(item => {\n        plan += item.wayName + '+'\n      })\n      return plan.substring(0, plan.length - 1)\n    },\n    setPerson: function(type) { // 显示设置人员界面\n      switch (type) {\n        case 1:\n          this.dlgTitle = '维修管理员设置'\n          this.dlgShowName = this.manager\n          break\n        case 2:\n          this.dlgTitle = '承载量告警审核人设置'\n          this.dlgShowName = this.bearer\n          break\n        case 3:\n          this.dlgTitle = '设备告警审核人设置'\n          this.dlgShowName = this.dev\n          break\n        default:\n          break\n      }\n      this.setType = type\n      this.showDlg = true\n    },\n    submitDlg: function(data) { // 提交人员设置\n      let url = ''\n      switch (this.setType) {\n        case 1:\n          url = '/property/repair-clerk/name'\n          break\n        case 2:\n          url = '/property/load-volume-auditor/name'\n          break\n        case 3:\n          url = '/property/equip-auditor/name'\n          break\n        default:\n          break\n      }\n      const user = {\n        cpid: this.companyId,\n        propValue: data[0].showName\n      }\n      put(url, user).then(response => {\n        if (response.status === 0) {\n          switch (this.setType) {\n            case 1:\n              this.manager = data[0].showName\n              break\n            case 2:\n              this.bearer = data[0].showName\n              break\n            case 3:\n              this.dev = data[0].showName\n              break\n            default:\n              break\n          }\n          this.$message({\n            message: '人员设置成功',\n            type: 'success',\n            duration: 3000\n          })\n        } else {\n          this.$message({\n            message: response.msg,\n            type: 'warning',\n            duration: 3000\n          })\n        }\n        this.showDlg = false\n      })\n    },\n    editIntegral: function() { // 积分设置状态\n      this.integral.save = false\n    },\n    saveIntegral: function() { // 保存积分修改\n      if (this.integral.count === '') {\n        this.$message({\n          message: '请输入积分',\n          type: 'warning',\n          duration: 3000\n        })\n      } else {\n        put('/property/' + this.companyId + '/point-ratio?ratio=' + this.integral.count, null).then(response => {\n          if (response.status === 0) {\n            this.$message({\n              message: '积分保存成功',\n              type: 'success',\n              duration: 3000\n            })\n            this.integral.save = true\n          } else {\n            this.$message({\n              message: response.msg,\n              type: 'warning',\n              duration: 3000\n            })\n          }\n        })\n      }\n    },\n    changeTab: function(index) { // 地图点位tab切换\n      this.tabIndex = index\n      if (this.tabIndex === 0) {\n        this.selectPlaceRow = null\n      } else {\n        this.selectDevRow = null\n      }\n    },\n    clickDev: function(row) { // 设备地图点位点击事件\n      this.selectDevRow = row\n    },\n    clickPlace: function(row) { // 场所地图点位点击事件\n      this.selectPlaceRow = row\n    },\n    addMapPoint: function() { // 显示添加点位界面\n      this.addType = this.tabIndex + 1\n      this.dlgAddTitle = '地图点位添加' + (this.tabIndex === 0 ? '(设备)' : '(场所)')\n      this.addText = '点位'\n      this.showAddDlg = true\n    },\n    deleteMapPoint: function() { // 删除地图点位\n      let row = null\n      if (this.tabIndex === 0) {\n        row = this.selectDevRow\n      } else {\n        row = this.selectPlaceRow\n      }\n      if (row === null) {\n        this.$message({\n          message: '请选择需要删除的地图点位',\n          type: 'warning',\n          duration: 3000\n        })\n      } else {\n        this.$confirm('是否删除地图点位\"' + row.name + '\"', '提示', {\n          confirmButtonText: '确定',\n          cancelButtonText: '取消',\n          type: 'warning'\n        }).then(() => {\n          byDelete('/mngpoint/delPointType?id=' + row.id, null).then(response => {\n            if (response.status === 0) {\n              this.$message({\n                message: '地图点位删除成功',\n                type: 'success',\n                duration: 3000\n              })\n              if (this.tabIndex === 0) {\n                this.devData.some((item, i) => {\n                  if (item.id === row.id) {\n                    this.devData.splice(i, 1)\n                    return true\n                  }\n                })\n                this.selectDevRow = null\n              } else {\n                this.placeData.some((item, i) => {\n                  if (item.id === row.id) {\n                    this.placeData.splice(i, 1)\n                    return true\n                  }\n                })\n                this.selectPlaceRow = null\n              }\n            } else {\n              this.$message({\n                message: response.msg,\n                type: 'warning',\n                duration: 3000\n              })\n            }\n          })\n        })\n      }\n    },\n    submitAddDlg: function(data) { // 提交添加\n      let url = ''\n      const form = {\n        cpid: this.companyId\n      }\n      switch (this.addType) {\n        case 1:\n          url = '/mngpoint/savePointType' // 地图设备\n          form.typeProperties = 3\n          form.typeName = data[0]\n          break\n        case 2:\n          url = '/mngpoint/savePointType' // 地图场所\n          form.typeProperties = 2\n          form.typeName = data[0]\n          break\n        case 3:\n          url = '/notify-template' // 模板\n          form.wayName = data[0]\n          form.content = ''\n          break\n        case 4:\n          url = '/notify-scheme' // 方案\n          form.wayName = data[0]\n          break\n        default:\n          break\n      }\n      post(url, form).then(response => {\n        if (response.status === 0) {\n          this.$message({\n            message: this.addText + '添加成功',\n            type: 'success',\n            duration: 3000\n          })\n          switch (this.addType) {\n            case 1:\n            case 2:\n              this.initMapPoint()\n              break\n            case 3:\n              this.initChannel()\n              break\n            case 4:\n              this.initPlan()\n              break\n            default:\n              break\n          }\n          this.showAddDlg = false\n        } else {\n          this.$message({\n            message: response.msg,\n            type: 'warning',\n            duration: 3000\n          })\n        }\n      })\n    },\n    addChannel: function() { // 显示添加渠道界面\n      this.addType = 3\n      this.dlgAddTitle = '渠道通知模板添加'\n      this.addText = '渠道'\n      this.showAddDlg = true\n    },\n    deleteChannel: function() { // 删除渠道\n      if (this.selectChannelRow === null) {\n        this.$message({\n          message: '请选择需要删除的渠道',\n          type: 'warning',\n          duration: 3000\n        })\n      } else {\n        this.$confirm('是否删除渠道\"' + this.selectChannelRow.wayName + '\"', '提示', {\n          confirmButtonText: '确定',\n          cancelButtonText: '取消',\n          type: 'warning'\n        }).then(() => {\n          byDelete('/notify-template/' + this.selectChannelRow.id, null).then(response => {\n            if (response.status === 0) {\n              this.$message({\n                message: '渠道\"' + this.selectChannelRow.wayName + '\"删除成功',\n                type: 'success',\n                duration: 3000\n              })\n              this.channelData.some((item, i) => {\n                if (item.id === this.selectChannelRow.id) {\n                  this.channelData.splice(i, 1)\n                  return true\n                }\n              })\n              this.selectChannelRow = null\n              this.channelText = ''\n            } else {\n              this.$message({\n                message: response.msg,\n                type: 'warning',\n                duration: 3000\n              })\n            }\n          })\n        }).catch(() => {\n\n        })\n      }\n    },\n    clickChannel: function(row) { // 点击渠道\n      this.selectChannelRow = row\n      this.channelText = row.content\n    },\n    editChannel: function() { // 编辑渠道内容\n      if (this.selectChannelRow === null) {\n        this.$message({\n          message: '请选择需要编辑的渠道',\n          type: 'warning',\n          duration: 3000\n        })\n      } else {\n        this.templateSave = false\n      }\n    },\n    saveChannel: function() { // 保存渠道内容\n      if (this.channelText === '') {\n        this.$message({\n          message: '请输入模板内容',\n          type: 'warning',\n          duration: 3000\n        })\n      } else {\n        this.channelEditLoading = true\n        put('/notify-template', { id: this.selectChannelRow.id, content: this.channelText }).then(response => {\n          if (response.status === 0) {\n            this.$message({\n              message: '模板修改成功',\n              type: 'success',\n              duration: 3000\n            })\n            this.selectChannelRow.content = this.channelText\n            this.templateSave = true\n            this.channelEditLoading = false\n          } else {\n            this.$message({\n              message: response.msg,\n              type: 'warning',\n              duration: 3000\n            })\n          }\n        })\n      }\n    },\n    addPlan: function() { // 显示添加方案界面\n      this.addType = 4\n      this.dlgAddTitle = '通知方案添加'\n      this.addText = '方案'\n      this.showAddDlg = true\n    },\n    clickPlan: function(row) { // 点击方案列表\n      this.selectPlanRow = row\n    },\n    deletePlan: function() { // 删除方案\n      if (this.selectPlanRow === null) {\n        this.$message({\n          message: '请选择需要删除的方案',\n          type: 'warning',\n          duration: 3000\n        })\n      } else {\n        this.$confirm('是否删除方案\"' + this.selectPlanRow.wayName + '\"', '提示', {\n          confirmButtonText: '确定',\n          cancelButtonText: '取消',\n          type: 'warning'\n        }).then(() => {\n          byDelete('/notify-scheme/' + this.selectPlanRow.id, null).then(response => {\n            if (response.status === 0) {\n              this.$message({\n                message: '方案\"' + this.selectPlanRow.wayName + '\"删除成功',\n                type: 'success',\n                duration: 3000\n              })\n              this.planData.some((item, i) => {\n                if (item.id === this.selectPlanRow.id) {\n                  this.planData.splice(i, 1)\n                  return true\n                }\n              })\n              this.selectPlanRow = null\n            } else {\n              this.$message({\n                message: response.msg,\n                type: 'warning',\n                duration: 3000\n              })\n            }\n          })\n        }).catch(() => {\n\n        })\n      }\n    },\n    updatePlan: function(row) { // 修改方案渠道\n      this.dlgPlanTitle = row.row.wayName + '渠道设置'\n      row.row.models.forEach(item => {\n        this.planValue.push(item.id)\n      })\n      this.showPlanDlg = true\n    },\n    submitPlan: function() { // 提交方案渠道\n      if (this.planValue.length <= 0) {\n        this.$message({\n          message: '请选择渠道',\n          type: 'warning',\n          duration: 3000\n        })\n      } else {\n        this.planLoading = true\n        const form = {\n          id: this.selectPlanRow.id,\n          models: []\n        }\n        this.planValue.forEach(item => {\n          form.models.push({ id: item })\n        })\n        put('/notify-scheme', form).then(response => {\n          if (response.status === 0) {\n            this.$message({\n              message: '方案设置成功',\n              type: 'success',\n              duration: 3000\n            })\n            this.selectPlanRow = null\n            this.planValue = []\n            this.planLoading = false\n            this.initPlan()\n            this.showPlanDlg = false\n          } else {\n            this.$message({\n              message: response.msg,\n              type: 'warning',\n              duration: 3000\n            })\n          }\n        })\n      }\n    }\n  }\n}\n",null]}