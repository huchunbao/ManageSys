{"remainingRequest":"D:\\办公\\projectwc\\前端\\ManageSys\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\办公\\projectwc\\前端\\ManageSys\\src\\views\\car\\caralarm.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\办公\\projectwc\\前端\\ManageSys\\src\\views\\car\\caralarm.vue","mtime":1576638137173},{"path":"D:\\办公\\projectwc\\前端\\ManageSys\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\办公\\projectwc\\前端\\ManageSys\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"D:\\办公\\projectwc\\前端\\ManageSys\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\办公\\projectwc\\前端\\ManageSys\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n\nimport { getList, excelList } from '@/api/car'\nimport CarSearch from './components/CarSearch'\nimport CarTable from './components/CarTable'\nimport { parseTime } from '@/utils'\n\nexport default {\n  name: 'CarAlarm',\n  components: { CarSearch, CarTable },\n  data() {\n    return {\n      nameList: [{ id: 0, veh_code: '全部车辆' }],\n      datalist: [{ id: 1, vehCode: '12345', alarmType: '断电报警', alarmCheck: '已审核', alarmHandle: '已处理', fleet: '一队', terminal: '136218', mobile: '13576458758', alarmTime: '2019-9-6 10:32:12', alarmStatus: '已处理', alarmLocation: '云端动物园', alarmPerson: '王小山', handleTime: '2019-9-6 10:38:27', handleType: '检查', handlePerson: '宁晓博', handleContent: '设备断电', handleResult: '处理完成' },\n        { id: 2, vehCode: '12346', alarmType: '超速报警', alarmCheck: '已审核', alarmHandle: '已处理', fleet: '一队', terminal: '136219', mobile: '13576458751', alarmTime: '2019-9-7 14:02:52', alarmStatus: '已处理', alarmLocation: '森林冒险公园', alarmPerson: '贺亮', handleTime: '2019-9-7 14:30:27', handleType: '警告', handlePerson: '宁晓博', handleContent: '车辆超速', handleResult: '处理完成' },\n        { id: 3, vehCode: '12347', alarmType: '超时报警', alarmCheck: '已审核', alarmHandle: '已处理', fleet: '二队', terminal: '136311', mobile: '13576450738', alarmTime: '2019-9-7 11:12:35', alarmStatus: '已处理', alarmLocation: '云端动物园', alarmPerson: '史俊', handleTime: '2019-9-7 11:38:02', handleType: '通知', handlePerson: '韩佳佳', handleContent: '车辆误点', handleResult: '处理完成' },\n        { id: 4, vehCode: '12348', alarmType: '区域报警', alarmCheck: '已审核', alarmHandle: '已处理', fleet: '二队', terminal: '136312', mobile: '13576450736', alarmTime: '2019-9-8 15:32:12', alarmStatus: '已处理', alarmLocation: '森林冒险公园', alarmPerson: '杨文佳', handleTime: '2019-9-8 15:38:55', handleType: '通知', handlePerson: '韩佳佳', handleContent: '车辆越界', handleResult: '处理完成' }\n      ]\n    }\n  },\n  created() {\n    this.getTabList('/boatsInfo/cardList', {}).then(data => {\n      this.nameList = this.nameList.concat(data.data)\n    })\n  },\n  mounted() {\n    this.$refs.alarmsearch.queryData = {\n      'startTime': '',\n      'endTime': '',\n      'id': null,\n      'vehCode': '',\n      'pageNum': 1,\n      'pageSize': 20,\n      'alarm': '全部报警'\n    }\n\n    this.$refs.alarmtable.datalist = this.datalist\n    this.$refs.alarmtable.total = 4\n  },\n  methods: {\n    getTabList(url, query) {\n      return new Promise((resolve, reject) => {\n        getList(url, query).then(response => {\n          resolve(response)\n        }).catch(error => {\n          reject(error)\n        })\n      })\n    },\n    search(query) {\n      this.searchData(query)\n    },\n    searchData(query) {\n      var that = this\n      var alarmType = query[1].alarm\n      console.log(alarmType)\n      if (alarmType === '断电报警') {\n        that.$refs.alarmtable.datalist = this.datalist.filter(item => item.id === 1)\n        that.$refs.alarmtable.total = 1\n      } else if (alarmType === '超速报警') {\n        that.$refs.alarmtable.datalist = this.datalist.filter(item => item.id === 2)\n        that.$refs.alarmtable.total = 1\n      } else if (alarmType === '超时报警') {\n        that.$refs.alarmtable.datalist = this.datalist.filter(item => item.id === 3)\n        that.$refs.alarmtable.total = 1\n      } else if (alarmType === '区域报警') {\n        that.$refs.alarmtable.datalist = this.datalist.filter(item => item.id === 4)\n        that.$refs.alarmtable.total = 1\n      } else {\n        that.$refs.alarmtable.datalist = this.datalist\n        that.$refs.alarmtable.total = 4\n      }\n      // that.getTabList('', query).then(data => {\n      //   that.$refs.alarmtable.datalist = data.data.list.content\n      //   that.$refs.alarmtable.total = data.data.allCount\n      // })\n    },\n    excel(query) {\n      var that = this\n      new Promise((resolve, reject) => {\n        excelList('', query[1]).then(response => {\n          resolve(response)\n        }).catch(error => {\n          reject(error)\n        })\n      }).then(response => {\n        const blob = new Blob([response], { type: 'application/vnd.ms-excel' })\n        if (window.navigator.msSaveOrOpenBlob) {\n          navigator.msSaveBlob(blob)\n        } else {\n          var link = document.createElement('a')\n          var evt = document.createEvent('HTMLEvents')\n          evt.initEvent('click', false, false)\n          link.href = URL.createObjectURL(blob)\n          link.download = query[1].alarm + parseTime(new Date())\n          link.style.display = 'none'\n          document.body.appendChild(link)\n          link.click()\n          window.URL.revokeObjectURL(link.href)\n        }\n        that.$refs.alarmsearch.downloadLoading = false\n      }).catch((e) => {\n        console.log(e)\n        that.$refs.alarmsearch.downloadLoading = false\n      })\n    },\n    pageChange(page) {\n      const query = this.$refs.alarmsearch.queryData\n      query.pageNum = page[1].page\n      this.searchData(query)\n    }\n  }\n}\n",null]}