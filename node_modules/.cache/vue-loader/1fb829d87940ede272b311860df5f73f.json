{"remainingRequest":"D:\\办公\\projectwc\\前端\\ManageSys\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\办公\\projectwc\\前端\\ManageSys\\src\\views\\structure\\galasys.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\办公\\projectwc\\前端\\ManageSys\\src\\views\\structure\\galasys.vue","mtime":1577252313187},{"path":"D:\\办公\\projectwc\\前端\\ManageSys\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"D:\\办公\\projectwc\\前端\\ManageSys\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\办公\\projectwc\\前端\\ManageSys\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport { get, post, put, byDelete } from '@/api/axios'\nimport { validMobile, validEmail } from '@/utils/validate'\nimport { parseTime } from '@/utils'\nimport TreeTransfer from './components/TreeTransfer'\nimport Role from './components/role'\nimport Account from './components/account'\nimport ReviewOk from '@/assets/icon/icon_review_ok.png'\nimport ReviewDefault from '@/assets/icon/icon_review_default.png'\nexport default {\n  components: { TreeTransfer, Role, Account },\n  data() {\n    const newDate = new Date()\n    const validateMobile = (rule, value, callback) => {\n      if (value === '') {\n        callback(new Error('请输入手机号码'))\n      } else if (!validMobile(value)) {\n        callback(new Error('手机号输入不正确!'))\n      } else {\n        callback()\n      }\n    }\n    const validateEmail = (rule, value, callback) => {\n      if (value === '') {\n        callback(new Error('请输入邮箱'))\n      } else if (!validEmail(value)) {\n        callback(new Error('邮箱格式不正确!'))\n      } else {\n        callback()\n      }\n    }\n    return {\n      reviewUser: { // 审核用户信息\n        id: 0,\n        auditorId: 0,\n        auditorName: '',\n        auditorEmail: '',\n        auditorLevel: 0\n      },\n      reviewType: 0, // 审核级别\n      showReview: false, // 是否为审核人员\n      reviewText: '', // 审核说明\n      reviewStatus: '通过', // 审核状态\n      isGalasys: false, // 是否为银科环企用户\n      companyDelBtn: false, // 删除公司按钮状态\n      selectCompanyNode: null, // 当前公司树列表选择节点\n      selectCompanyId: 0, // 当前选择公司ID，选择客户子公司时为客户总公司ID\n      selectLicenseId: 0, // 客户公司授权ID\n      natureList: [], // 公司性质\n      typeList: [], // 公司类别\n      companyData: [], // 公司树列表\n      companyProps: { children: 'children', label: 'companyName' },\n      companyForm: { // 修改公司Form\n        btnName: '编辑',\n        status: 0,\n        companyId: 0,\n        name: '',\n        principal: '',\n        nature: '',\n        natureId: 0,\n        mobile: '',\n        type: '',\n        typeId: 0,\n        email: '',\n        date: ['', '']\n      },\n      showAddCompany: false, // 添加公司界面状态\n      addCompanyType: 0, // 0 总公司 1子公司 只有galasys可以加子公司\n      addCompanyForm: { // 添加公司Form\n        name: '',\n        principal: '',\n        nature: '',\n        natureId: 0,\n        mobile: '',\n        type: '',\n        typeId: 0,\n        email: '',\n        licenseId: 0,\n        date: [newDate.getFullYear() + '-' + (newDate.getMonth() + 1) + '-' + newDate.getDate(),\n          (newDate.getFullYear() + 1) + '-' + (newDate.getMonth() + 1) + '-' + newDate.getDate()\n        ]\n      },\n      addCompanyRules: { name: [{ required: true, message: '请输入公司名称', trigger: 'blur' }],\n        principal: [{ required: true, message: '请输入负责人', trigger: 'blur' }],\n        mobile: [{ required: true, validator: validateMobile, trigger: 'blur' }],\n        email: [{ required: true, validator: validateEmail, trigger: 'blur' }]\n      },\n      addCompanyLoading: false, // 添加公司按钮Loading\n      reviewOk: ReviewOk, // 审核通过图标\n      reviewDefault: ReviewDefault, // 审核不通过和默认状态图标\n      reviewCompanyStatus: { // 审核Form\n        auditStatus: 0,\n        id: 0,\n        licenseEnd: '',\n        licenseStart: '',\n        firstAuditstatus: 0,\n        secondAuditstatus: 0,\n        thirdAuditstatus: 0,\n        updateBy: null,\n        updateDate: null\n      },\n      reviewCompanyContent: { // 公司树列表选中公司审核状态\n        first: '',\n        firstResult: 0,\n        second: '',\n        secondResult: 0,\n        third: '',\n        thirdResult: 0\n      },\n      departmentData: [], // 部门树列表\n      departmentProps: { children: 'children', label: 'name' },\n      showDepartment: false, // 添加、修改部门界面\n      addDepartmentForm: { name: '', oldName: '' },\n      addDepartmentRules: { name: [{ required: true, message: '请输入部门名称', trigger: 'blur' }] },\n      addDepartmentType: 0, // 0添加部门 1修改部门\n      selectDepartmentNode: null, // 当前选中的部门\n      userSearchType: 0, // 0是公司  1是部门\n      userLoading: false, // 用户列表Loading\n      userList: [], // 用户列表\n      showUser: false, // 添加、修改用户界面\n      addUserType: 0, // 0添加用户 1修改用户\n      addUserInfo: { // 用户Form\n        uid: 0,\n        type: 0,\n        cpid: '',\n        deptId: '',\n        cusName: '',\n        phone: '',\n        postName: '',\n        cusPassword: '',\n        cusPic: ''\n      },\n      showUserRole: false, // 添加、修改角色界面\n      userRoleForm: { // 角色Form\n        id: 0,\n        index: -1,\n        showName: '',\n        roleId: 0\n      },\n      roleLoading: false, // 角色列表Loading\n      roleList: [], // 角色列表\n      showRole: false, // 添加、修改角色\n      addRoleId: 0, // 当前需要修改的角色ID\n      addRoleType: 0, // 0添加角色 1修改角色\n      addRoleName: '', // 角色名称\n      authStatus: 0, // 授权按钮状态\n      authBtnText: '编辑', // 授权按钮文字\n      authBtnStatus: true, // 授权按钮状态\n      authLoading: false, // 授权按钮Loading\n      reviewLoading: false // 审批按钮Loading\n    }\n  },\n  mounted() {\n    this.init()\n    this.initDDData()\n  },\n  methods: {\n    init() {\n      get('/company/tree', null).then(response => { // 加载所有公司树\n        if (response.status === 0) {\n          this.companyData = response.data\n        }\n      })\n\n      get('/license/auditors', null).then(response => { // 获取审批人员列表\n        if (response.status === 0) {\n          const reviewUser = response.data.filter(item => {\n            return item.auditorId === this.$store.state.user.uid && item.auditorLevel > 0\n          })\n          if (reviewUser.length > 0) {\n            this.reviewUser = reviewUser[0]\n          }\n        }\n      })\n    },\n    initDDData() { // 初始化公司性质、类型下拉菜单\n      get('/company/const', null).then(response => {\n        if (response.status === 0) {\n          this.natureList = response.data.natures\n          this.typeList = response.data.types\n          this.addCompanyForm.nature = this.natureList[1].name\n          this.addCompanyForm.natureId = this.natureList[1].val\n          this.addCompanyForm.type = this.typeList[0].name\n          this.addCompanyForm.typeId = this.typeList[0].val\n        }\n      })\n    },\n    reviewDic: function(status, type) { // 审批状态格式化\n      let dic = ''\n      let result = ''\n      switch (type) {\n        case 1:\n          result = this.reviewCompanyContent.firstResult === 1 ? '通过' : '不通过'\n          break\n        case 2:\n          result = this.reviewCompanyContent.secondResult === 1 ? '通过' : '不通过'\n          break\n        case 3:\n          result = this.reviewCompanyContent.thirdResult === 1 ? '通过' : '不通过'\n          break\n        default:\n          break\n      }\n      if (status > 0) {\n        dic = '审批:' + result\n      } else if (status < 0) {\n        dic = '反审:' + result\n      } else {\n        dic = '待审核'\n      }\n      return dic\n    },\n    getReviewClass: function(status) { // 审批状态样式\n      let className = ''\n      if (status <= 0) {\n        className = (status === 0 ? 'review-pending' : 'review-return')\n      }\n      return className\n    },\n    getReviewDisable: function(type) { // 获取审批按钮状态\n      let d = false\n      switch (type) {\n        case 1:\n          if (this.reviewCompanyStatus.secondAuditstatus === 1 && this.reviewCompanyContent.secondResult === 1) {\n            d = true\n          }\n          break\n        case 2:\n          if (this.reviewCompanyContent.firstResult !== 1 || this.reviewCompanyStatus.thirdAuditstatus === 1 && this.reviewCompanyContent.thirdResult === 1) {\n            d = true\n          }\n          break\n        case 3:\n          if (this.reviewCompanyContent.secondResult !== 1) {\n            d = true\n          }\n          break\n        default:\n          break\n      }\n      return d\n    },\n    addCompany: function(type) { // 增加公司type 0 总公司 1子公司 只有galasys可以加子公司\n      this.addCompanyType = type\n      this.showAddCompany = true\n    },\n    deleteCompany: function() { // 删除公司\n      if (this.selectCompanyNode === null) {\n        this.$message({\n          message: '请选择需要删除的公司',\n          type: 'warning',\n          duration: 3000\n        })\n      } else {\n        this.$confirm('是否删除公司\"' + this.selectCompanyNode.companyName + '\"', '提示', {\n          confirmButtonText: '确定',\n          cancelButtonText: '取消',\n          type: 'warning'\n        }).then(() => {\n          byDelete('/company/' + this.selectCompanyNode.companyId, null).then(response => {\n            if (response.status === 0) {\n              this.$refs.companyTree.remove(this.selectCompanyNode)\n              this.selectCompanyId = 0\n              this.companyForm.btnName = '编辑'\n              this.companyForm.status = 0\n              this.companyForm.companyId = 0\n              this.companyForm.name = ''\n              this.companyForm.principal = ''\n              this.companyForm.nature = ''\n              this.companyForm.natureId = 0\n              this.companyForm.mobile = ''\n              this.companyForm.type = ''\n              this.companyForm.typeId = 0\n              this.companyForm.email = ''\n              this.companyForm.licenseId = 0\n              this.companyForm.date = ['', '']\n              this.selectCompanyNode = null\n              this.selectDepartmentNode = null\n              this.userList = []\n              this.roleList = []\n              this.$message({\n                message: '公司删除成功',\n                type: 'success',\n                duration: 3000\n              })\n            } else {\n              this.$message({\n                message: response.msg,\n                type: 'warning',\n                duration: 3000\n              })\n            }\n          })\n        }).catch(() => {\n\n        })\n      }\n    },\n    getRootNode: function(node) { // 获取根节点\n      if (node.level === 1) {\n        return node.data\n      } else {\n        return this.getRootNode(node.parent)\n      }\n    },\n    companyClick: function(node, all) { // 公司树点击事件\n      this.selectCompanyNode = node\n      if (node.companyId === 12) {\n        this.companyDelBtn = false\n        this.isGalasys = true\n        this.showCompanyInfo(node)\n      } else if (this.getRootNode(all).companyId === 12) {\n        this.isGalasys = true\n        this.companyDelBtn = true\n        this.showCompanyInfo(node)\n      } else if (node.pid > 0) {\n        this.isGalasys = false\n        this.companyDelBtn = false\n        this.showCompanyInfo(this.getRootNode(all))\n      } else {\n        this.isGalasys = false\n        this.companyDelBtn = true\n        this.showCompanyInfo(node)\n      }\n    },\n    showCompanyInfo: function(data) { // 显示公司信息\n      this.selectCompanyId = data.companyId\n      this.selectLicenseId = data.licenseId\n      this.companyForm.companyId = data.companyId\n      this.companyForm.name = data.companyName\n      this.companyForm.principal = data.master\n      this.companyForm.natureId = data.companyNature\n      this.companyForm.nature = this.natureList.filter(function(item) {\n        if (item.val === data.companyNature) {\n          return item\n        }\n      })[0].name\n      this.companyForm.mobile = data.phone\n      this.companyForm.typeId = data.companyType\n      this.companyForm.type = this.typeList.filter(function(item) {\n        if (item.val === data.companyType) {\n          return item\n        }\n      })[0].name\n      this.companyForm.email = data.email\n      this.companyForm.licenseId = data.licenseId\n      this.companyForm.date = [data.sysLicense.licenseStart.split(' ')[0], data.sysLicense.licenseEnd.split(' ')[0]]\n      this.reviewCompanyStatus = data.sysLicense\n      console.log(data.sysLicense)\n      if (data.companyId === 12) {\n        this.authBtnStatus = false\n      } else if (data.sysLicense.firstAuditstatus === 1 || data.sysLicense.secondAuditstatus === 1 || data.sysLicense.thirdAuditstatus === 1) {\n        this.authBtnStatus = true\n      } else {\n        this.authBtnStatus = false\n      }\n      this.getDepartmentInfo(data.companyId)\n      this.getRoleInfo(data.companyId)\n      this.userSearchType = 0\n      this.getUserInfoByCompany(data.companyId)\n      this.getCompanyStatus(data.licenseId)\n    },\n    getCompanyStatus(lid) { // 获取公司审核信息\n      get('/license/message/' + lid, null).then(response => {\n        if (response.status === 0) {\n          response.data.forEach(item => {\n            if (item !== null) {\n              switch (Math.abs(item.auditorLevel)) {\n                case 1:\n                  this.reviewCompanyContent.first = item.auditMsg\n                  this.reviewCompanyContent.firstResult = item.auditResult\n                  break\n                case 2:\n                  this.reviewCompanyContent.second = item.auditMsg\n                  this.reviewCompanyContent.secondResult = item.auditResult\n                  break\n                case 3:\n                  this.reviewCompanyContent.third = item.auditMsg\n                  this.reviewCompanyContent.thirdResult = item.auditResult\n                  break\n                default:\n                  break\n              }\n            }\n          })\n        }\n      })\n    },\n    handleDD: function(type, data) { // 公司树列表点击事件\n      switch (type) {\n        case 1:\n          this.companyForm.nature = data.name\n          this.companyForm.natureId = data.val\n          break\n        case 2:\n          this.companyForm.type = data.name\n          this.companyForm.typeId = data.val\n          break\n        case 3:\n          this.addCompanyForm.nature = data.name\n          this.addCompanyForm.natureId = data.val\n          break\n        case 4:\n          this.addCompanyForm.type = data.name\n          this.addCompanyForm.typeId = data.val\n          break\n        default:\n          break\n      }\n    },\n    submitCompany: function() { // 添加公司\n      var that = this\n      this.$refs.addCompanyForm.validate((valid) => {\n        if (valid) {\n          var company = {\n            pid: this.addCompanyType === 0 ? 0 : this.selectCompanyNode.companyId,\n            companyName: this.addCompanyForm.name,\n            companyNature: this.addCompanyForm.natureId,\n            companyType: this.addCompanyForm.typeId,\n            email: this.addCompanyForm.email,\n            master: this.addCompanyForm.principal,\n            phone: this.addCompanyForm.mobile,\n            sysLicense: {\n              licenseStart: parseTime(this.addCompanyForm.date[0], '{y}-{m}-{d} 00:00:00'),\n              licenseEnd: parseTime(this.addCompanyForm.date[1], '{y}-{m}-{d} 23:59:59')\n            }\n          }\n          this.addCompanyLoading = true\n          post('/company', company).then(response => {\n            if (response.status === 0) {\n              this.addCompanyLoading = false\n              this.$refs.companyTree.append(response.data, response.data.pid)\n              this.$message({\n                message: '公司添加成功',\n                type: 'success',\n                duration: 3000\n              })\n            } else {\n              this.$message({\n                message: response.msg,\n                type: 'warning',\n                duration: 3000\n              })\n            }\n            that.cancelCompany()\n          })\n        } else {\n          return\n        }\n      })\n    },\n    cancelCompany: function() { // 取消添加公司\n      this.showAddCompany = false\n      var newDate = new Date() // 时间控件初始化\n      this.addCompanyForm.date = [newDate.getFullYear() + '-' + (newDate.getMonth() + 1) + '-' + newDate.getDate(),\n        (newDate.getFullYear() + 1) + '-' + (newDate.getMonth() + 1) + '-' + newDate.getDate()\n      ]\n      this.$refs.addCompanyForm.resetFields()\n    },\n    editCompanyInfo: function() { // 编辑公司\n      if (this.companyForm.companyId <= 0) {\n        this.$message({\n          message: '请选择需要编辑的公司',\n          type: 'warning',\n          duration: 3000\n        })\n        return\n      }\n\n      if (this.companyForm.status === 0) {\n        this.companyForm.btnName = '保存'\n        this.companyForm.status = 1\n      } else {\n        var errMsg = ''\n        if (this.companyForm.name === '') {\n          errMsg = '请输入公司名称'\n        } else if (this.companyForm.principal === '') {\n          errMsg = '请输入负责人'\n        } else if (this.companyForm.mobile === '') {\n          errMsg = '请输入手机号'\n        } else if (!validMobile(this.companyForm.mobile)) {\n          errMsg = '手机号格式输入不正确'\n        } else if (this.companyForm.email === '') {\n          errMsg = '请输入邮箱'\n        } else if (!validEmail(this.companyForm.email)) {\n          errMsg = '邮箱格式输入不正确'\n        }\n\n        if (errMsg === '') {\n          var company = {\n            companyId: this.companyForm.companyId,\n            companyName: this.companyForm.name,\n            companyNature: this.companyForm.natureId,\n            companyType: this.companyForm.typeId,\n            email: this.companyForm.email,\n            master: this.companyForm.principal,\n            phone: this.companyForm.mobile,\n            licenseId: this.companyForm.licenseId,\n            sysLicense: {\n              licenseStart: parseTime(this.companyForm.date[0], '{y}-{m}-{d}'),\n              licenseEnd: parseTime(this.companyForm.date[1], '{y}-{m}-{d}')\n            }\n          }\n          put('/company', company).then(response => {\n            if (response.status === 0) {\n              this.$message({\n                message: '公司编辑成功',\n                type: 'success',\n                duration: 3000\n              })\n              this.companyData = response.data\n              this.companyForm.btnName = '编辑'\n              this.companyForm.status = 0\n            } else {\n              this.$message({\n                message: response.msg,\n                type: 'warning',\n                duration: 3000\n              })\n            }\n          })\n        } else {\n          this.$message({\n            message: errMsg,\n            type: 'warning',\n            duration: 3000\n          })\n        }\n      }\n    },\n    getDepartmentInfo: function(companyId) { // 获取部门树列表\n      get('/dept/list/' + companyId, null).then(response => {\n        if (response.status === 0) {\n          this.departmentData = response.data\n        }\n      })\n    },\n    departmentClick: function(node) { // 部门树列表点击事件\n      this.selectDepartmentNode = node\n      this.addDepartmentForm.oldName = node.name\n      this.userSearchType = 1\n      this.getUserInfoByDepartment(node.id)\n    },\n    addDepartment: function(type) { // 显示添加、修改部门界面\n      if (this.selectCompanyNode === null) {\n        this.$message({\n          message: '请选择需要添加部门的公司',\n          type: 'warning',\n          duration: 3000\n        })\n      } else {\n        this.addDepartmentType = type\n        this.showDepartment = true\n      }\n    },\n    deleteDepartment: function() { // 删除部门\n      if (this.selectDepartmentNode === null) {\n        this.$message({\n          message: '请选择需要删除的部门',\n          type: 'warning',\n          duration: 3000\n        })\n      } else {\n        this.$confirm('是否删除部门\"' + this.selectDepartmentNode.name + '\"', '提示', {\n          confirmButtonText: '确定',\n          cancelButtonText: '取消',\n          type: 'warning'\n        }).then(() => {\n          byDelete('/dept/' + this.selectDepartmentNode.id, null).then(response => {\n            if (response.status === 0) {\n              this.$refs.departmentTree.remove(this.selectDepartmentNode)\n              this.selectDepartmentNode = null\n              this.$message({\n                message: '部门删除成功',\n                type: 'success',\n                duration: 3000\n              })\n            } else {\n              this.$message({\n                message: response.msg,\n                type: 'warning',\n                duration: 3000\n              })\n            }\n          })\n        }).catch(() => {\n\n        })\n      }\n    },\n    submitDepartment: function() { // 添加、修改部门\n      var that = this\n      this.$refs.addDepartmentForm.validate((valid) => {\n        if (valid) {\n          var department = {\n            id: null,\n            cpid: null,\n            name: this.addDepartmentForm.name\n          }\n          if (this.addDepartmentType === 0) {\n            department.cpid = this.selectCompanyNode.companyId\n            post('/dept', department).then(response => {\n              if (response.status === 0) {\n                this.$message({\n                  message: '部门添加成功',\n                  type: 'success',\n                  duration: 3000\n                })\n                this.$refs.departmentTree.append(response.data, 0)\n              } else {\n                this.$message({\n                  message: response.msg,\n                  type: 'warning',\n                  duration: 3000\n                })\n              }\n              that.cancelDepartment()\n            })\n          } else {\n            put('/dept/' + this.selectDepartmentNode.id + '/' + this.selectCompanyNode.companyId + '/' + this.addDepartmentForm.name, null).then(response => {\n              if (response.status === 0) {\n                this.departmentData = response.data\n                this.$message({\n                  message: '部门修改成功',\n                  type: 'success',\n                  duration: 3000\n                })\n              } else {\n                this.$message({\n                  message: response.msg,\n                  type: 'warning',\n                  duration: 3000\n                })\n              }\n              that.cancelDepartment()\n            })\n          }\n        } else {\n          return\n        }\n      })\n    },\n    cancelDepartment: function() { // 取消添加、修改部门\n      this.showDepartment = false\n      this.$refs.addDepartmentForm.resetFields()\n    },\n    getRoleInfo: function(companyId) { // 获取角色列表\n      this.roleLoading = true\n      get('/role/list/' + companyId, null).then(response => {\n        this.roleLoading = false\n        if (response.status === 0) {\n          this.roleList = response.data\n        }\n      })\n    },\n    addUser: function(type) { // 显示添加用户界面\n      if (this.selectDepartmentNode === null) {\n        this.$message({\n          message: '请选择需要添加用户的部门',\n          type: 'warning',\n          duration: 3000\n        })\n      } else {\n        this.addUserInfo.cpid = this.selectCompanyNode.companyId\n        this.addUserInfo.deptId = this.selectDepartmentNode.id\n        this.addUserInfo.userId = 0\n        this.addUserInfo.cusName = ''\n        this.addUserInfo.phone = ''\n        this.addUserInfo.postName = ''\n        this.addUserInfo.cusPic = ''\n        this.addUserInfo.type = type\n        this.addUserType = type\n        this.showUser = true\n      }\n    },\n    updateUser: function(user) { // 显示修改用户界面\n      this.addUserInfo.cpid = user.row.cpid\n      this.addUserInfo.deptId = user.row.deptId\n      this.addUserInfo.userId = user.row.userId\n      this.addUserInfo.cusName = user.row.cusName\n      this.addUserInfo.phone = user.row.phone\n      this.addUserInfo.postName = user.row.postName\n      this.addUserInfo.cusPic = user.row.cusPic\n      this.addUserInfo.type = 1\n      this.addUserType = 1\n      this.showUser = true\n    },\n    handleRoleDD: function(data) { // 角色下拉菜单\n      this.userRoleForm.showName = data.showName\n      this.userRoleForm.roleId = data.id\n    },\n    cancelUserRole: function() { // 修改角色取消\n      this.userRoleForm.id = 0\n      this.userRoleForm.index = -1\n      this.userRoleForm.showName = ''\n      this.userRoleForm.roleId = 0\n      this.showUserRole = false\n    },\n    updateUserRole: function(user) { // 显示修改用户角色界面\n      this.userRoleForm.id = user.row.userId\n      this.userRoleForm.index = user.$index\n      this.userRoleForm.showName = user.row.roleList.length > 0 ? user.row.roleList[0].showName : ''\n      this.showUserRole = true\n    },\n    submitUserRole: function() { // 修改用户角色\n      if (this.userRoleForm.roleId <= 0) {\n        this.$message({\n          message: '请选择角色',\n          type: 'warning',\n          duration: 3000\n        })\n      } else {\n        put('/user/' + this.userRoleForm.id + '/' + this.userRoleForm.roleId, null).then(response => {\n          if (response.status === 0) {\n            if (this.userList[this.userRoleForm.index].roleList.length > 0) {\n              this.userList[this.userRoleForm.index].roleList[0].showName = this.userRoleForm.showName\n            } else {\n              this.userList[this.userRoleForm.index].roleList.push({\n                id: this.userRoleForm.roleId,\n                showName: this.userRoleForm.showName\n              })\n            }\n            this.$message({\n              message: '用户角色修改成功',\n              type: 'success',\n              duration: 3000\n            })\n          } else {\n            this.$message({\n              message: response.msg,\n              type: 'warning',\n              duration: 3000\n            })\n          }\n          this.showUserRole = false\n        })\n      }\n    },\n    deleteUserById: function(user) { // 删除用户\n      this.$confirm('确定删除用户\"' + user.row.cusName + '\"吗？', '提示', {\n        confirmButtonText: '确定',\n        cancelButtonText: '取消',\n        type: 'warning'\n      }).then(() => {\n        byDelete('/user/' + user.row.userId, null).then(response => {\n          if (response.status === 0) {\n            this.$message({\n              message: '用户\"' + user.row.cusName + '\"删除成功',\n              type: 'success',\n              duration: 3000\n            })\n            this.userList.splice(user.$index)\n          } else {\n            this.$message({\n              message: response.msg,\n              type: 'warning',\n              duration: 3000\n            })\n          }\n        })\n      })\n    },\n    submitUser: function() { // 添加、修改用户后获取用户列表\n      this.showUser = false\n      if (this.userSearchType === 0) { // 公司\n        this.getUserInfoByCompany(this.selectCompanyId)\n      } else {\n        this.getUserInfoByDepartment(this.selectDepartmentNode.id)\n      }\n    },\n    getUserInfoByCompany: function(companyId) { // 根据公司获取用户列表\n      this.userLoading = true\n      get('/user/list/cp' + companyId, null).then(response => {\n        this.userLoading = false\n        if (response.status === 0) {\n          this.userList = response.data\n        }\n      })\n    },\n    getUserInfoByDepartment: function(departmentId) { // 根据部门获取用户列表\n      this.userLoading = true\n      get('/user/list/dp' + departmentId, null).then(response => {\n        this.userLoading = false\n        if (response.status === 0) {\n          this.userList = response.data\n        }\n      })\n    },\n    addRole() { // 显示添加角色界面\n      if (this.selectCompanyNode === null) {\n        this.$message({\n          message: '请选择需要添加角色的公司',\n          type: 'warning',\n          duration: 3000\n        })\n      } else {\n        this.addRoleType = 0\n        this.addRoleId = 0\n        this.addRoleName = ''\n        this.showRole = true\n      }\n    },\n    updateRole(data) { // 显示修改角色界面\n      this.addRoleType = 1\n      this.addRoleId = data.id\n      this.addRoleName = data.showName\n      this.showRole = true\n    },\n    deleteRole(data) { // 删除角色\n      this.$confirm('确定删除角色\"' + data.showName + '\"吗？', '提示', {\n        confirmButtonText: '确定',\n        cancelButtonText: '取消',\n        type: 'warning'\n      }).then(() => {\n        post('/role/del/' + data.id, null).then(response => {\n          if (response.status === 0) {\n            this.getRoleInfo(this.selectCompanyId)\n            this.$message({\n              message: '角色\"' + data.showName + '\"删除成功',\n              type: 'success',\n              duration: 3000\n            })\n          } else {\n            this.$message({\n              message: response.msg,\n              type: 'warning',\n              duration: 3000\n            })\n          }\n        })\n      })\n    },\n    submitRole() { // 添加、修改角色后加载角色列表\n      this.showRole = false\n      this.getRoleInfo(this.selectCompanyId)\n    },\n    authEdit: function() { // 授权\n      if (this.authStatus === 0) {\n        this.authStatus = 1\n        this.authBtnText = '保存'\n      } else {\n        this.authStatus = 0\n        this.authBtnText = '编辑'\n        this.authLoading = true\n        this.$refs.treeTransfer.saveAuth()\n      }\n    },\n    review: function() { // 显示审批界面\n      this.reviewType = 0\n      this.reviewStatus = '通过'\n      this.showReview = true\n    },\n    antiReview: function() { // 显示反审界面\n      this.reviewType = 1\n      this.reviewStatus = '通过'\n      this.showReview = true\n    },\n    cancelReview: function() { // 取消审批\n      this.reviewText = ''\n      this.showReview = false\n    },\n    submitReview: function() { // 提交审批\n      if (this.selectCompanyId !== 12) {\n        const data = {\n          'licenseId': this.selectLicenseId,\n          'auditorId': this.$store.state.user.uid,\n          'auditorName': this.reviewUser.auditorName,\n          'auditorEmail': this.reviewUser.auditorEmail,\n          'auditMsg': this.reviewText, // 审核意见\n          'auditResult': this.reviewStatus === '通过' ? 1 : 0, // 审核是否通过 1=通过 0=不通过\n          'auditorLevel': this.reviewUser.auditorLevel * (this.reviewType === 0 ? 1 : -1) // 审核级别 1=一审 2=二审 3=三审 -1=一级反审 -2=二级反审 -3=三级反审\n        }\n        this.reviewLoading = true\n        post('/license/audit', data).then(response => {\n          this.reviewLoading = false\n          if (response.status === 0) {\n            const companyLen = this.companyData.length\n            for (var i = 0; i < companyLen; i++) {\n              if (this.companyData[i].companyId === this.selectCompanyId) {\n                switch (this.reviewUser.auditorLevel) {\n                  case 1:\n                    this.reviewCompanyContent.first = this.reviewText\n                    this.reviewCompanyContent.firstResult = data.auditResult\n                    this.companyData[i].sysLicense.firstAuditstatus = this.reviewType === 0 ? 1 : -1\n                    break\n                  case 2:\n                    this.reviewCompanyContent.second = this.reviewText\n                    this.reviewCompanyContent.secondResult = data.auditResult\n                    this.companyData[i].sysLicense.secondAuditstatus = this.reviewType === 0 ? 1 : -1\n                    break\n                  case 3:\n                    this.reviewCompanyContent.third = this.reviewText\n                    this.reviewCompanyContent.thirdResult = data.auditResult\n                    this.companyData[i].sysLicense.thirdAuditstatus = this.reviewType === 0 ? 1 : -1\n                    break\n                  default:\n                    break\n                }\n              }\n            }\n            this.$message({\n              message: (this.reviewType === 0 ? '审批' : '反审') + '成功',\n              type: 'success',\n              duration: 3000\n            })\n          } else {\n            this.$message({\n              message: response.msg,\n              type: 'warning',\n              duration: 3000\n            })\n          }\n          this.cancelReview()\n        })\n      }\n    }\n  }\n}\n",null]}