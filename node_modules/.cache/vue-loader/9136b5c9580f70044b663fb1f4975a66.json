{"remainingRequest":"D:\\办公\\projectwc\\前端\\ManageSys\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\办公\\projectwc\\前端\\ManageSys\\src\\views\\reservation\\index.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\办公\\projectwc\\前端\\ManageSys\\src\\views\\reservation\\index.vue","mtime":1577685053978},{"path":"D:\\办公\\projectwc\\前端\\ManageSys\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\办公\\projectwc\\前端\\ManageSys\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"D:\\办公\\projectwc\\前端\\ManageSys\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\办公\\projectwc\\前端\\ManageSys\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\r\n/* eslint-disable */\r\nimport echarts from 'echarts'\r\nimport { get } from '@/api/axios'\r\nexport default {\r\n /* eslint-disable */\r\n  name: 'reservation',\r\n  data() {\r\n    return {\r\n    //tab按钮\r\n      tab: [\"门票\",\"酒店\"],\r\n      titles:'门票',\r\n      default_bar: 0,//默认第一个tab \r\n      nextmonthIncome: '', // 下月金额\r\n      nextmonthSame: '', // 同比\r\n      nextmonthDis: '', // 环比\r\n      nextweekIncome: '', // 下周金额\r\n      nextweekSame: '', // 同比\r\n      nextweekDis: '', // 环比\r\n      data_hotel: null,\r\n      data_tickets: null,\r\n      days: [],\r\n      nowdays: [],\r\n      data1: [],\r\n      data2: [],\r\n      data3: [],\r\n      data4: [],\r\n      right1: [],\r\n      right2: [],\r\n      right3: [],\r\n      right4: [],\r\n    }\r\n  },\r\n  mounted() {\r\n    // 下个月\r\n    var day = this.getNowFormatDate()\r\n    var days = [],\r\n    nowdays = [],\r\n    data1 = [],\r\n    data2= [],\r\n    data3 =[],\r\n    data4 = []\r\n    for (var i =1; i<= day;i++) {\r\n      days.push(i)\r\n      data1.push(0)\r\n      data2.push(0)\r\n      data3.push(0)\r\n      data4.push(0)\r\n    }\r\n    this.days = days\r\n    this.data1 = data1\r\n    this.data2 = data2\r\n    this.data3 = data3\r\n    this.data4 = data4\r\n    // 这个月\r\n    var nowday = this.GetDate()\r\n    var nowdays = []\r\n    var right1 = [],\r\n    right2 = [],\r\n    right3 = [],\r\n    right4 = []\r\n    for (var i = 1; i<= nowday;i++) {\r\n      nowdays.push(i)\r\n      right1.push(0)\r\n      right2.push(0)\r\n      right3.push(0)\r\n      right4.push(0)\r\n    }\r\n    this.nowdays = nowdays\r\n    this.right1 = right1\r\n    this.right2 = right2\r\n    this.right3 = right3\r\n    this.right4 = right4\r\n    this.TabClick(0)\r\n  },\r\n  // beforeDestroy() {\r\n  //   window.removeEventListener('resize', this.resizeHandler)\r\n  // },\r\n  methods: {\r\n    TabClick(index){\r\n      this.default_bar = index\r\n      var that = this\r\n      if(index === 0){\r\n        // 门票\r\n        this.titles=\"门票\"\r\n        that.ticks()\r\n      }else if(index === 1){\r\n        // 酒店\r\n        this.titles = \"酒店\"\r\n        that.hotes()\r\n      }\r\n    },\r\n    ticks() { // 门票\r\n      var that = this\r\n      this.$nextTick(() => {\r\n        get('income/findTicketList').then(data => {\r\n          if (data.msg === \"SUCCESS\") {\r\n            this.data_tickets = data.data\r\n            // 初始化各图数据\r\n            var sourceMap = this.data_tickets.sourceMap\r\n            var legend = [], series_line = [],\r\n            series1 = [], series2 = []\r\n            for (var i = 0 ; i< sourceMap.length; i++) {\r\n              legend.push(sourceMap[i].sourceName);\r\n              series1.push({'value': 0, 'name':sourceMap[i].sourceName});\r\n              series2.push({'value': 0, 'name':sourceMap[i].sourceName});\r\n              series_line.push( {'name': sourceMap[i].sourceName,'type':'line','data':sourceMap[i].sourceName})\r\n            }\r\n            var data = this.data_tickets.list\r\n            // 右上角环状图\r\n            var top_right_series = series1, top_right_legend = legend\r\n            // 左下角折线图\r\n            var left_series = series_line,\r\n            left_legend = legend,\r\n            left_datax = that.days\r\n            left_legend = legend\r\n            var data_sum = [], data_1 = that.data1, data_2 = that.data2, data_3 = that.data3, data_4 =that.data4\r\n            // 右下角环状图\r\n            var right_series = series2, right_legend = legend\r\n            for (var i = 0 ; i < data.length; i++) {\r\n              if (data[i]) {\r\n                if (data[i].dateYear == 8) {\r\n                  that.nextmonthIncome = data[i].nextmonthIncome ? data[i].nextmonthIncome : 0\r\n                  that.nextmonthSame = data[i].nextmonthSame ? data[i].nextmonthSame : 0\r\n                  that.nextmonthDis = data[i].nextmonthDis ? data[i].nextmonthDis : 0\r\n                  that.nextweekIncome = data[i].nextweekIncome ? data[i].nextweekIncome : 0\r\n                  that.nextweekSame = data[i].nextweekSame ? data[i].nextweekSame : 0\r\n                  that.nextweekDis = data[i].nextweekDis ? data[i].nextweekDis : 0\r\n                } else if (data[i].dateYear == 11) {\r\n                  //top_right_legend.push(data[i].sourceName)\r\n                  for (var a = 0; a< right_series.length; a++) {\r\n                    if (right_series[a].name === data[i].sourceName) {\r\n                      right_series[a].value = data[i].price\r\n                    }\r\n                  }\r\n                } else if (data[i].dateYear == 9 && data[i].sourceId == 1) {\r\n                  // left_datax.push(data[i].date.split(' ')[0].split('-')[2])\r\n                  for (var a = 0; a< that.days.length; a++) {\r\n                    if (parseInt(data[i].date.split(' ')[0].split('-')[2]) === parseInt(that.days[a])) {\r\n                      data_1[a] = data[i].price\r\n                    }\r\n                  }\r\n                } else if (data[i].dateYear == 9 && data[i].sourceId == 2) {\r\n                  for (var a = 0; a< that.days.length; a++) {\r\n                    if (parseInt(data[i].date.split(' ')[0].split('-')[2]) === parseInt(that.days[a])) {\r\n                      data_2[a] = data[i].price\r\n                    }\r\n                  }\r\n                } else if (data[i].dateYear == 9 && data[i].sourceId == 3) {\r\n                  for (var a = 0; a< that.days.length; a++) {\r\n                    if (parseInt(data[i].date.split(' ')[0].split('-')[2]) === parseInt(that.days[a])) {\r\n                      data_3[a] = data[i].price\r\n                    }\r\n                  }\r\n                } else if (data[i].dateYear == 9 && data[i].sourceId == 4) {\r\n                  for (var a = 0; a< that.days.length; a++) {\r\n                    if (parseInt(data[i].date.split(' ')[0].split('-')[2]) === parseInt(that.days[a])) {\r\n                      data_4[a] = data[i].price\r\n                    }\r\n                  }\r\n                }else if (data[i].dateYear == 10) {\r\n                  for (var a = 0; a< top_right_series.length; a++) {\r\n                    if (top_right_series[a].name === data[i].sourceName) {\r\n                      top_right_series[a].value = data[i].price\r\n                    }\r\n                  }\r\n                }\r\n              }\r\n            }\r\n            data_sum = [data_1, data_2, data_3, data_4] // 左下折线图 datax\r\n            for (var i = 0; i< left_series.length; i++) {\r\n              left_series[i].data = data_sum[i]\r\n            }\r\n            console.log(right_series)\r\n            that.EchartsRing(top_right_legend, top_right_series,'echartsbox')\r\n            that.FutureLine_trend(left_legend, left_series, left_datax,'futuretend', '金额',{star: '', end:'日门票预定金额:'})\r\n            that.EchartsRing(right_legend, right_series,'futuremoney')\r\n          }\r\n        })\r\n      })\r\n    },\r\n    hotes() { // 酒店\r\n      var that = this\r\n      this.$nextTick(() => {\r\n        get('income/findHotelList').then(data => {\r\n          if (data.msg === \"SUCCESS\") {\r\n            that.data_hotel = data.data\r\n            var sourceMap = that.data_hotel.hotelMap\r\n            // console.log('输出')\r\n            // console.log(sourceMap)\r\n            // 初始化各图数据\r\n            var legend = [], series = [], seriesL = [],seriesR = []\r\n            for (let a = 0; a < sourceMap.length; a++) {\r\n              legend.push(sourceMap[a].hotelName)\r\n              series.push({'value': 0, 'name':sourceMap[a].hotelName})\r\n              seriesL.push({'name': sourceMap[a].hotelName, 'type':'line', 'data': null})\r\n              seriesR.push({'name': sourceMap[a].hotelName, 'type':'line', 'data': null})\r\n            }\r\n            var data = this.data_hotel.list\r\n            // 下周酒店金额占比-环状图\r\n            var top_right_series = series,\r\n            top_right_legend = legend\r\n            // 未来一个月酒店预订-- 多折线图\r\n            var data_left = [],\r\n            left_1 = that.data1,\r\n            left_2 = that.data2,\r\n            left_3 = that.data3,\r\n            left_4 = that.data4,\r\n            // var left_series = leftall,\r\n            left_legend = legend,\r\n            left_datax = that.days\r\n            // 本月酒店入住-- 多折线图\r\n            var data_right = [],\r\n            right_1 = that.right1,\r\n            right_2 = that.right2,\r\n            right_3 = that.right3,\r\n            right_4 = that.right4,\r\n            //var right_series = seriesdata,\r\n            right_legend = legend,\r\n            right_datax = that.nowdays\r\n            for (var i = 0 ; i < data.length; i++) {\r\n              if (data[i].dateYear === 8) {\r\n                that.nextmonthIncome = data[i].nextmonthIncome ? data[i].nextmonthIncome : 0\r\n                that.nextmonthSame = data[i].nextmonthSame ? data[i].nextmonthSame : 0\r\n                that.nextmonthDis = data[i].nextmonthDis ? data[i].nextmonthDis : 0\r\n                that.nextweekIncome = data[i].nextweekIncome ? data[i].nextweekIncome : 0\r\n                that.nextweekSame = data[i].nextweekSame ? data[i].nextweekSame : 0\r\n                that.nextweekDis = data[i].nextweekDis ? data[i].nextweekDis : 0\r\n              } else if (data[i].dateYear === 11) {\r\n                for (var p = 0; p< top_right_series.length; p++) {\r\n                  if (top_right_series[p].name == data[i].hotelName) {\r\n                    top_right_series[p].value = data[i].price\r\n                  }\r\n                }\r\n                //top_right_series.push({'value':data[i].price, 'name':data[i].hotelName})\r\n              } else if (data[i].dateYear === 9) {\r\n                //left_datax.push(data[i].date.split(' ')[0].split('-')[2])\r\n                if (data[i].sourceId === 1) {\r\n                  for (var a = 0; a< that.days.length; a++) {\r\n                    if (parseInt(data[i].date.split(' ')[0].split('-')[2]) == parseInt(that.days[a])) {\r\n                      left_1[a] = data[i].price\r\n                    }\r\n                  }\r\n                } else if (data[i].sourceId === 2) {\r\n                  for (var a = 0; a< that.days.length; a++) {\r\n                    if (parseInt(data[i].date.split(' ')[0].split('-')[2]) == parseInt(that.days[a])) {\r\n                      left_2[a] = data[i].price\r\n                    }\r\n                  }\r\n                } else if (data[i].sourceId === 3) {\r\n                  for (var a = 0; a< that.days.length; a++) {\r\n                    if (parseInt(data[i].date.split(' ')[0].split('-')[2]) == parseInt(that.days[a])) {\r\n                      left_3[a] = data[i].price\r\n                    }\r\n                  }\r\n                } else if ( data[i].sourceId === 4) {\r\n                  for (var a = 0; a< that.days.length; a++) {\r\n                    if (parseInt(data[i].date.split(' ')[0].split('-')[2]) == parseInt(that.days[a])) {\r\n                      left_4[a] = data[i].price\r\n                    }\r\n                  }\r\n                }\r\n                //left_1.push(data[i].price)\r\n              } else if (data[i].dateYear === 1 ) {\r\n                if (data[i].hotelId === 1) {\r\n                  for (var a = 0; a< that.nowdays.length; a++) {\r\n                    if (parseInt(data[i].date.split(' ')[0].split('-')[2]) == parseInt(that.days[a])) {\r\n                      right_1[a] = data[i].price\r\n                    }\r\n                  }\r\n                } else if (data[i].hotelId === 2) {\r\n                  for (var a = 0; a< that.nowdays.length; a++) {\r\n                    if (parseInt(data[i].date.split(' ')[0].split('-')[2]) == parseInt(that.days[a])) {\r\n                      right_2[a] = data[i].price\r\n                    }\r\n                  }\r\n                } else if (data[i].hotelId === 3) {\r\n                  for (var a = 0; a< that.nowdays.length; a++) {\r\n                    if (parseInt(data[i].date.split(' ')[0].split('-')[2]) == parseInt(that.days[a])) {\r\n                      right_3[a] = data[i].price\r\n                    }\r\n                  }\r\n                } else if (data[i].hotelId === 4) {\r\n                  for (var a = 0; a< that.nowdays.length; a++) {\r\n                    if (parseInt(data[i].date.split(' ')[0].split('-')[2]) == parseInt(that.days[a])) {\r\n                      right_4[a] = data[i].price\r\n                    }\r\n                  }\r\n                }\r\n                //right_datax.push(data[i].date.split(' ')[0].split('-')[2])\r\n              }\r\n            }\r\n            // 左下折线图 datax\r\n            data_left = [left_1, left_2, left_3, left_4]\r\n            // 右下折线图 datax\r\n            data_right = [right_1, right_2, right_3, right_4]\r\n            let left_se = seriesL\r\n            let right_se = seriesR\r\n            for (let i = 0; i< legend.length; i++) {\r\n              left_se[i].data = data_left[i]\r\n              right_se[i].data = data_right[i]\r\n            }\r\n            // left_se = [\r\n            //   {'name': '酒店1', 'type':'line', 'data': left_1},\r\n            //   {'name': '酒店2', 'type':'line', 'data': left_2},\r\n            //   {'name': '酒店3', 'type':'line', 'data': left_3},\r\n            //   {'name': '酒店4', 'type':'line', 'data': left_4},\r\n            // ]\r\n            // right_se = [\r\n            //   {'name': '酒店1', 'type':'line', data: right_1},\r\n            //   {'name': '酒店2', 'type':'line', data: right_2},\r\n            //   {'name': '酒店3', 'type':'line', data: right_3},\r\n            //   {'name': '酒店4', 'type':'line', data: right_4},\r\n            // ]\r\n            that.EchartsRing(top_right_legend, top_right_series,'echartsbox')\r\n            //that.FutureLine_trend(left_legend, left_series, left_datax,'futuretend', '金额', {star: '', end:'日酒店预订:'})\r\n            that.FutureLine_trend(left_legend, left_se, left_datax, 'futuretend', '金额',{star: '', end:'日酒店预订:'})\r\n            that.FutureLine_trend(right_legend, right_se, right_datax, 'futuremoney', '百分比',{star: '', end:'日酒店入住率:'})\r\n          }\r\n        })\r\n      })\r\n    },\r\n    EchartsRing(legend, series , id){\r\n      var that = this\r\n      var echart1 = echarts.init(document.getElementById(id));\r\n      var option = {\r\n        title: {\r\n          show: series.length < 1 && legend.length < 1,\r\n          textStyle: {\r\n            color: '#909399',\r\n            fontWeight: 'normal',\r\n            fontSize: 14\r\n          },\r\n          text: '暂无数据',\r\n          left: 'center',\r\n          top: 'center'\r\n        },\r\n        tooltip: {\r\n          trigger: 'item',\r\n          // formatter: \"{a} <br/>{b}: {c} ({d}%)\"\r\n          formatter:\r\n          function(params){\r\n            var result =''\r\n            //  result =params.seriesName+''+\"</br>\"\r\n             result += params.seriesName +\"</br>\"+params.marker + \" \" + params.data.name + \" : \" + params.data.value+'('+params.percent+'%'+')' +\"</br>\";\r\n              return result\r\n          }\r\n        },\r\n        legend: {\r\n          orient: 'vertical',\r\n          icon: \"circle\",\r\n          x: '80%',\r\n          y:'center',\r\n          data:legend\r\n        },\r\n        color: ['#89A2FF','#A2BCFF','#FF9F9C','#FFDC79'],//扇形区域以及列表颜色\r\n        series: [\r\n          {\r\n            name:'预订金额占比',\r\n            type:'pie',\r\n            center: ['40%', '55%'],\r\n            radius: ['30%', '50%'],\r\n            //minAngle: 5, // 最小的扇区角度（0 ~ 360），用于防止某个值过小导致扇区太小影响交互\r\n            avoidLabelOverlap: true, // 是否启用防止标签重叠策略\r\n            hoverAnimation: true, // 是否开启 hover 在扇区上的放大动画效\r\n            labelLine: { // 设置延长线的长度\r\n              normal: {\r\n                show:true,\r\n                length: 15, // 设置延长线的长度\r\n                // length2: 10,//设置第二段延长线的长度\r\n              }\r\n            },\r\n            label: {\r\n              normal: {\r\n                show: true,\r\n                formatter: \r\n                function(params){\r\n                  var result =''\r\n                  //  result =params.seriesName+''+\"</br>\"\r\n                  result +=  params.data.value+'('+params.percent+'%'+')'\r\n                  return result\r\n                }\r\n              },\r\n              emphasis:{\r\n                show:true,\r\n                textStyle:{\r\n                  // fontSize:'16',\r\n                }\r\n              }\r\n            },\r\n            data:series\r\n          }\r\n        ]\r\n      }\r\n      echart1.clear()\r\n      echart1.setOption(option)\r\n      window.addEventListener('resize', e => {\r\n        if (echart1) {\r\n          echart1.resize()\r\n        }\r\n      })\r\n    },\r\n    FutureLine_trend(lengend, series, datax, id, name, showbox){\r\n      var data_color = ['#89A2FF','#A2BCFF','#FF9F9C','#FFDC79'] // 扇形区域以及列表颜色\r\n      var that = this\r\n      var option = {\r\n        title: {\r\n          show: series.length < 1 && lengend.length < 1,\r\n          textStyle: {\r\n            color: '#909399',\r\n            fontWeight: 'normal',\r\n            fontSize: 14\r\n          },\r\n          text: '暂无数据',\r\n          left: 'center',\r\n          top: 'center'\r\n        },\r\n        grid: {\r\n          left: '20',\r\n          right: '70',\r\n          bottom: '50'\r\n        },\r\n        tooltip: {\r\n          trigger: 'axis',\r\n          axisPointer: {\r\n            type: 'cross'\r\n          },\r\n          formatter:\r\n          function(params){\r\n            var result =''\r\n            result = showbox.star + params[0].name+ showbox.end +\"</br>\"\r\n            params.forEach(function(item){\r\n              result+= item.marker + \" \" + item.seriesName + \" : \" + item.value +\"</br>\"\r\n            })\r\n            return result\r\n          }\r\n        },\r\n        legend:{\r\n          left: 100,\r\n          top: 30,\r\n          data: lengend\r\n        }, // 'circle', 'rect', 'roundRect', 'triangle', 'diamond', 'pin', 'arrow', 'none'\r\n        color:data_color,//扇形区域以及列表颜色\r\n        xAxis: [{\r\n          type: 'category',\r\n          name: '日期(日)',\r\n          splitLine:{\r\n            show:false\r\n          },\r\n          data: datax,\r\n          axisPointer: {\r\n            type: 'line'//轴线是线还是柱形   'line' 直线指示器 'shadow' 阴影指示器'none' 无指示器\r\n          }, \r\n          axisTick: {//是否显示刻度\r\n            alignWithLabel: true,\r\n            show:false\r\n          }\r\n        }],\r\n        yAxis: [\r\n          {\r\n            type: 'value',\r\n            name: name,\r\n            splitLine:{\r\n              show:false\r\n            },\r\n            axisTick:{\r\n              show:false\r\n            },\r\n            axisLabel: {\r\n              formatter: '{value}'\r\n            },\r\n          }\r\n        ],\r\n        series: series\r\n      }\r\n      var that = this\r\n      var echart2 = echarts.init(document.getElementById(id))\r\n      echart2.clear()\r\n      option.grid.left= this.getYWidth(Math.max.apply(null, option.series[0].data), Math.max.apply(null, option.series[0].data))\r\n      echart2.setOption(option)\r\n      window.addEventListener('resize', function() {\r\n        if (echart2) {\r\n          echart2.resize()\r\n        }\r\n      })\r\n    },\r\n    // 获取下个月多少天\r\n    getNowFormatDate() {\r\n        var date = new Date();\r\n        var seperator1 = \"-\";\r\n        var year = date.getFullYear();\r\n        var month = date.getMonth() + 1;\r\n        var strDate = date.getDate();\r\n        if (month >= 1 && month <= 9) {\r\n            month = \"0\" + month;\r\n        }\r\n        if (strDate >= 0 && strDate <= 9) {\r\n            strDate = \"0\" + strDate;\r\n        }\r\n        //return currentdate;\r\n        var currentdate = year + seperator1 + month + seperator1 + strDate;\r\n        var arr = currentdate.split('-');\r\n            var year = arr[0]; //获取当前日期的年份\r\n            var month = arr[1]; //获取当前日期的月份\r\n            var day = arr[2]; //获取当前日期的日\r\n            var days = new Date(year, month, 0);\r\n            days = days.getDate(); //获取当前日期中的月的天数\r\n            var nextDays = days\r\n       return nextDays;\r\n    },\r\n    //获取当前月的天数\r\n    GetDate(){\r\n     var date = new Date();\r\n     var year = date.getFullYear();\r\n     var month = date.getMonth()+1;\r\n     var d = new Date(year, month, 0);\r\n     return d.getDate();\r\n    },\r\n    getYWidth(data1, data2) { // 根据数值长度计算显示宽度\r\n      return ((data1 > data2 ? data1.toString().length : data2.toString().length) * 12).toString()\r\n    }\r\n  }\r\n}\r\n",null]}